# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ:

1. **SQL –º–∏–≥—Ä–∞—Ü–∏—è** (`migrations/add_onboarding_system.sql`) - 304 —Å—Ç—Ä–æ–∫–∏
2. **Workflow AnaliziFinance.json** - –¥–æ–±–∞–≤–ª–µ–Ω–æ 11 –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
3. **–í—Å–µ–≥–æ —É–∑–ª–æ–≤ –≤ workflow**: 88

## üìã –®–∞–≥–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π Supabase SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ `migrations/add_onboarding_system.sql`
3. –í—ã–ø–æ–ª–Ω–∏ SQL
4. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –Ω–µ –±—ã–ª–æ –æ—à–∏–±–æ–∫

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É `users`
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `user_onboarding_answers` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç 7 —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–æ–º
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `onboarding_completed = TRUE` –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π workflow

1. –û—Ç–∫—Ä–æ–π n8n
2. –û—Ç–∫—Ä–æ–π workflow "AnaliziFinance"
3. –ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—é (3 —Ç–æ—á–∫–∏) ‚Üí "Import from File"
4. –í—ã–±–µ—Ä–∏ —Ñ–∞–π–ª `AnaliziFinance.json`
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∑–∞–º–µ–Ω—É

**–ù–æ–≤—ã–µ —É–∑–ª—ã –≤ workflow:**
1. `Check Onboarding Status` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–Ω–∫–µ—Ç—ã
2. `Onboarding Router` - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (–∑–∞–≤–µ—Ä—à–µ–Ω–æ/–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ)
3. `Handle Onboarding Step` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π —à–∞–≥ –∞–Ω–∫–µ—Ç—ã
4. `Parse Onboarding Answer` - –ø–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. `Save Onboarding Answer` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç –≤ –ë–î
6. `Check If Onboarding Completed` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
7. `Send Completion Message` - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
8. `Send Next Question` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
9. `Prepare Question` - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
10. `Get Current Onboarding Question` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–£–¥–∞–ª–∏ —Å–µ–±—è –∏–∑ –ë–î** (—á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –∫–∞–∫ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
```sql
DELETE FROM users WHERE user_id = 1109421300;
```

2. **–û—Ç–ø—Ä–∞–≤—å –±–æ—Ç—É /start**
3. **–ü—Ä–æ–π–¥–∏ –∞–Ω–∫–µ—Ç—É** (5 –≤–æ–ø—Ä–æ—Å–æ–≤):
   - –õ–∏—á–Ω–æ–µ / –ë–∏–∑–Ω–µ—Å
   - –í–∞–ª—é—Ç–∞ (—Å–æ–º, –¥–æ–ª–ª–∞—Ä, –µ–≤—Ä–æ, —Ä—É–±–ª—å)
   - –ú–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç
   - –†–æ–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –°—Ç—Ä–∞–Ω–∞

4. **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** - –ø–æ–ø—Ä–æ–±—É–π –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥/–¥–æ—Ö–æ–¥

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞:

```
Telegram Bot Trigger
    ‚Üì
Check Onboarding Status  
    ‚Üì
Onboarding Router
    ‚îú‚îÄ TRUE (–∑–∞–≤–µ—Ä—à–µ–Ω–æ) ‚Üí Message Type Switch ‚Üí –û–±—ã—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–æ—Ç–∞
    ‚îî‚îÄ FALSE (–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ) ‚Üí Handle Onboarding Step ‚Üí –ü–æ–∫–∞–∑ –≤–æ–ø—Ä–æ—Å–æ–≤ –∞–Ω–∫–µ—Ç—ã
```

## üìù –í–æ–ø—Ä–æ—Å—ã –∞–Ω–∫–µ—Ç—ã:

1. **Usage Type** (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ):
   - üë§ –õ–∏—á–Ω–æ–µ
   - üíº –ë–∏–∑–Ω–µ—Å

2. **Currency** (–≤–∞–ª—é—Ç–∞):
   - üá∞üá¨ –°–æ–º (KGS)
   - üá∫üá∏ –î–æ–ª–ª–∞—Ä (USD)
   - üá™üá∫ –ï–≤—Ä–æ (EUR)
   - üá∑üá∫ –†—É–±–ª—å (RUB)

3. **Monthly Budget** (–º–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç):
   - –ß–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 50000)
   - –ò–ª–∏ "–ù–µ –∑–Ω–∞—é / –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"

4. **Occupation** (—Ä–æ–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏):
   - –°—Ç—É–¥–µ–Ω—Ç
   - –†–∞–±–æ—Ç–∞—é –ø–æ –Ω–∞–π–º—É
   - –§—Ä–∏–ª–∞–Ω—Å–µ—Ä
   - –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å
   - –î—Ä—É–≥–æ–µ

5. **Country** (—Å—Ç—Ä–∞–Ω–∞):
   - üá∞üá¨ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω
   - üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
   - üá∑üá∫ –†–æ—Å—Å–∏—è
   - üá∫üáø –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω
   - –î—Ä—É–≥–∞—è —Å—Ç—Ä–∞–Ω–∞

## üîß –§—É–Ω–∫—Ü–∏–∏ PostgreSQL:

1. `check_onboarding_completed(user_id)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å
2. `get_onboarding_step(user_id)` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —à–∞–≥ –∏ –≤–æ–ø—Ä–æ—Å
3. `save_onboarding_answer(user_id, step_name, answer)` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç
4. `get_user_profile(user_id)` - –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å –≤–∞–ª—é—Ç–æ–π
5. `reset_onboarding(user_id)` - —Å–±—Ä–æ—Å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
6. `update_user_currency(user_id, currency)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã
7. `format_amount_with_currency(amount, user_id)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤–∞–ª—é—Ç–æ–π

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- –í—Å–µ **—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç `onboarding_completed = TRUE`
- **–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç –ø—Ä–æ–π—Ç–∏ –∞–Ω–∫–µ—Ç—É –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- –ê–Ω–∫–µ—Ç–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è** - –±–µ–∑ –µ—ë –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∫–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. **–ü—Ä–æ–≤–µ—Ä—å –æ—à–∏–±–∫–∏ –≤ n8n** - –æ—Ç–∫—Ä–æ–π—Ç–µ Executions –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª–∏
2. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ Supabase** - Table Editor ‚Üí users ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏—è
3. **–°–±—Ä–æ—Å—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥**:
```sql
SELECT reset_onboarding(1109421300);
```

4. **–ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏–∏**:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
SELECT * FROM get_user_profile(1109421300);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
SELECT * FROM get_onboarding_step(1109421300);
```

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ —Å 5 –≤–æ–ø—Ä–æ—Å–∞–º–∏!
