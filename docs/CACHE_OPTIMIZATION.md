# üöÄ Cache Optimization Guide

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

AIAccounter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

### 1. Memory Cache (–û—Å–Ω–æ–≤–Ω–æ–π –∫—ç—à)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** `Map()` –≤ –ø–∞–º—è—Ç–∏
- **TTL:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300 —Å–µ–∫—É–Ω–¥)
- **–°–∫–æ—Ä–æ—Å—Ç—å:** –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
- **–û–±—ä–µ–º:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–∞–º—è—Ç—å—é –±—Ä–∞—É–∑–µ—Ä–∞

### 2. Persistent Cache (localStorage)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** `localStorage` –±—Ä–∞—É–∑–µ—Ä–∞
- **TTL:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å memory cache
- **–°–∫–æ—Ä–æ—Å—Ç—å:** –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø
- **–û–±—ä–µ–º:** ~5-10 MB
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## –ö—ç—à–∏—Ä—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ

### Dashboard (5 –º–∏–Ω—É—Ç)
```javascript
cache.set(`dashboard:${period}:${currency}`, data, 300);
```
- –û–±–∑–æ—Ä –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥—É
- –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### History (3 –º–∏–Ω—É—Ç—ã)
```javascript
cache.set(`history:${type}:${category}:${currency}`, transactions, 180);
```
- –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–º–º—ã

### Analytics (2 –º–∏–Ω—É—Ç—ã)
```javascript
cache.set(`analytics:${period}:${currency}:${startDate}`, data, 120);
```
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤
- –¢–æ–ø-10 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º

### Reports (5 –º–∏–Ω—É—Ç)
```javascript
cache.set('reports:list', reports, 300);
```
- –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤
- –°–ø–∏—Å–æ–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞

### 1. –°–º–µ–Ω–∞ –≤–∞–ª—é—Ç—ã
```javascript
// –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≤–∏—Å–∏–º—ã–µ –∫—ç—à–∏
cache.clearMatching('dashboard');
cache.clearMatching('history');
cache.clearMatching('analytics');
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
```javascript
// –î–ª—è history - –æ—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
cache.clearMatching('history');
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±—É–¥—É—â–µ–µ)
```javascript
// –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
cache.clearMatching('dashboard');
cache.clearMatching('history');
cache.clearMatching('analytics');
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. Debouncing —Ñ–∏–ª—å—Ç—Ä–æ–≤
```javascript
const debouncedLoadHistory = () => {
    clearTimeout(historyDebounceTimer);
    cache.clearMatching('history');
    historyDebounceTimer = setTimeout(() => loadHistory(), 300);
};
```
–ó–∞–¥–µ—Ä–∂–∫–∞ 300ms –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤.

### 2. Preloading
```javascript
// –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ dashboard - preload analytics –≤ —Ñ–æ–Ω–µ
setTimeout(() => {
    if (!cache.get(analyticsKey)) {
        loadAnalytics().catch(e => console.warn('Preload failed:', e));
    }
}, 1000);
```
–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–µ—Ä–æ—è—Ç–Ω—ã–π —ç–∫—Ä–∞–Ω –∑–∞—Ä–∞–Ω–µ–µ.

### 3. Skeleton Loading
```html
<div class="loading-placeholder">
    <div class="skeleton-item"></div>
    <div class="skeleton-item"></div>
    <div class="skeleton-item"></div>
</div>
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏—è—Ç–Ω—ã–µ placeholder'—ã –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç–æ–≥–æ —ç–∫—Ä–∞–Ω–∞.

### 4. Parallel API Calls
```javascript
const [data, topCategories] = await Promise.all([
    api.getOverview({ period }),
    api.getCategoryAnalytics({ limit: 3 })
]);
```
–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—ç—à–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```javascript
console.log('üì¶ Using cached dashboard data');  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫—ç—à
console.log('üíæ Restored from localStorage');   // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ localStorage
console.log('üóëÔ∏è Cleared cache with prefix: history'); // –û—á–∏—â–µ–Ω –∫—ç—à
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
1. –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Console
2. –ü–µ—Ä–≤—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω: `api.get()` –∑–∞–ø—Ä–æ—Å
3. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥: "Using cached data" –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞
4. –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã –≤–∞–ª—é—Ç—ã: "Cleared cache" ‚Üí –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

## API –∫—ç—à–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

#### `cache.set(key, value, ttl)`
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à
- `key`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á (string)
- `value`: –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (any)
- `ttl`: –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (number, default: 300)

```javascript
cache.set('dashboard:week:KGS', dashboardData, 300);
```

#### `cache.get(key)`
–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null` –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ —É—Å—Ç–∞—Ä–µ–ª–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç localStorage

```javascript
const data = cache.get('dashboard:week:KGS');
if (data) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
}
```

#### `cache.clear()`
–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫—ç—à–∞
- –û—á–∏—â–∞–µ—Ç memory cache
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ `cache_*` –∫–ª—é—á–∏ –∏–∑ localStorage

```javascript
cache.clear();
```

#### `cache.clearMatching(prefix)`
–¢–æ—á–µ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∫–ª—é—á–∏ –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `prefix`
- –†–∞–±–æ—Ç–∞–µ—Ç —Å memory –∏ localStorage

```javascript
cache.clearMatching('history'); // –û—á–∏—Å—Ç–∏—Ç history:expense:all:KGS –∏ –¥—Ä.
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ TTL

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | TTL | –ü—Ä–∏—á–∏–Ω–∞ |
|------------|-----|---------|
| Dashboard | 300s (5 –º–∏–Ω) | –†–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è, —Å—Ç–∞—Ç–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| History | 180s (3 –º–∏–Ω) | –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –Ω–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| Analytics | 120s (2 –º–∏–Ω) | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º |
| Reports | 300s (5 –º–∏–Ω) | –û—Ç—á–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ä–µ–¥–∫–æ |
| Exchange Rates | 3600s (1 —á–∞—Å) | –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–∞–∑ –≤ –¥–µ–Ω—å |

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. Service Worker Cache
```javascript
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ HTTP
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js');
}
```

### 2. IndexedDB –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
```javascript
// –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –∏—Å—Ç–æ—Ä–∏–∏
const db = await openDB('aiaccounter', 1);
await db.put('history', largeDataset);
```

### 3. Background Sync
```javascript
// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –≤ —Ñ–æ–Ω–µ
navigator.serviceWorker.ready.then(registration => {
    registration.sync.register('update-cache');
});
```

### 4. Cache Versioning
```javascript
const CACHE_VERSION = 'v1';
cache.set(`${CACHE_VERSION}:dashboard:week:KGS`, data);
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ö—ç—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TTL - –º–æ–∂–µ—Ç –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –∫—ç—à–∞ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage - –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω

### –î–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
1. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –≤—Ä—É—á–Ω—É—é: `cache.clear()`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–∫—É –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. –£–º–µ–Ω—å—à–∏—Ç–µ TTL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### localStorage –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω
```javascript
try {
    localStorage.setItem(key, value);
} catch (e) {
    if (e.name === 'QuotaExceededError') {
        // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∫—ç—à–∏
        cache.clear();
    }
}
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Dashboard –∑–∞–≥—Ä—É–∑–∫–∞: ~800ms
- History –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~600ms
- Analytics –ø–µ—Ä–µ—Ö–æ–¥: ~700ms
- **–û–±—â–µ–µ –≤—Ä–µ–º—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è: ~2.1s**

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Dashboard –∑–∞–≥—Ä—É–∑–∫–∞: ~800ms (–ø–µ—Ä–≤–∞—è)
- Dashboard –∏–∑ –∫—ç—à–∞: **~50ms** ‚ö°
- History –∏–∑ –∫—ç—à–∞: **~30ms** ‚ö°
- Analytics –∏–∑ –∫—ç—à–∞: **~40ms** ‚ö°
- **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: –¥–æ 95%**

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è AIAccounter –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
- üíæ Persistent —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è offline —Ä–µ–∂–∏–º–∞
- üéØ –¢–æ—á–µ—á–Ω—É—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- üìä Preloading —Å–ª–µ–¥—É—é—â–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- üé® Skeleton loading –¥–ª—è UX

–í—Å–µ –≤–º–µ—Å—Ç–µ —Å–æ–∑–¥–∞–µ—Ç –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Telegram Mini App.
