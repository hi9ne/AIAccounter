# üéØ –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –¥–∞—Ç

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ‚úÖ
- –í—ã—è–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: —Ä–∞—Å—Ö–æ–¥—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –¥–∞—Ç–æ–π **–Ω–∞ –¥–µ–Ω—å —Ä–∞–Ω—å—à–µ**
- –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–∏–ª —Ä–∞—Å—Ö–æ–¥ 05.11.2025, –∑–∞–ø–∏—Å–∞–ª–æ—Å—å 04.11.2025
- –û—Ç—á–µ—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è –ø–æ–∫–∞–∑—ã–≤–∞–ª 0 —Ä–∞—Å—Ö–æ–¥–æ–≤ (—Ç.–∫. —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –≤—á–µ—Ä–∞—à–Ω–µ–π –¥–∞—Ç–µ)

### 2. –ù–∞–π–¥–µ–Ω—ã –ø—Ä–∏—á–∏–Ω—ã ‚úÖ
**–ü—Ä–∏—á–∏–Ω–∞ 1:** AI –≤–∏–¥–µ–ª —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –ø—Ä–æ–º–ø—Ç–µ
```javascript
// –í —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ –±—ã–ª–æ:
"–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: {{ new Date().toLocaleDateString('ru-RU') }}"
```
- JavaScript –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ n8n (–≤–æ–∑–º–æ–∂–Ω–æ –≤ UTC)
- AI –≤–æ–∑–≤—Ä–∞—â–∞–ª —ç—Ç—É –¥–∞—Ç—É –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞ 2:** CURRENT_DATE —Ä–∞–±–æ—Ç–∞–ª –≤ UTC timezone
```sql
-- SQL –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª:
WHEN '{{ $fromAI("date", ...) }}' = '' THEN CURRENT_DATE
```
- –ï—Å–ª–∏ UTC 23:00 (04.11), —Ç–æ –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ —É–∂–µ 05:00 (05.11)
- –ë–∞–∑–∞ –∑–∞–ø–∏—Å—ã–≤–∞–ª–∞ 04.11 –≤–º–µ—Å—Ç–æ 05.11

### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ

#### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1:** –£–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞ –∏–∑ –ø—Ä–æ–º–ø—Ç–∞ AI
```diff
# AnaliziFinance.json, —Å—Ç—Ä–æ–∫–∞ ~311

- "–í–∞–ª—é—Ç—ã: —Å–æ–º (KGS), –¥–æ–ª–ª–∞—Ä (USD), –µ–≤—Ä–æ (EUR), —Ä—É–±–ª—å (RUB). –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: {{ new Date().toLocaleDateString('ru-RU') }}"
+ "–í–∞–ª—é—Ç—ã: —Å–æ–º (KGS), –¥–æ–ª–ª–∞—Ä (USD), –µ–≤—Ä–æ (EUR), —Ä—É–±–ª—å (RUB)."
```

#### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2:** CURRENT_DATE ‚Üí NOW() —Å timezone (Add_expense)
```diff
# AnaliziFinance.json, —Å—Ç—Ä–æ–∫–∞ ~892

  CASE 
-   WHEN '{{ $fromAI("date", "–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ —Ç–æ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞", ...) }}' = '' 
-     THEN CURRENT_DATE
+   WHEN '{{ $fromAI("date", "–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY. –ï—Å–ª–∏ –¥–∞—Ç–∞ –ù–ï —É–∫–∞–∑–∞–Ω–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É", ...) }}' = '' 
+     THEN (NOW() AT TIME ZONE 'Asia/Bishkek')::DATE
    ELSE TO_DATE('{{ $fromAI("date"...) }}', 'DD.MM.YYYY')
  END
```

#### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ 3:** CURRENT_DATE ‚Üí NOW() —Å timezone (Add_income)
```diff
# AnaliziFinance.json, —Å—Ç—Ä–æ–∫–∞ ~844

  CASE 
-   WHEN '{{ $fromAI("date", ...) }}' = '' THEN CURRENT_DATE
+   WHEN '{{ $fromAI("date", ...) }}' = '' THEN (NOW() AT TIME ZONE 'Asia/Bishkek')::DATE
    ELSE TO_DATE('{{ $fromAI("date"...) }}', 'DD.MM.YYYY')
  END
```

### 4. –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ

**–§–∞–π–ª—ã:**
- ‚úÖ `migrations/HOTFIX_date_timezone.sql` - SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—á–∏—Å—Ç–∫–∏
- ‚úÖ `docs/HOTFIX_DATE_TIMEZONE.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `docs/TEST_DATE_FIX.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ `CHANGELOG.md` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å v2.4.2-hotfix

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚ùå
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ—Ç—Ä–∞—Ç–∏–ª 500 –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫"
  ‚Üì
AI –≤–∏–¥–∏—Ç –≤ –ø—Ä–æ–º–ø—Ç–µ: "–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: 04.11.2025" (–∏–∑ JavaScript –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ UTC)
  ‚Üì
AI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: date = "04.11.2025" (–≤–º–µ—Å—Ç–æ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏)
  ‚Üì
SQL: ELSE TO_DATE('04.11.2025', 'DD.MM.YYYY')
  ‚Üì
–ë–∞–∑–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç: 04.11.2025 ‚ùå (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 05.11.2025)
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ—Ç—Ä–∞—Ç–∏–ª 500 –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫"
  ‚Üì
AI –ù–ï –≤–∏–¥–∏—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –ø—Ä–æ–º–ø—Ç–µ
  ‚Üì
AI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: date = "" (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, —Ç.–∫. –¥–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞)
  ‚Üì
SQL: WHEN '' = '' THEN (NOW() AT TIME ZONE 'Asia/Bishkek')::DATE
  ‚Üì
PostgreSQL:
  NOW() = 2025-11-05 05:30:00 UTC
  NOW() AT TIME ZONE 'Asia/Bishkek' = 2025-11-05 11:30:00 (UTC+6)
  ::DATE = 2025-11-05
  ‚Üì
–ë–∞–∑–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç: 05.11.2025 ‚úÖ (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –≤ timezone –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞)
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
1. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ `AnaliziFinance.json`
2. ‚úÖ JSON –≤–∞–ª–∏–¥–µ–Ω (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)
3. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. ‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å workflow –≤ n8n (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ‚Üí –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å)
2. ‚è≥ –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π:
   ```sql
   DELETE FROM expenses 
   WHERE user_id = 1109421300 
   AND date = '2025-11-04' 
   AND amount = 500;
   ```
3. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: "–ü–æ—Ç—Ä–∞—Ç–∏–ª 100 –Ω–∞ –æ–±–µ–¥"
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: "–û—Ç—á–µ—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è"
5. ‚è≥ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–∞—Å—Ö–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "–ü–æ—Ç—Ä–∞—Ç–∏–ª 100 –Ω–∞ –æ–±–µ–¥"
–ë–æ—Ç ‚Üí "‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω: 100 KGS –Ω–∞ '–∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã' (05.11.2025)"
                                                         ^^^^^^^^^^
                                                    —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞ ‚úÖ
```

### –¢–µ—Å—Ç 2: –î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "–û—Ç—á–µ—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è"
–ë–æ—Ç ‚Üí "üìä –û—Ç—á–µ—Ç –∑–∞ 05.11.2025
       üìâ –†–ê–°–•–û–î–´
       üçΩÔ∏è –∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã: 100 KGS   ‚Üê —Ä–∞—Å—Ö–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ‚úÖ
       
       üí∞ –ò–¢–û–ì–ò
       –û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã: 100 —Å–æ–º"
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ | –ü–æ—Å–ª–µ |
|----------|-----|-------|
| **AI –ø—Ä–æ–º–ø—Ç** | `–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: {{ new Date()... }}` | –î–∞—Ç–∞ —É–±—Ä–∞–Ω–∞ |
| **SQL —Ñ—É–Ω–∫—Ü–∏—è** | `CURRENT_DATE` | `(NOW() AT TIME ZONE 'Asia/Bishkek')::DATE` |
| **Timezone** | UTC (—Å–µ—Ä–≤–µ—Ä –ë–î) | Asia/Bishkek (UTC+6) |
| **AI –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è** | "–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ —Ç–æ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞" | **"–ï—Å–ª–∏ –¥–∞—Ç–∞ –ù–ï —É–∫–∞–∑–∞–Ω–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É"** |

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

–ï—Å–ª–∏ `'Asia/Bishkek'` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```sql
-- –í–∞—Ä–∏–∞–Ω—Ç 1: UTC offset
(NOW() AT TIME ZONE 'UTC+6')::DATE

-- –í–∞—Ä–∏–∞–Ω—Ç 2: Etc timezone
(NOW() AT TIME ZONE 'Etc/GMT-6')::DATE

-- –í–∞—Ä–∏–∞–Ω—Ç 3: Almaty (—Ç–æ—Ç –∂–µ UTC+6)
(NOW() AT TIME ZONE 'Asia/Almaty')::DATE
```

## –°—Ç–∞—Ç—É—Å

- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–æ–∑–¥–∞–Ω–∞
- ‚è≥ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –û–∂–∏–¥–∞–µ—Ç—Å—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚è≥ **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ workflow

---

**–í–µ—Ä—Å–∏—è:** v2.4.2-hotfix  
**–î–∞—Ç–∞:** 05.11.2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** CRITICAL  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û, ‚è≥ –û–ñ–ò–î–ê–ï–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø
