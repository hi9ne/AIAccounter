# 📋 Онбординг AIAccounter — Техническая документация

> Полное описание логики анкеты первичной настройки

---

## 🎯 Цели онбординга

1. **Персонализация** — настроить приложение под пользователя
2. **Сбор данных** — валюта, бюджет, тип использования
3. **Создание категорий** — релевантных для типа использования
4. **Настройка уведомлений** — когда и о чём напоминать

---

## ⚠️ Ключевые правила

| Правило | Значение |
|---------|----------|
| Обязательность | **Да**, пропустить нельзя |
| Где проходит | Mini App + Telegram бот |
| Можно перепройти | Нет, но каждый пункт меняется в настройках отдельно |
| Количество шагов | **5 шагов** |
| Время прохождения | ~1-2 минуты |

---

## 📊 Структура анкеты

```
┌─────────────────────────────────────────────────────────────┐
│  Шаг 0: Приветствие                                         │
│  ↓                                                          │
│  Шаг 1: Валюта (обязательно)                               │
│  ↓                                                          │
│  Шаг 2: Тип использования (обязательно)                    │
│  ↓                                                          │
│  Шаг 3: Месячный бюджет (обязательно)                      │
│  ↓                                                          │
│  Шаг 4: Категории расходов (автоматически + выбор)         │
│  ↓                                                          │
│  Шаг 5: Уведомления (обязательно)                          │
│  ↓                                                          │
│  Завершение → Переход в приложение                         │
└─────────────────────────────────────────────────────────────┘
```

---

## 📝 Детальное описание шагов

### Шаг 0: Приветствие

**Цель:** Познакомить с приложением, мотивировать пройти настройку

**UI Mini App:**
```
┌─────────────────────────────────────────┐
│                                         │
│         🤖 AIAccounter                  │
│                                         │
│     👋 Привет, {first_name}!            │
│                                         │
│     Я твой финансовый помощник.         │
│     Помогу тебе:                        │
│                                         │
│     💰 Записывать расходы и доходы      │
│     📊 Анализировать траты              │
│     🔔 Напоминать о платежах            │
│     🤖 Давать умные советы              │
│                                         │
│     Настроим под тебя за 1 минуту!      │
│                                         │
│     ┌─────────────────────────────┐     │
│     │      Начать настройку       │     │
│     └─────────────────────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

**Telegram бот:**
```
👋 Привет, {first_name}!

Я AIAccounter — твой финансовый помощник.

Помогу тебе:
• 💰 Записывать расходы и доходы голосом
• 📊 Анализировать куда уходят деньги
• 🔔 Напоминать о долгах и подписках
• 🤖 Давать умные советы

Давай настроим под тебя! Это займёт 1 минуту.

[Начать настройку ▶️]
```

**Действия:**
- При нажатии → переход к Шагу 1
- Сохраняем `onboarding_started_at = NOW()`
- Сохраняем `onboarding_step = 0`

---

### Шаг 1: Валюта

**Цель:** Определить основную валюту для отображения сумм

**UI Mini App:**
```
┌─────────────────────────────────────────┐
│  ← Назад          Шаг 1 из 5            │
│  ━━━━━━━━━━○○○○○                        │
│                                         │
│         💰 Основная валюта              │
│                                         │
│     В какой валюте ведёшь учёт?         │
│     Все суммы будут показываться        │
│     в выбранной валюте.                 │
│                                         │
│     ┌─────────────────────────────┐     │
│     │ 🇰🇬  Сом (KGS)         ✓    │     │  ← выбран по умолчанию
│     └─────────────────────────────┘     │
│     ┌─────────────────────────────┐     │
│     │ 🇺🇸  Доллар (USD)           │     │
│     └─────────────────────────────┘     │
│     ┌─────────────────────────────┐     │
│     │ 🇪🇺  Евро (EUR)             │     │
│     └─────────────────────────────┘     │
│     ┌─────────────────────────────┐     │
│     │ 🇷🇺  Рубль (RUB)            │     │
│     └─────────────────────────────┘     │
│                                         │
│     ┌─────────────────────────────┐     │
│     │         Продолжить →        │     │
│     └─────────────────────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

**Telegram бот:**
```
💰 Шаг 1 из 5: Валюта

В какой валюте ведёшь учёт?
Все суммы будут отображаться в выбранной валюте.

[🇰🇬 Сом (KGS)]
[🇺🇸 Доллар (USD)]
[🇪🇺 Евро (EUR)]
[🇷🇺 Рубль (RUB)]
```

**Логика:**
| Поле | Значение |
|------|----------|
| По умолчанию | KGS |
| Сохраняется в | `users.preferred_currency` |
| Влияет на | Отображение всех сумм в приложении |
| Конвертация | Транзакции в других валютах автоматически конвертируются |

**Действия:**
- Выбор валюты → сохраняем в БД
- `onboarding_step = 1`
- Переход к Шагу 2

---

### Шаг 2: Тип использования

**Цель:** Определить контекст использования для персонализации категорий и советов

**UI Mini App:**
```
┌─────────────────────────────────────────┐
│  ← Назад          Шаг 2 из 5            │
│  ━━━━━━━━━━━━━━━━○○○○                   │
│                                         │
│         🎯 Тип использования            │
│                                         │
│     Для чего будешь использовать?       │
│     Это поможет настроить категории     │
│     и советы под тебя.                  │
│                                         │
│     ┌─────────────────────────────┐     │
│     │ 👤 Личные финансы           │     │
│     │    Ежедневные траты,        │     │
│     │    зарплата, накопления     │     │
│     └─────────────────────────────┘     │
│                                         │
│     ┌─────────────────────────────┐     │
│     │ 💼 Бизнес                   │     │
│     │    Доходы от клиентов,      │     │
│     │    расходы на бизнес        │     │
│     └─────────────────────────────┘     │
│                                         │
│     ┌─────────────────────────────┐     │
│     │ 🔄 Личные + Бизнес          │     │
│     │    Фриланс, ИП, совмещаю    │     │
│     │    личное и рабочее         │     │
│     └─────────────────────────────┘     │
│                                         │
│     ┌─────────────────────────────┐     │
│     │         Продолжить →        │     │
│     └─────────────────────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

**Telegram бот:**
```
🎯 Шаг 2 из 5: Тип использования

Для чего будешь использовать?

[👤 Личные финансы]
   Ежедневные траты, зарплата, накопления

[💼 Бизнес]
   Доходы от клиентов, расходы на бизнес

[🔄 Личные + Бизнес]
   Фриланс, ИП, совмещаю личное и рабочее
```

**Логика:**

| Тип | Код | Категории расходов | Категории доходов |
|-----|-----|-------------------|-------------------|
| Личные | `personal` | Еда, Транспорт, Жильё, Связь, Развлечения, Здоровье, Одежда, Образование, Подарки, Другое | Зарплата, Подработка, Подарки, Кэшбэк, Другое |
| Бизнес | `business` | Офис, Оборудование, Реклама, Зарплаты сотрудникам, Налоги, Транспорт, Связь, Подписки, Представительские, Другое | Продажи, Услуги, Консалтинг, Комиссии, Другое |
| Личные + Бизнес | `mixed` | Все личные + все бизнес категории с разделением | Все личные + все бизнес категории |

**Сохраняется в:** `users.usage_type`

**Влияет на:**
- Дефолтные категории (создаются автоматически)
- AI советы (разный контекст)
- Отчёты (разная структура)
- Экран аналитики (разделение личное/бизнес для mixed)

---

### Шаг 3: Месячный бюджет

**Цель:** Установить ориентир для отслеживания трат

**UI Mini App:**
```
┌─────────────────────────────────────────┐
│  ← Назад          Шаг 3 из 5            │
│  ━━━━━━━━━━━━━━━━━━━━━━━━○○             │
│                                         │
│         📊 Месячный бюджет              │
│                                         │
│     Сколько планируешь тратить          │
│     в месяц? Поможет отслеживать        │
│     прогресс и не выходить за рамки.    │
│                                         │
│     ┌─────────────────────────────┐     │
│     │                             │     │
│     │     [  50,000  ] сом        │     │  ← поле ввода
│     │                             │     │
│     └─────────────────────────────┘     │
│                                         │
│     или выбери диапазон:                │
│                                         │
│     [До 20,000]  [20-50,000]            │
│     [50-100,000] [100,000+]             │
│                                         │
│     💡 Можно изменить позже             │
│        в настройках                     │
│                                         │
│     ┌─────────────────────────────┐     │
│     │         Продолжить →        │     │
│     └─────────────────────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

**Для бизнеса (usage_type = business или mixed):**
```
┌─────────────────────────────────────────┐
│         📊 Месячный бюджет              │
│                                         │
│     👤 Личные расходы:                  │
│     ┌─────────────────────────────┐     │
│     │     [  50,000  ] сом        │     │
│     └─────────────────────────────┘     │
│                                         │
│     💼 Бизнес расходы:                  │
│     ┌─────────────────────────────┐     │
│     │     [ 100,000  ] сом        │     │
│     └─────────────────────────────┘     │
│                                         │
│     💡 Бюджеты отслеживаются            │
│        отдельно                         │
│                                         │
└─────────────────────────────────────────┘
```

**Telegram бот:**
```
📊 Шаг 3 из 5: Месячный бюджет

Сколько планируешь тратить в месяц?

Введи сумму числом (например: 50000)
или выбери диапазон:

[До 20,000 с]
[20,000 - 50,000 с]
[50,000 - 100,000 с]
[100,000+ с]
```

**Логика:**

| Диапазон | Сохраняемое значение |
|----------|---------------------|
| До 20,000 | 15000 |
| 20,000 - 50,000 | 35000 |
| 50,000 - 100,000 | 75000 |
| 100,000+ | 150000 |
| Ввод числа | Введённое число |

**Сохраняется в:** 
- `users.monthly_budget` (общий)
- `budgets` таблица (создаётся запись на текущий месяц)

**Для mixed типа:**
- Создаются 2 бюджета: личный и бизнес
- В `budgets` поле `budget_type`: `personal` / `business`

---

### Шаг 4: Категории расходов

**Цель:** Персонализировать список категорий

**UI Mini App (для personal):**
```
┌─────────────────────────────────────────┐
│  ← Назад          Шаг 4 из 5            │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━○        │
│                                         │
│         📁 Категории расходов           │
│                                         │
│     Выбери категории, которые           │
│     используешь чаще всего.             │
│     Они будут показываться первыми.     │
│                                         │
│     ┌─────────────────────────────┐     │
│     │ [✓] 🍔 Еда и продукты       │     │
│     │ [✓] 🚗 Транспорт            │     │
│     │ [✓] 🏠 Жильё и ЖКХ          │     │
│     │ [✓] 📱 Связь и интернет     │     │
│     │ [ ] 🎬 Развлечения          │     │
│     │ [ ] 👕 Одежда               │     │
│     │ [ ] 💊 Здоровье             │     │
│     │ [ ] 📚 Образование          │     │
│     │ [ ] ✈️ Путешествия          │     │
│     │ [ ] 🎁 Подарки              │     │
│     │ [✓] 📦 Другое               │     │
│     └─────────────────────────────┘     │
│                                         │
│     💡 Все категории сохранятся,        │
│        выбранные будут сверху           │
│                                         │
│     ┌─────────────────────────────┐     │
│     │         Продолжить →        │     │
│     └─────────────────────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

**UI Mini App (для business):**
```
│     ┌─────────────────────────────┐     │
│     │ [✓] 🏢 Офис и аренда        │     │
│     │ [✓] 💻 Оборудование         │     │
│     │ [✓] 📢 Реклама и маркетинг  │     │
│     │ [ ] 👥 Зарплаты             │     │
│     │ [✓] 📋 Налоги и сборы       │     │
│     │ [ ] 🚗 Транспорт            │     │
│     │ [✓] 📱 Связь и интернет     │     │
│     │ [ ] 💼 Представительские    │     │
│     │ [ ] 📦 Закупки товаров      │     │
│     │ [✓] 📦 Другое               │     │
│     └─────────────────────────────┘     │
```

**UI Mini App (для mixed):**
```
│         📁 Личные категории             │
│     ┌─────────────────────────────┐     │
│     │ [✓] 🍔 Еда        [✓] 🚗    │     │
│     │ [✓] 🏠 Жильё      [ ] 🎬    │     │
│     └─────────────────────────────┘     │
│                                         │
│         💼 Бизнес категории             │
│     ┌─────────────────────────────┐     │
│     │ [✓] 🏢 Офис       [✓] 📢    │     │
│     │ [ ] 👥 Зарплаты   [✓] 📋    │     │
│     └─────────────────────────────┘     │
```

**Telegram бот:**
```
📁 Шаг 4 из 5: Категории

Выбери категории, которые используешь чаще всего:

🍔 Еда и продукты
🚗 Транспорт  
🏠 Жильё и ЖКХ
📱 Связь
🎬 Развлечения
👕 Одежда
💊 Здоровье
📚 Образование

[🍔 Еда] [🚗 Транспорт] [🏠 Жильё] [📱 Связь]
[🎬 Развлечения] [👕 Одежда] [💊 Здоровье]

Выбрано: 4/10

[Продолжить →]
```

**Логика:**

1. Создаём все дефолтные категории для выбранного типа использования
2. Выбранные пользователем получают `sort_order = 1, 2, 3...`
3. Невыбранные получают `sort_order = 100, 101, 102...`
4. Категория "Другое" всегда в конце

**Сохраняется в:** `categories` таблица
- `user_id` = ID пользователя
- `is_default = false` (пользовательские)
- `sort_order` = позиция

---

### Шаг 5: Уведомления

**Цель:** Настроить когда и о чём уведомлять

**UI Mini App:**
```
┌─────────────────────────────────────────┐
│  ← Назад          Шаг 5 из 5            │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                         │
│         🔔 Уведомления                  │
│                                         │
│     Какие уведомления хочешь            │
│     получать в Telegram?                │
│                                         │
│     📊 Отчёты                           │
│     ┌─────────────────────────────┐     │
│     │ [ ] Ежедневная сводка       │     │
│     │     (каждый день в 21:00)   │     │
│     │                             │     │
│     │ [✓] Еженедельный отчёт      │     │
│     │     (по воскресеньям)       │     │
│     │                             │     │
│     │ [✓] Месячный отчёт          │     │
│     │     (1 числа каждого месяца)│     │
│     └─────────────────────────────┘     │
│                                         │
│     ⚠️ Предупреждения                   │
│     ┌─────────────────────────────┐     │
│     │ [✓] Превышение бюджета      │     │
│     │     (при 80% и 100%)        │     │
│     │                             │     │
│     │ [✓] Крупные траты           │     │
│     │     (больше 10% бюджета)    │     │
│     └─────────────────────────────┘     │
│                                         │
│     🔄 Напоминания                      │
│     ┌─────────────────────────────┐     │
│     │ [✓] О долгах                │     │
│     │     (за 3 дня до срока)     │     │
│     │                             │     │
│     │ [✓] О подписках             │     │
│     │     (за 3 дня до списания)  │     │
│     └─────────────────────────────┘     │
│                                         │
│     ┌─────────────────────────────┐     │
│     │       Завершить ✓           │     │
│     └─────────────────────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

**Telegram бот:**
```
🔔 Шаг 5 из 5: Уведомления

Какие уведомления хочешь получать?

📊 Отчёты:
[Ежедневная сводка]
[✓ Еженедельный отчёт]
[✓ Месячный отчёт]

⚠️ Предупреждения:
[✓ Превышение бюджета]
[✓ Крупные траты]

🔄 Напоминания:
[✓ О долгах]
[✓ О подписках]

[Завершить настройку ✓]
```

**Логика:**

| Настройка | Ключ | По умолчанию |
|-----------|------|--------------|
| Ежедневная сводка | `daily_summary` | false |
| Еженедельный отчёт | `weekly_report` | true |
| Месячный отчёт | `monthly_report` | true |
| Превышение бюджета | `budget_warning` | true |
| Крупные траты | `large_expense` | true |
| Напоминания о долгах | `debt_reminder` | true |
| Напоминания о подписках | `recurring_reminder` | true |

**Сохраняется в:** `user_preferences.notification_settings` (JSONB)

```json
{
  "daily_summary": false,
  "daily_summary_time": "21:00",
  "weekly_report": true,
  "weekly_report_day": "sunday",
  "monthly_report": true,
  "budget_warning": true,
  "budget_warning_threshold": 80,
  "large_expense": true,
  "large_expense_threshold": 10,
  "debt_reminder": true,
  "debt_reminder_days": 3,
  "recurring_reminder": true,
  "recurring_reminder_days": 3
}
```

---

### Завершение

**UI Mini App:**
```
┌─────────────────────────────────────────┐
│                                         │
│              🎉                         │
│                                         │
│         Всё готово!                     │
│                                         │
│     Твой финансовый помощник            │
│     настроен и готов к работе.          │
│                                         │
│     ┌─────────────────────────────┐     │
│     │ 💰 Валюта: KGS              │     │
│     │ 🎯 Тип: Личные финансы      │     │
│     │ 📊 Бюджет: 50,000 с/мес     │     │
│     │ 📁 Категорий: 8             │     │
│     │ 🔔 Уведомления: вкл         │     │
│     └─────────────────────────────┘     │
│                                         │
│     💡 Совет: напиши мне                │
│        "потратил 500 на кофе"           │
│        и я запишу расход!               │
│                                         │
│     ┌─────────────────────────────┐     │
│     │    Перейти в приложение →   │     │
│     └─────────────────────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

**Telegram бот:**
```
🎉 Отлично! Всё настроено.

Твои настройки:
• 💰 Валюта: KGS
• 🎯 Тип: Личные финансы  
• 📊 Бюджет: 50,000 с/мес
• 📁 Категорий: 8
• 🔔 Уведомления: включены

💡 Полезные команды:
• "потратил 500 на такси" — расход
• "получил 50000 зарплата" — доход
• "отчёт за неделю" — PDF отчёт
• "мои долги" — список долгов

[Открыть приложение 📱]
```

**Действия:**
- `onboarding_completed = true`
- `onboarding_completed_at = NOW()`
- `onboarding_step = 5`
- Переход в Mini App на главный экран

---

## 🗄️ База данных

### Используемые поля в `users`:

| Поле | Тип | Описание |
|------|-----|----------|
| `onboarding_completed` | boolean | Завершён ли онбординг |
| `onboarding_step` | integer | Текущий/последний шаг (0-5) |
| `onboarding_started_at` | timestamp | Когда начал |
| `onboarding_completed_at` | timestamp | Когда завершил |
| `preferred_currency` | varchar | Валюта (KGS/USD/EUR/RUB) |
| `usage_type` | varchar | Тип (personal/business/mixed) |
| `monthly_budget` | numeric | Месячный бюджет |

### Создаваемые записи:

**При завершении Шага 3 (Бюджет):**
```sql
INSERT INTO budgets (user_id, month, budget_amount, currency, budget_type)
VALUES ({user_id}, '{YYYY-MM}', {amount}, '{currency}', 'personal');

-- Для mixed типа:
INSERT INTO budgets (user_id, month, budget_amount, currency, budget_type)
VALUES ({user_id}, '{YYYY-MM}', {personal_amount}, '{currency}', 'personal'),
       ({user_id}, '{YYYY-MM}', {business_amount}, '{currency}', 'business');
```

**При завершении Шага 4 (Категории):**
```sql
INSERT INTO categories (user_id, name, type, icon, color, is_default, sort_order)
VALUES 
  ({user_id}, 'Еда и продукты', 'expense', '🍔', '#EF4444', false, 1),
  ({user_id}, 'Транспорт', 'expense', '🚗', '#3B82F6', false, 2),
  -- ... остальные выбранные
  ({user_id}, 'Развлечения', 'expense', '🎬', '#8B5CF6', false, 100),
  -- ... остальные невыбранные
```

**При завершении Шага 5 (Уведомления):**
```sql
INSERT INTO user_preferences (user_id, notification_settings)
VALUES ({user_id}, '{...json...}')
ON CONFLICT (user_id) DO UPDATE 
SET notification_settings = '{...json...}';
```

---

## 🔄 Логика работы

### Когда показывать онбординг?

```
┌─────────────────────────────────────┐
│ Пользователь открывает Mini App    │
│ или пишет боту                      │
└─────────────────┬───────────────────┘
                  ↓
         ┌───────────────┐
         │ onboarding_   │
         │ completed?    │
         └───────┬───────┘
                 │
        ┌────────┴────────┐
        ↓                 ↓
      false             true
        ↓                 ↓
   ┌─────────┐      ┌─────────┐
   │ Показать│      │ Обычный │
   │онбординг│      │ режим   │
   └─────────┘      └─────────┘
```

### Восстановление прогресса

Если пользователь закрыл приложение посреди онбординга:

```
┌─────────────────────────────────────┐
│ onboarding_completed = false        │
│ onboarding_step = 2                 │
└─────────────────┬───────────────────┘
                  ↓
         Показать с Шага 3
         (где остановился + 1)
```

### Блокировка основного функционала

Пока `onboarding_completed = false`:
- Mini App показывает **только** онбординг
- Бот отвечает **только** на шаги анкеты
- Нельзя записывать транзакции
- Нельзя открыть настройки

---

## ⚙️ Изменение настроек после онбординга

В разделе "Настройки" пользователь может изменить каждый пункт **отдельно**:

```
┌─────────────────────────────────────────┐
│         ⚙️ Настройки                    │
│                                         │
│  📱 Основные                            │
│  ├── 💰 Валюта: KGS           [>]       │
│  ├── 🎯 Тип: Личные           [>]       │
│  └── 📊 Бюджет: 50,000 с      [>]       │
│                                         │
│  📁 Категории                           │
│  └── Управление категориями   [>]       │
│                                         │
│  🔔 Уведомления                         │
│  ├── Отчёты                   [>]       │
│  ├── Предупреждения           [>]       │
│  └── Напоминания              [>]       │
│                                         │
└─────────────────────────────────────────┘
```

При изменении настройки — сразу сохраняется в БД.

---

## 📱 Категории по типам использования

### Personal (Личные финансы)

**Расходы:**
| Иконка | Название | Цвет |
|--------|----------|------|
| 🍔 | Еда и продукты | #EF4444 |
| 🚗 | Транспорт | #3B82F6 |
| 🏠 | Жильё и ЖКХ | #8B5CF6 |
| 📱 | Связь и интернет | #06B6D4 |
| 🎬 | Развлечения | #F59E0B |
| 👕 | Одежда | #EC4899 |
| 💊 | Здоровье | #10B981 |
| 📚 | Образование | #6366F1 |
| ✈️ | Путешествия | #14B8A6 |
| 🎁 | Подарки | #F97316 |
| 💳 | Подписки | #8B5CF6 |
| 📦 | Другое | #6B7280 |

**Доходы:**
| Иконка | Название | Цвет |
|--------|----------|------|
| 💰 | Зарплата | #10B981 |
| 💵 | Подработка | #3B82F6 |
| 🎁 | Подарки | #F97316 |
| 💳 | Кэшбэк | #8B5CF6 |
| 📈 | Инвестиции | #06B6D4 |
| 📦 | Другое | #6B7280 |

### Business (Бизнес)

**Расходы:**
| Иконка | Название | Цвет |
|--------|----------|------|
| 🏢 | Офис и аренда | #8B5CF6 |
| 💻 | Оборудование | #3B82F6 |
| 📢 | Реклама и маркетинг | #F59E0B |
| 👥 | Зарплаты сотрудникам | #10B981 |
| 📋 | Налоги и сборы | #EF4444 |
| 🚗 | Транспорт | #06B6D4 |
| 📱 | Связь и интернет | #14B8A6 |
| 💼 | Представительские | #EC4899 |
| 📦 | Закупки товаров | #F97316 |
| 💳 | Подписки и сервисы | #6366F1 |
| 📦 | Другое | #6B7280 |

**Доходы:**
| Иконка | Название | Цвет |
|--------|----------|------|
| 💰 | Продажи | #10B981 |
| 🛠️ | Услуги | #3B82F6 |
| 📊 | Консалтинг | #8B5CF6 |
| 💵 | Комиссии | #F59E0B |
| 📈 | Инвестиции | #06B6D4 |
| 📦 | Другое | #6B7280 |

### Mixed (Личные + Бизнес)

Все категории из Personal + Business с префиксом:
- `[Л]` для личных
- `[Б]` для бизнеса

Или разделение в UI на две секции.

---

## 🔧 API Endpoints

### GET /api/v1/onboarding/status
Получить статус онбординга пользователя

**Response:**
```json
{
  "completed": false,
  "current_step": 2,
  "started_at": "2025-12-03T10:00:00Z",
  "data": {
    "currency": "KGS",
    "usage_type": null,
    "monthly_budget": null
  }
}
```

### POST /api/v1/onboarding/step/{step_number}
Сохранить данные шага

**Request (step 1):**
```json
{
  "currency": "KGS"
}
```

**Request (step 2):**
```json
{
  "usage_type": "personal"
}
```

**Request (step 3):**
```json
{
  "monthly_budget": 50000,
  "business_budget": null  // только для mixed
}
```

**Request (step 4):**
```json
{
  "selected_categories": ["food", "transport", "housing", "utilities"]
}
```

**Request (step 5):**
```json
{
  "notifications": {
    "daily_summary": false,
    "weekly_report": true,
    "monthly_report": true,
    "budget_warning": true,
    "large_expense": true,
    "debt_reminder": true,
    "recurring_reminder": true
  }
}
```

### POST /api/v1/onboarding/complete
Завершить онбординг

**Response:**
```json
{
  "success": true,
  "message": "Онбординг завершён",
  "redirect": "/home"
}
```

---

## 📋 Чеклист реализации

### Backend
- [ ] Создать эндпоинты онбординга
- [ ] Логика создания категорий по типу
- [ ] Логика создания бюджета
- [ ] Сохранение notification_settings
- [ ] Проверка onboarding_completed в middleware

### Mini App
- [ ] Компонент OnboardingWizard
- [ ] UI для каждого шага
- [ ] Прогресс-бар
- [ ] Анимации переходов
- [ ] Сохранение прогресса
- [ ] Блокировка основного UI

### Telegram бот (n8n)
- [ ] Workflow для онбординга
- [ ] Inline кнопки для каждого шага
- [ ] Сохранение ответов
- [ ] Блокировка других команд

### Настройки
- [ ] UI для изменения каждого пункта
- [ ] Синхронизация с БД

---

*Документ создан: 3 декабря 2025*
*Версия: 1.0*
