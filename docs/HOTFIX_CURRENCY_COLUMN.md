# üîß HOTFIX: Database Currency Column Missing

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ workflow n8n –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞:
```
column "currency" does not exist
```

## üîç –ü—Ä–∏—á–∏–Ω–∞
–í —Ç–≤–æ–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã `expenses` –∏ `income` —Å–æ–∑–¥–∞–Ω—ã –±–µ–∑ –∫–æ–ª–æ–Ω–∫–∏ `currency`. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –µ—Å–ª–∏ –±–∞–∑–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –î–æ–±–∞–≤—å currency –∫–æ–ª–æ–Ω–∫—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏ SQL –º–∏–≥—Ä–∞—Ü–∏—é `HOTFIX_add_currency_column.sql` –≤ —Ç–≤–æ–µ–π Supabase –±–∞–∑–µ:

1. **–û—Ç–∫—Ä–æ–π Supabase Dashboard** ‚Üí SQL Editor
2. **–°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞** `migrations/HOTFIX_add_currency_column.sql`
3. **–í—ã–ø–æ–ª–Ω–∏ SQL –∑–∞–ø—Ä–æ—Å** (–∫–Ω–æ–ø–∫–∞ Run)

–ú–∏–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `currency`
- ‚úÖ –î–æ–±–∞–≤–∏—Ç –µ—ë –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (—Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'KGS')
- ‚úÖ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç –µ—Å–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏ workflow

1. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π** `AnaliziFinance.json` –≤ n8n
2. **–ê–∫—Ç–∏–≤–∏—Ä—É–π workflow**
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π Daily Brief** - —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É expenses:
currency VARCHAR(3) DEFAULT 'KGS'

-- –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É income:
currency VARCHAR(3) DEFAULT 'KGS'
```

### –í workflow:
```sql
-- Get Daily Stats —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
json_build_object(
  'category', category,
  'amount', amount,
  'currency', currency,  -- ‚úÖ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
  'description', description
)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π:

```sql
-- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç:
SELECT 
    table_name,
    column_name,
    data_type,
    column_default
FROM information_schema.columns
WHERE table_name IN ('expenses', 'income')
    AND column_name = 'currency';
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
table_name | column_name | data_type      | column_default
-----------+-------------+----------------+----------------
expenses   | currency    | character varying | 'KGS'::character varying
income     | currency    | character varying | 'KGS'::character varying
```

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ n8n

1. –í—ã–ø–æ–ª–Ω–∏ –Ω–æ–¥—É **Get Daily Stats** –≤—Ä—É—á–Ω—É—é
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤ `expenses_detail` –µ—Å—Ç—å –ø–æ–ª–µ `currency`:
```json
{
  "expenses_detail": [
    {
      "category": "–ø—Ä–æ–¥—É–∫—Ç—ã",
      "amount": 1500,
      "currency": "KGS",  // ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å
      "description": "–ú–∞–≥–∞–∑–∏–Ω"
    }
  ]
}
```

3. –ñ–¥–∏ 21:00 –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ Daily Brief —á–µ—Ä–µ–∑ Telegram

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ú–∏–≥—Ä–∞—Ü–∏—è **–±–µ–∑–æ–ø–∞—Å–Ω–∞** - –Ω–µ —É–¥–∞–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- –î–ª—è —Å—Ç–∞—Ä—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–µ–∑ currency –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–µ—Ñ–æ–ª—Ç **'KGS'**
- –ù–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç–æ–π
- –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

## üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–∞–ª—é—Ç—ã

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- **KGS** (—Å–æ–º) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **USD** (–¥–æ–ª–ª–∞—Ä)
- **EUR** (–µ–≤—Ä–æ)
- **RUB** (—Ä—É–±–ª—å)
- –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ 3-–±—É–∫–≤–µ–Ω–Ω—ã–µ –∫–æ–¥—ã –≤–∞–ª—é—Ç

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:
1. ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π workflow
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤—Å–µ 3 —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–æ–≤ (–Ω–µ–¥–µ–ª—å–Ω—ã–π, –º–µ—Å—è—á–Ω—ã–π, –ø–µ—Ä–∏–æ–¥)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å Daily Brief –≤ 21:00
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–û–¢–û–í –ö –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ
**–î–∞—Ç–∞**: –ù–æ—è–±—Ä—å 2025
**–í–µ—Ä—Å–∏—è**: v2.4.1
