# üìã –ü–ª–∞–Ω –Ω–æ–≤—ã—Ö —Ñ–∏—á v2.5 - –û—Ç—á—ë—Ç—ã + –ü—Ä–æ—Ñ–∏–ª—å + Telegram Menu

## üéØ –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å:
1. **Telegram Menu** - –∫–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Telegram
2. **–ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏
3. **–û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã, –±–µ–∑ PDF)
4. **–ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å** - –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ª—é–±–æ–π –≤–∞–ª—é—Ç–µ, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π

---

## üîß –ü–†–ò–û–†–ò–¢–ï–¢ –ó–ê–î–ê–ß

### –≠—Ç–∞–ø 1: Telegram Menu (30 –º–∏–Ω)
### –≠—Ç–∞–ø 2: –ü—Ä–æ—Ñ–∏–ª—å —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏ (2 —á–∞—Å–∞)
### –≠—Ç–∞–ø 3: –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (1.5 —á–∞—Å–∞)
### –≠—Ç–∞–ø 4: –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å (2 —á–∞—Å–∞)

---

## üì± –≠–¢–ê–ü 1: Telegram Menu Commands

### –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ Menu

**Telegram Bot Menu (–∫–æ–º–∞–Ω–¥—ã /setMyCommands):**

```
start - üöÄ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
profile - üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
help - ‚ùì –ü–æ–º–æ—â—å

üìä –û–¢–ß–Å–¢–´:
report - üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è
weekly - üìÖ –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
monthly - üìÜ –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç
categories - üìÇ –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

üí∞ –§–ò–ù–ê–ù–°–´:
budget - üíµ –ú–æ–π –±—é–¥–∂–µ—Ç
balance - üíé –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å

‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò:
settings - ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
currency - üí± –í–∞–ª—é—Ç—ã
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ n8n

**–î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª: Set Telegram Commands**
```javascript
// Execute once –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ workflow
const commands = [
  {command: 'start', description: 'üöÄ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É'},
  {command: 'profile', description: 'üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'},
  {command: 'help', description: '‚ùì –ü–æ–º–æ—â—å'},
  {command: 'report', description: 'üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è'},
  {command: 'weekly', description: 'üìÖ –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç'},
  {command: 'monthly', description: 'üìÜ –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç'},
  {command: 'categories', description: 'üìÇ –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º'},
  {command: 'budget', description: 'üíµ –ú–æ–π –±—é–¥–∂–µ—Ç'},
  {command: 'balance', description: 'üíé –ë–∞–ª–∞–Ω—Å'},
  {command: 'settings', description: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏'},
  {command: 'currency', description: 'üí± –í–∞–ª—é—Ç—ã'}
];

// Telegram API: setMyCommands
return {commands};
```

---

## ÔøΩ –≠–¢–ê–ü 2: –ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–í–°–Å –í –ö–ù–û–ü–ö–ê–•!)

### –ö–æ–º–∞–Ω–¥–∞ /profile

**–ü—Ä–∏ –≤–≤–æ–¥–µ `/profile` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:**

```
üë§ –ü–†–û–§–ò–õ–¨ - –ß—ã–Ω–≥—ã–∑

üÜî ID: 1109421300
üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: 15.10.2025
üî• –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 45 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üíº –û–°–ù–û–í–ù–û–ï:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí∞ –í–∞–ª—é—Ç–∞: KGS (—Å–æ–º)
üíµ –ë—é–¥–∂–µ—Ç: 50,000 —Å–æ–º/–º–µ—Å—è—Ü
üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 45,600 —Å–æ–º (91%)
üíé –û—Å—Ç–∞–ª–æ—Å—å: 4,400 —Å–æ–º

üåç –°—Ç—Ä–∞–Ω–∞: –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω
üíº –¢–∏–ø: –õ–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã
üìã –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: IT-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìù –û–ø–µ—Ä–∞—Ü–∏–π: 456
üí∏ –†–∞—Å—Ö–æ–¥–æ–≤: 1,234,500 —Å–æ–º
üí∞ –î–æ—Ö–æ–¥–æ–≤: 1,500,000 —Å–æ–º
üìà –ë–∞–ª–∞–Ω—Å: +265,500 —Å–æ–º

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏] [üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]
[üí± –í–∞–ª—é—Ç—ã] [‚ùì –ü–æ–º–æ—â—å]
```

**Inline –∫–Ω–æ–ø–∫–∏:**
- `‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏` ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `ÔøΩüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞` ‚Üí –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `üí± –í–∞–ª—é—Ç—ã` ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç–∞–º–∏
- `‚ùì –ü–æ–º–æ—â—å` ‚Üí –°–ø—Ä–∞–≤–∫–∞

### –ú–µ–Ω—é "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"

**Callback: `settings`**

```
‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò

–í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:

[üíµ –ë—é–¥–∂–µ—Ç] [üíº –¢–∏–ø]
[üåç –°—Ç—Ä–∞–Ω–∞] [üìã –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å]
[üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è] [üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç]

[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é]
```

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞

**Callback: `change_budget`**

```
üíµ –ò–ó–ú–ï–ù–ò–¢–¨ –ë–Æ–î–ñ–ï–¢

–¢–µ–∫—É—â–∏–π –±—é–¥–∂–µ—Ç: 50,000 —Å–æ–º/–º–µ—Å—è—Ü

–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –±—é–¥–∂–µ—Ç (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ):
–ü—Ä–∏–º–µ—Ä: 75000
```

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç:** `75000`

**–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç:**
```
‚úÖ –ë—é–¥–∂–µ—Ç –∏–∑–º–µ–Ω—ë–Ω!

üíµ –ù–æ–≤—ã–π –±—é–¥–∂–µ—Ç: 75,000 —Å–æ–º/–º–µ—Å—è—Ü
üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 45,600 —Å–æ–º (61%)
üíé –û—Å—Ç–∞–ª–æ—Å—å: 29,400 —Å–æ–º

[‚úÖ OK]
```

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞

**Callback: `change_type`**

```
üíº –¢–ò–ü –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

–¢–µ–∫—É—â–∏–π: –õ–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã

–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–∏–ø:

[üë§ –õ–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã]
[üè¢ –ë–∏–∑–Ω–µ—Å]

[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

### –ú–µ–Ω—é "üí± –í–∞–ª—é—Ç—ã" (–ù–û–í–û–ï!)

**Callback: `currencies`**

```
üí± –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ê–õ–Æ–¢–ê–ú–ò

üí∞ –û—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞: KGS (—Å–æ–º)
–í—Å–µ –æ—Ç—á—ë—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —ç—Ç–æ–π –≤–∞–ª—é—Ç–µ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä –ê–ö–¢–ò–í–ù–´–ï –í–ê–õ–Æ–¢–´:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚úÖ KGS - 1,234,500 —Å–æ–º (–æ—Å–Ω–æ–≤–Ω–∞—è)
‚úÖ USD - $5,420 ‚Üí 481,178 —Å–æ–º
‚úÖ EUR - ‚Ç¨1,200 ‚Üí 112,800 —Å–æ–º

üíé –û–±—â–∏–π –±–∞–ª–∞–Ω—Å: 1,828,478 —Å–æ–º

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[üí∞ –°–º–µ–Ω–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –≤–∞–ª—é—Ç—É]
[‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª—é—Ç—É]
[üìä –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç]

[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é]
```

#### –°–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞–ª—é—Ç—ã

**Callback: `change_main_currency`**

```
üí∞ –û–°–ù–û–í–ù–ê–Ø –í–ê–õ–Æ–¢–ê

–í—Å–µ –æ—Ç—á—ë—Ç—ã –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤ —ç—Ç–æ–π –≤–∞–ª—é—Ç–µ.
–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö.

–í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –≤–∞–ª—é—Ç—É:

[üá∞üá¨ KGS (—Å–æ–º)] ‚Üê —Ç–µ–∫—É—â–∞—è
[üá∫üá∏ USD (–¥–æ–ª–ª–∞—Ä)]
[üá™üá∫ EUR (–µ–≤—Ä–æ)]
[üá∑üá∫ RUB (—Ä—É–±–ª—å)]

[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

**–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ USD:**
```
‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞!

üí∞ –ù–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: USD
üí± –ö—É—Ä—Å KGS/USD: 88.80

üìä –í–∞—à –±–∞–ª–∞–Ω—Å —Ç–µ–ø–µ—Ä—å:
  –í USD: $20,600
  (–±—ã–ª–æ: 1,828,478 —Å–æ–º)

‚ÑπÔ∏è –í—Å–µ –Ω–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã –±—É–¥—É—Ç –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö.
–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö.

[‚úÖ OK]
```

### –ú–µ–Ω—é "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"

**Callback: `statistics`**

```
üìä –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

üóìÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞:
  –í—Å–µ–≥–æ –¥–Ω–µ–π: 87
  üî• –ü–æ–¥—Ä—è–¥: 45 –¥–Ω–µ–π
  üìÖ –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: —Å–µ–≥–æ–¥–Ω—è –≤ 14:30

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìù –û–ü–ï–†–ê–¶–ò–ò:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–í—Å–µ–≥–æ: 456 –æ–ø–µ—Ä–∞—Ü–∏–π
  üí∏ –†–∞—Å—Ö–æ–¥–æ–≤: 398 (87%)
  üí∞ –î–æ—Ö–æ–¥–æ–≤: 58 (13%)

–ó–∞ –ø–µ—Ä–∏–æ–¥—ã:
  –°–µ–≥–æ–¥–Ω—è: 5 –æ–ø–µ—Ä–∞—Ü–∏–π
  –ù–µ–¥–µ–ª—è: 34 –æ–ø–µ—Ä–∞—Ü–∏–∏
  –ú–µ—Å—è—Ü: 123 –æ–ø–µ—Ä–∞—Ü–∏–∏

–°—Ä–µ–¥–Ω–∏–µ:
  –í –¥–µ–Ω—å: 5.2 –æ–ø–µ—Ä–∞—Ü–∏–π
  –†–∞—Å—Ö–æ–¥/–¥–µ–Ω—å: 14,200 —Å–æ–º
  –î–æ—Ö–æ–¥/–¥–µ–Ω—å: 17,200 —Å–æ–º

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üèÜ –†–ï–ö–û–†–î–´:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–ú–∞–∫—Å —Ä–∞—Å—Ö–æ–¥: 45,000 —Å–æ–º
  (–∞—Ä–µ–Ω–¥–∞, 01.11.2025)

–ú–∞–∫—Å –¥–æ—Ö–æ–¥: 150,000 —Å–æ–º
  (–∑–∞—Ä–ø–ª–∞—Ç–∞, 30.10.2025)

–°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å: 15.10.2025
  (23 –æ–ø–µ—Ä–∞—Ü–∏–∏)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚è∞ –ê–ö–¢–ò–í–ù–û–°–¢–¨ –ü–û –ß–ê–°–ê–ú:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üåô 00-06: ‚ñì‚ñë‚ñë‚ñë‚ñë 5%
üåÖ 06-12: ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë 35%
‚òÄÔ∏è 12-18: ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë 45%
üåÜ 18-24: ‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 15%

[‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é]
```

---

## üìä –≠–¢–ê–ü 3: –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–ë–ï–ó PDF, —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç)

### –ö–æ–º–∞–Ω–¥–∞ /categories

**–ü—Ä–∏ –≤–≤–æ–¥–µ `/categories` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:**

```
üìÇ –û–¢–ß–Å–¢–´ –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú

–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á—ë—Ç–∞:

[üìä –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏]
[üîç –ü–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏]
[üìà –¢—Ä–µ–Ω–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏]

[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

### 3.1. –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–°—Ä–∞–≤–Ω–µ–Ω–∏–µ)

**Callback: `all_categories`**

```
üìä –í–°–ï –ö–ê–¢–ï–ì–û–†–ò–ò - –ù–æ—è–±—Ä—å 2025

üí∏ –ò—Ç–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤: 45,600 —Å–æ–º

üèÜ –¢–û–ü-10:

1. üçΩÔ∏è –ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω—ã
   üí∏ 12,500 —Å–æ–º (27%) ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
   üìù 23 –æ–ø–µ—Ä–∞—Ü–∏–∏

2. üöï –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
   üí∏ 8,900 —Å–æ–º (19%) ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
   üìù 18 –æ–ø–µ—Ä–∞—Ü–∏–π

3. üõí –ü—Ä–æ–¥—É–∫—Ç—ã
   üí∏ 7,200 —Å–æ–º (16%) ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
   üìù 15 –æ–ø–µ—Ä–∞—Ü–∏–π

4. üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
   üí∏ 5,400 —Å–æ–º (12%) ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
   üìù 12 –æ–ø–µ—Ä–∞—Ü–∏–π

5. üíä –ó–¥–æ—Ä–æ–≤—å–µ
   üí∏ 3,800 —Å–æ–º (8%) ‚îÅ‚îÅ‚îÅ‚îÅ
   üìù 8 –æ–ø–µ—Ä–∞—Ü–∏–π

6. üëï –û–¥–µ–∂–¥–∞
   üí∏ 2,900 —Å–æ–º (6%) ‚îÅ‚îÅ‚îÅ
   üìù 6 –æ–ø–µ—Ä–∞—Ü–∏–π

7. üè† –î–æ–º
   üí∏ 2,100 —Å–æ–º (5%) ‚îÅ‚îÅ
   üìù 4 –æ–ø–µ—Ä–∞—Ü–∏–∏

8. üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
   üí∏ 1,400 —Å–æ–º (3%) ‚îÅ
   üìù 3 –æ–ø–µ—Ä–∞—Ü–∏–∏

9. üéÅ –ü–æ–¥–∞—Ä–∫–∏
   üí∏ 900 —Å–æ–º (2%) ‚ñì
   üìù 2 –æ–ø–µ—Ä–∞—Ü–∏–∏

10. üì± –°–≤—è–∑—å
    üí∏ 500 —Å–æ–º (1%) ‚ñì
    üìù 2 –æ–ø–µ—Ä–∞—Ü–∏–∏

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí° –ê–ù–ê–õ–ò–ó:
–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ç—Ä–∞—Ç–∏—Ç–µ –Ω–∞ –ø–∏—Ç–∞–Ω–∏–µ (40%)
–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (19%). –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–º–∞—à–Ω–µ–µ
–ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏!

[üîç –î–µ—Ç–∞–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏]
[üìà –°—Ä–∞–≤–Ω–∏—Ç—å —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º]

[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

### 3.2. –û—Ç—á—ë—Ç –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**Callback: `category_detail`**

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:
```
üîç –í–´–ë–ï–†–ò–¢–ï –ö–ê–¢–ï–ì–û–†–ò–Æ:

[üçΩÔ∏è –ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω—ã] [üöï –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç]
[üõí –ü—Ä–æ–¥—É–∫—Ç—ã] [üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è]
[üíä –ó–¥–æ—Ä–æ–≤—å–µ] [üëï –û–¥–µ–∂–¥–∞]
[üè† –î–æ–º] [üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ]
[üéÅ –ü–æ–¥–∞—Ä–∫–∏] [üì± –°–≤—è–∑—å]

[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

**–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ "–ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω—ã":**

```
üìä –ö–ê–§–ï/–†–ï–°–¢–û–†–ê–ù–´ - –ù–æ—è–±—Ä—å 2025

üí∏ –ò—Ç–æ–≥–æ: 12,500 —Å–æ–º
üìù –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: 23
üìà –°—Ä–µ–¥–Ω—è—è: 543 —Å–æ–º
üìä –í –¥–µ–Ω—å: 416 —Å–æ–º

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÜ –ü–û–°–õ–ï–î–ù–ò–ï 7 –î–ù–ï–ô:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

06.11 - 1,200 —Å–æ–º (3 –æ–ø–µ—Ä–∞—Ü–∏–∏)
  ‚Ä¢ –û–±–µ–¥ - 450 —Å–æ–º
  ‚Ä¢ –ö–æ—Ñ–µ - 250 —Å–æ–º
  ‚Ä¢ –£–∂–∏–Ω - 500 —Å–æ–º

05.11 - 3,200 —Å–æ–º (6 –æ–ø–µ—Ä–∞—Ü–∏–π)
  ‚Ä¢ –†–µ—Å—Ç–æ—Ä–∞–Ω - 1,800 —Å–æ–º
  ‚Ä¢ –û–±–µ–¥ - 600 —Å–æ–º
  ‚Ä¢ –ö–æ—Ñ–µ - 300 —Å–æ–º
  ‚Ä¢ –ó–∞–≤—Ç—Ä–∞–∫ - 250 —Å–æ–º
  ‚Ä¢ –°–Ω–µ–∫–∏ - 150 —Å–æ–º
  ‚Ä¢ –ö–æ—Ñ–µ - 100 —Å–æ–º

04.11 - 1,800 —Å–æ–º (3 –æ–ø–µ—Ä–∞—Ü–∏–∏)
  ‚Ä¢ –£–∂–∏–Ω - 900 —Å–æ–º
  ‚Ä¢ –û–±–µ–¥ - 550 —Å–æ–º
  ‚Ä¢ –ö–æ—Ñ–µ - 350 —Å–æ–º

03.11 - 2,100 —Å–æ–º (4 –æ–ø–µ—Ä–∞—Ü–∏–∏)
02.11 - 950 —Å–æ–º (2 –æ–ø–µ—Ä–∞—Ü–∏–∏)
01.11 - 1,600 —Å–æ–º (3 –æ–ø–µ—Ä–∞—Ü–∏–∏)
31.10 - 650 —Å–æ–º (2 –æ–ø–µ—Ä–∞—Ü–∏–∏)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí° –°–†–ê–í–ù–ï–ù–ò–ï:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–û–∫—Ç—è–±—Ä—å 2025: 9,800 —Å–æ–º
–ò–∑–º–µ–Ω–µ–Ω–∏–µ: +2,700 —Å–æ–º (+27%) ‚ÜóÔ∏è

–í—ã —Å—Ç–∞–ª–∏ –±–æ–ª—å—à–µ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –∫–∞—Ñ–µ!

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[üìà –¢—Ä–µ–Ω–¥ –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤]
[üîç –î—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é]

[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

### 3.3. –¢—Ä–µ–Ω–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**Callback: `category_trend`**

–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø–æ—Ç–æ–º:

```
üìà –¢–†–ï–ù–î "–ö–ê–§–ï/–†–ï–°–¢–û–†–ê–ù–´"

–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤:

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–ù–æ—è–±—Ä—å 2025
  üí∏ 12,500 —Å–æ–º
  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 100%
  üìà +27% –∫ –æ–∫—Ç—è–±—Ä—é ‚ÜóÔ∏è

–û–∫—Ç—è–±—Ä—å 2025
  üí∏ 9,800 —Å–æ–º
  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 78%
  üìà +5% –∫ —Å–µ–Ω—Ç—è–±—Ä—é ‚ÜóÔ∏è

–°–µ–Ω—Ç—è–±—Ä—å 2025
  üí∏ 9,300 —Å–æ–º
  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 74%
  üìä 0% –∫ –∞–≤–≥—É—Å—Ç—É ‚Üí

–ê–≤–≥—É—Å—Ç 2025
  üí∏ 10,100 —Å–æ–º
  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 81%
  üìâ -10% –∫ –∏—é–ª—é ‚ÜòÔ∏è

–ò—é–ª—å 2025
  üí∏ 11,200 —Å–æ–º
  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 90%
  üìà +26% –∫ –∏—é–Ω—é ‚ÜóÔ∏è

–ò—é–Ω—å 2025
  üí∏ 8,900 —Å–æ–º
  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 71%
  ‚Äî

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìà –°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥: 10,300 —Å–æ–º/–º–µ—Å
üìä –¢–µ–Ω–¥–µ–Ω—Ü–∏—è: –†–∞—Å—Ç—ë—Ç (+35% –∑–∞ 6 –º–µ—Å)
üèÜ –ú–∞–∫—Å–∏–º—É–º: –ù–æ—è–±—Ä—å (12,500 —Å–æ–º)
üìâ –ú–∏–Ω–∏–º—É–º: –ò—é–Ω—å (8,900 —Å–æ–º)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –∫–∞—Ñ–µ —Ä–∞—Å—Ç—É—Ç! üìà
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–º–∞ -
—ç–∫–æ–Ω–æ–º–∏—è –¥–æ 30%!

[üîç –î—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

–ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –ø–æ —Ç–µ–∫—Å—Ç—É:
- `"—Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥—É"` ‚Üí –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
- `"—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∑–∞ –º–µ—Å—è—Ü"`
- `"—Å—Ä–∞–≤–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"`
- `"—Ç—Ä–µ–Ω–¥ –ø–æ –∫–∞—Ñ–µ"`

AI Agent —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–π –æ—Ç—á—ë—Ç.

---
## üí± –≠–¢–ê–ü 4: –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å - –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ò –£–õ–£–ß–®–ï–ù–ò–Ø

### ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (v2.0-v2.4)

**–£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

#### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- `expenses.currency VARCHAR(3)` - —Ö—Ä–∞–Ω–∏—Ç –≤–∞–ª—é—Ç—É –∫–∞–∂–¥–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞
- `income.currency VARCHAR(3)` - —Ö—Ä–∞–Ω–∏—Ç –≤–∞–ª—é—Ç—É –∫–∞–∂–¥–æ–≥–æ –¥–æ—Ö–æ–¥–∞
- `users.preferred_currency VARCHAR(3)` - –æ—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é KGS)
- –¢–∞–±–ª–∏—Ü–∞ `exchange_rates` —Å –∫—É—Ä—Å–∞–º–∏ –≤–∞–ª—é—Ç
- –§—É–Ω–∫—Ü–∏–∏: `get_exchange_rate()`, `convert_amount()`, `get_user_settings()`

#### 2. AI Agent ‚úÖ
- –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–µ—Ç –≤–∞–ª—é—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `{{ $json.preferred_currency || 'KGS' }}`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–∞–ª—é—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞
- –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: **–¥–æ–ª–ª–∞—Ä/USD**, **–µ–≤—Ä–æ/EUR**, **—Ä—É–±–ª—å/RUB**, **—Å–æ–º/KGS**
- –ü—Ä–∏–º–µ—Ä—ã:
  - "–ü–æ—Ç—Ä–∞—Ç–∏–ª 200 –Ω–∞ —Ç–∞–∫—Å–∏" ‚Üí KGS (–≤–∞–ª—é—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - "–ü–æ–ª—É—á–∏–ª 1000 –¥–æ–ª–ª–∞—Ä–æ–≤" ‚Üí USD (—è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–æ)

#### 3. –û–ø–µ—Ä–∞—Ü–∏–∏ CRUD ‚úÖ
- `Add_expense` –∏ `Add_income` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –≤–∞–ª—é—Ç—É –≤ –ë–î
- `RETURNING ... currency` - –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –≤–∞–ª—é—Ç—É –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏
- –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –≤–∞–ª—é—Ç—É

#### 4. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚úÖ
- `Convert_currency` - —Ä—É—á–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ AI ("–°–∫–æ–ª—å–∫–æ 100 –¥–æ–ª–ª–∞—Ä–æ–≤ –≤ —Å–æ–º–∞—Ö?")
- `Get_exchange_rates` - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
- `Parsing_of_the_month` - –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–¥—Å—á—ë—Ç –≤–∞–ª—é—Ç (`currency_count`)

#### 5. Onboarding ‚úÖ
- –®–∞–≥ 2: –≤—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã (KGS, USD, EUR, RUB)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `users.preferred_currency`
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–∏–ª–µ —Å —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã

#### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ
- `docs/MULTICURRENCY_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `docs/RELEASE_v2.1.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–ï–õ–´ (—á—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç)

#### 1. –û—Ç—á—ë—Ç—ã –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–∞–ª—é—Ç—É ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞ –≤ Get Daily Stats:**
```sql
-- –ë–´–õ–û (–ë–ï–ó currency):
json_agg(
  json_build_object(
    'category', category,
    'amount', amount,
    'description', description
  )
) as expenses_detail

-- –ò–°–ü–†–ê–í–õ–ï–ù–û (–° currency):
json_agg(
  json_build_object(
    'category', category,
    'amount', amount,
    'currency', currency,  -- ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    'description', description
  )
) as expenses_detail
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–û: "–ü—Ä–æ–¥—É–∫—Ç—ã: 1500" (–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –∫–∞–∫–∞—è –≤–∞–ª—é—Ç–∞!)
- –ü–û–°–õ–ï: "–ü—Ä–æ–¥—É–∫—Ç—ã: 1500 KGS" –∏–ª–∏ "–ö–∞—Ñ–µ: 50 USD" ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ v2.5

#### 2. –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –æ—Ç—á—ë—Ç–∞—Ö ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û—Ç—á—ë—Ç –∑–∞ –º–µ—Å—è—Ü –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å:
```
–†–∞—Å—Ö–æ–¥—ã: 10,000 KGS + 200 USD + 50 EUR
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∏—Ç–æ–≥!

**–†–µ—à–µ–Ω–∏–µ (–±—É–¥—É—â–µ–µ):**
–î–æ–±–∞–≤–∏—Ç—å CTE –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ `preferred_currency`:
```sql
WITH converted_expenses AS (
  SELECT 
    category,
    amount,
    currency,
    convert_amount(
      amount, 
      currency, 
      (SELECT preferred_currency FROM users WHERE user_id = ...),
      date
    ) as amount_converted
  FROM expenses
  WHERE ...
)
```

**–°—Ç–∞—Ç—É—Å:** üîú –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è v2.6

#### 3. –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ `add_exchange_rates.sql`
- –ù–µ—Ç –≤–æ—Ä–∫—Ñ–ª–æ—É –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- –í–æ—Ä–∫—Ñ–ª–æ—É `ExchangeRates_Daily.json` –£–ñ–ï –°–û–ó–î–ê–ù ‚úÖ
- Cron: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
- API: ExchangeRate-API.com (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
- –û–±–Ω–æ–≤–ª—è–µ—Ç –∫—É—Ä—Å—ã –¥–ª—è KGS, USD, EUR, RUB

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û, –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow

---

### üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è (—É—Ç–æ—á–Ω—ë–Ω–Ω–∞—è)

**–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:**
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –û–î–ù–ê –æ—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ (`preferred_currency`)
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ô –≤–∞–ª—é—Ç–µ
- –û—Ç—á—ë—Ç—ã –ü–û–ö–ê–ó–´–í–ê–Æ–¢ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –≤–∞–ª—é—Ç—É (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ v2.5)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–∞–ª—é—Ç—É - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–±—É–¥—É—â–µ–µ)

### üìù –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ v2.5)

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞/–¥–æ—Ö–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä 1: –í –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∞–ª—é—Ç–µ**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ—Ç—Ä–∞—Ç–∏–ª 500 –Ω–∞ –µ–¥—É"
‚Üí AI –ø–æ–Ω–∏–º–∞–µ—Ç: –≤–∞–ª—é—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞
‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç preferred_currency (KGS)

–ë–æ—Ç:
‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!

üí∏ –°—É–º–º–∞: 500 KGS
üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ø—Ä–æ–¥—É–∫—Ç—ã
üìÖ –î–∞—Ç–∞: 06.11.2025
```

**–ü—Ä–∏–º–µ—Ä 2: –í –¥—Ä—É–≥–æ–π –≤–∞–ª—é—Ç–µ**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ—Ç—Ä–∞—Ç–∏–ª 50 –¥–æ–ª–ª–∞—Ä–æ–≤ –Ω–∞ –µ–¥—É"
‚Üí AI —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç: "–¥–æ–ª–ª–∞—Ä–æ–≤" = USD

–ë–æ—Ç:
‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!

üíµ –°—É–º–º–∞: 50 USD
üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
üìÖ –î–∞—Ç–∞: 06.11.2025

‚ÑπÔ∏è –ö—É—Ä—Å USD: 88.80 KGS (–ø—Ä–∏–º–µ—Ä–Ω–æ 4,440 —Å–æ–º)
```

**–ü—Ä–∏–º–µ—Ä 3: –î–æ—Ö–æ–¥ –≤ –µ–≤—Ä–æ**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ–ª—É—á–∏–ª 1000 –µ–≤—Ä–æ –∑–∞—Ä–ø–ª–∞—Ç–∞"

–ë–æ—Ç:
‚úÖ –î–æ—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!

üí∂ –°—É–º–º–∞: 1,000 EUR
üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –∑–∞—Ä–ø–ª–∞—Ç–∞
üìÖ –î–∞—Ç–∞: 06.11.2025

‚ÑπÔ∏è –ö—É—Ä—Å EUR: 94.20 KGS (–ø—Ä–∏–º–µ—Ä–Ω–æ 94,200 —Å–æ–º)
```

#### –û—Ç—á—ë—Ç—ã (v2.5 —Å –≤–∞–ª—é—Ç–∞–º–∏)

**–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç:**
```
üåô –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è

üí∏ –†–ê–°–•–û–î–´: 12,340 KGS (5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

–î–µ—Ç–∞–ª–∏:
  üçΩÔ∏è –ö–∞—Ñ–µ - 50 USD
  üöï –¢–∞–∫—Å–∏ - 500 RUB  
  üõí –ü—Ä–æ–¥—É–∫—Ç—ã - 4,000 KGS
  üíä –ê–ø—Ç–µ–∫–∞ - 20 EUR
  üì± –°–≤—è–∑—å - 400 KGS

üí∞ –î–û–•–û–î–´: 94,200 KGS
  üíµ –ó–∞—Ä–ø–ª–∞—Ç–∞ - 1,000 EUR

üìà –ë–∞–ª–∞–Ω—Å: +81,860 KGS
```

**–ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç —Å –≤–∞–ª—é—Ç–∞–º–∏:**
```
üìä –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
01.11.2025 - 06.11.2025

üí∏ –†–ê–°–•–û–î–´ –ü–û –î–ù–Ø–ú:

06.11 (–°—Ä): 12,340 KGS
  ‚Ä¢ 50 USD, 500 RUB, 4,000 KGS, 20 EUR, 400 KGS

05.11 (–í—Ç): 8,500 KGS
  ‚Ä¢ 100 USD, 3,000 KGS, 5,500 KGS

04.11 (–ü–Ω): 15,200 KGS
  ‚Ä¢ 15,200 KGS

...
```

#### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–°–∫–æ–ª—å–∫–æ 100 –¥–æ–ª–ª–∞—Ä–æ–≤ –≤ —Å–æ–º–∞—Ö?"

–ë–æ—Ç:
üí± –ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø –í–ê–õ–Æ–¢

üíµ 100 USD ‚Üí üá∞üá¨ KGS

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: 8,880 —Å–æ–º
üìà –ö—É—Ä—Å: 1 USD = 88.80 KGS
üìÖ –î–∞—Ç–∞ –∫—É—Ä—Å–∞: 06.11.2025
üì° –ò—Å—Ç–æ—á–Ω–∏–∫: ExchangeRate-API

‚ÑπÔ∏è –ö—É—Ä—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 10:00
```

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ–∫–∞–∂–∏ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç"

–ë–æ—Ç:
ÔøΩ –ö–£–†–°–´ –í–ê–õ–Æ–¢
üìÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞ 06.11.2025

üíµ –î–æ–ª–ª–∞—Ä ‚Üí –°–æ–º
  1 USD = 88.80 KGS

üí∂ –ï–≤—Ä–æ ‚Üí –°–æ–º
  1 EUR = 94.20 KGS

üí∑ –†—É–±–ª—å ‚Üí –°–æ–º
  1 RUB = 0.95 KGS

üì° –ò—Å—Ç–æ—á–Ω–∏–∫: ExchangeRate-API
‚è∞ –û–±–Ω–æ–≤–ª–µ–Ω–æ: 06.11.2025 10:00
```

---

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ (—É–∂–µ –µ—Å—Ç—å)
CREATE TABLE expenses (
  id SERIAL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  workspace_id BIGINT,
  date DATE NOT NULL,
  category TEXT NOT NULL,
  amount NUMERIC(15,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'KGS' NOT NULL,  -- ‚úÖ –£–ñ–ï –ï–°–¢–¨
  description TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–æ—Ö–æ–¥–æ–≤ (—É–∂–µ –µ—Å—Ç—å)
CREATE TABLE income (
  id SERIAL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  workspace_id BIGINT,
  date DATE NOT NULL,
  category TEXT NOT NULL,
  amount NUMERIC(15,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'KGS' NOT NULL,  -- ‚úÖ –£–ñ–ï –ï–°–¢–¨
  description TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –≤–∞–ª—é—Ç–æ–π (—É–∂–µ –µ—Å—Ç—å)
CREATE TABLE users (
  user_id BIGINT PRIMARY KEY,
  preferred_currency VARCHAR(3) DEFAULT 'KGS',  -- ‚úÖ –£–ñ–ï –ï–°–¢–¨
  ...
);

-- –¢–∞–±–ª–∏—Ü–∞ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç (—É–∂–µ –µ—Å—Ç—å)
CREATE TABLE exchange_rates (
  id SERIAL PRIMARY KEY,
  date DATE NOT NULL,
  from_currency VARCHAR(3) NOT NULL,
  to_currency VARCHAR(3) NOT NULL,
  rate DECIMAL(12, 6) NOT NULL,
  source VARCHAR(100) DEFAULT 'NBKR',
  created_at TIMESTAMP DEFAULT NOW(),
  CONSTRAINT unique_rate_per_day UNIQUE(date, from_currency, to_currency)
);
```

#### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ (—É–∂–µ –µ—Å—Ç—å)
CREATE FUNCTION get_exchange_rate(
  p_from_currency VARCHAR(3),
  p_to_currency VARCHAR(3),
  p_date DATE DEFAULT CURRENT_DATE
) RETURNS DECIMAL(12, 6);

-- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—É–º–º—ã (—É–∂–µ –µ—Å—Ç—å)
CREATE FUNCTION convert_amount(
  p_amount NUMERIC,
  p_from_currency VARCHAR(3),
  p_to_currency VARCHAR(3),
  p_date DATE DEFAULT CURRENT_DATE
) RETURNS NUMERIC(10, 2);

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–∂–µ –µ—Å—Ç—å)
CREATE FUNCTION get_user_settings(p_user_id BIGINT)
RETURNS TABLE (
  user_id BIGINT,
  preferred_currency VARCHAR(3),
  currency_symbol TEXT,
  language_code VARCHAR(10)
);
```

---

### üöÄ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ v2.5

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω Get Daily Stats** - —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç currency –≤ expenses_detail
2. ‚úÖ **Get Weekly Data** - —É–∂–µ –≤–∫–ª—é—á–∞–ª currency, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
3. ‚úÖ **Get Monthly Data** - —É–∂–µ –≤–∫–ª—é—á–∞–ª currency, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
4. ‚úÖ **ExchangeRates_Daily.json** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã credential IDs, –≥–æ—Ç–æ–≤ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

### üîú –ß—Ç–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è v2.6

1. **Auto-convert –≤ –æ—Ç—á—ë—Ç–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
   - –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `show_original_currency` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
   - –ï—Å–ª–∏ FALSE - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë –≤ preferred_currency
   - –ï—Å–ª–∏ TRUE - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –≤–∞–ª—é—Ç—É (—Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

2. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è ExchangeRates_Daily**
   - –í–∫–ª—é—á–∏—Ç—å workflow
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

3. **Analytics API multi-currency**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä `preferred_currency` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
   - Auto-conversion –≤ –æ—Ç–≤–µ—Ç–∞—Ö
   - Breakdown –ø–æ –≤–∞–ª—é—Ç–∞–º

---

### üìä –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

**–î–µ–Ω—å –∏–∑ –∂–∏–∑–Ω–∏ —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä–∞:**

```
09:00 - "–ü–æ–ª—É—á–∏–ª 500 –¥–æ–ª–ª–∞—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞"
‚Üí ‚úÖ –î–æ—Ö–æ–¥: 500 USD

12:00 - "–ü–æ—Ç—Ä–∞—Ç–∏–ª 200 –Ω–∞ –æ–±–µ–¥"  
‚Üí ‚úÖ –†–∞—Å—Ö–æ–¥: 200 KGS (–æ—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞)

15:00 - "–û–ø–ª–∞—Ç–∏–ª 29 –¥–æ–ª–ª–∞—Ä–æ–≤ Netflix"
‚Üí ‚úÖ –†–∞—Å—Ö–æ–¥: 29 USD

18:00 - "–ö—É–ø–∏–ª –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ 3500"
‚Üí ‚úÖ –†–∞—Å—Ö–æ–¥: 3,500 KGS

21:00 - "–ü–æ–∫–∞–∂–∏ –æ—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è"
‚Üí üìä –û—Ç—á—ë—Ç:
     üí∏ –†–∞—Å—Ö–æ–¥—ã: 3,729 KGS (200 KGS + 29 USD + 3,500 KGS)
     üí∞ –î–æ—Ö–æ–¥—ã: 44,400 KGS (500 USD)
     üìà –ë–∞–ª–∞–Ω—Å: +40,671 KGS
     
     –î–µ—Ç–∞–ª–∏ —Å –≤–∞–ª—é—Ç–∞–º–∏:
     ‚Ä¢ –û–±–µ–¥ - 200 KGS
     ‚Ä¢ Netflix - 29 USD
     ‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç—ã - 3,500 KGS
```

---

### ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤** - 30 –º–∏–Ω (–°–î–ï–õ–ê–ù–û)
- ‚úÖ **ExchangeRates credentials** - 15 –º–∏–Ω (–°–î–ï–õ–ê–ù–û)
- üîú **Auto-conversion –≤ –æ—Ç—á—ë—Ç–∞—Ö** - 1 —á–∞—Å (v2.6)
- üîú **–ê–∫—Ç–∏–≤–∞—Ü–∏—è + –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - 30 –º–∏–Ω (v2.6)

**–ò—Ç–æ–≥–æ v2.5:** 45 –º–∏–Ω—É—Ç ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–ò—Ç–æ–≥–æ v2.6:** 1.5 —á–∞—Å–∞ üîú –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
  
  -- –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å
  v_rate := get_exchange_rate(p_currency, v_user_currency, p_date);
  
  -- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
  v_converted_amount := p_amount * v_rate;
  
  -- –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—Ö–æ–¥
  INSERT INTO expenses (
    user_id, workspace_id, amount, currency,
    original_amount, original_currency, exchange_rate,
    category, description, date
  )
  VALUES (
    p_user_id, p_workspace_id, v_converted_amount, v_user_currency,
    p_amount, p_currency, v_rate,
    p_category, p_description, p_date
  )
  RETURNING id INTO v_expense_id;
  
  -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  RETURN QUERY
  SELECT 
    v_expense_id,
    v_converted_amount,
    v_rate,
    v_user_currency;
END;
$$ LANGUAGE plpgsql;
```

### AI Agent –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–û–±–Ω–æ–≤–∏—Ç—å prompt –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≤–∞–ª—é—Ç:**

```javascript
// –í Financial Assistant system prompt
`
...

üìä –í–ê–õ–Æ–¢–´:

–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–π –≤–∞–ª—é—Ç—É –∏–∑ —Ç–µ–∫—Å—Ç–∞:
- "50 –¥–æ–ª–ª–∞—Ä–æ–≤", "$50", "50 usd" ‚Üí USD
- "100 –µ–≤—Ä–æ", "‚Ç¨100", "100 eur" ‚Üí EUR
- "500 —Ä—É–±–ª–µ–π", "500 —Ä—É–±", "500 rub" ‚Üí RUB
- "1000 —Å–æ–º", "1000" ‚Üí KGS (–æ—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞)

–ï—Å–ª–∏ –≤–∞–ª—é—Ç–∞ –ù–ï —É–∫–∞–∑–∞–Ω–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –æ—Å–Ω–æ–≤–Ω—É—é –≤–∞–ª—é—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü–†–ò–ú–ï–†–´:
‚ùå "–ü–æ—Ç—Ä–∞—Ç–∏–ª 50" ‚Üí amount: 50, currency: "" (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è)
‚úÖ "–ü–æ—Ç—Ä–∞—Ç–∏–ª 50 –¥–æ–ª–ª–∞—Ä–æ–≤" ‚Üí amount: 50, currency: "USD"
‚úÖ "–ü–æ–ª—É—á–∏–ª 1000 –µ–≤—Ä–æ" ‚Üí amount: 1000, currency: "EUR"
‚úÖ "–ü–æ—Ç—Ä–∞—Ç–∏–ª $25" ‚Üí amount: 25, currency: "USD"

...
`
```

### n8n Workflow –∏–∑–º–µ–Ω–µ–Ω–∏—è

**1. –û–±–Ω–æ–≤–∏—Ç—å Add_expense node:**

```sql
-- –ë–´–õ–û:
INSERT INTO expenses (user_id, workspace_id, amount, currency, ...)
VALUES ({{ $fromAI("user_id") }}, ...)

-- –°–¢–ê–õ–û:
SELECT * FROM add_expense_multicurrency(
  {{ $fromAI("user_id") }},
  {{ $fromAI("workspace_id") }},
  {{ $fromAI("amount") }},
  {{ $fromAI("currency") || $json.preferred_currency }},
  '{{ $fromAI("category") }}',
  '{{ $fromAI("description") }}',
  ...
);
```

**2. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞:**

```javascript
// –ü–æ—Å–ª–µ Add_expense
const result = $input.first().json;

let message = `‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!\n\n`;

// –ï—Å–ª–∏ –±—ã–ª–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
if (result.original_currency !== result.user_currency) {
  message += `üíµ –°—É–º–º–∞: ${result.original_amount} ${result.original_currency}\n`;
  message += `üí± –ö—É—Ä—Å: 1 ${result.original_currency} = ${result.exchange_rate} ${result.user_currency}\n`;
  message += `üí∞ –í –≤–∞—à–µ–π –≤–∞–ª—é—Ç–µ: ${result.converted_amount} ${result.user_currency}\n\n`;
} else {
  message += `üí∞ –°—É–º–º–∞: ${result.amount} ${result.user_currency}\n\n`;
}

message += `üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${result.category}\n`;
message += `üìÖ –î–∞—Ç–∞: ${formatDate(result.date)}`;

return {message};
```

### –ö–æ–º–∞–Ω–¥–∞ /currency (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏)

```
üí± –ö–£–†–°–´ –í–ê–õ–Æ–¢

üìÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å: 06.11.2025 14:30

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üíµ USD ‚Üí KGS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

  –ü–æ–∫—É–ø–∫–∞: 88.50 —Å–æ–º
  –ü—Ä–æ–¥–∞–∂–∞: 89.10 —Å–æ–º
  –°—Ä–µ–¥–Ω–∏–π: 88.80 —Å–æ–º ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí∂ EUR ‚Üí KGS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

  –ü–æ–∫—É–ø–∫–∞: 93.80 —Å–æ–º
  –ü—Ä–æ–¥–∞–∂–∞: 94.60 —Å–æ–º
  –°—Ä–µ–¥–Ω–∏–π: 94.20 —Å–æ–º ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí∑ RUB ‚Üí KGS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

  –ü–æ–∫—É–ø–∫–∞: 0.77 —Å–æ–º
  –ü—Ä–æ–¥–∞–∂–∞: 0.79 —Å–æ–º
  –°—Ä–µ–¥–Ω–∏–π: 0.78 —Å–æ–º ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚ÑπÔ∏è –ö—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ –∏–∑ –¶–ë –†–§ –∏ –ù–ë–ö–†

[üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å—ã]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

---

## üöÄ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠–¢–ê–ü 1: Telegram Menu (30 –º–∏–Ω) ‚ö° –ë–´–°–¢–†–û

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –°–æ–∑–¥–∞—Ç—å HTTP Request node –∫ Telegram API
2. Endpoint: `setMyCommands`
3. –î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Å–∏–≤ –∫–æ–º–∞–Ω–¥
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ workflow activation

**–ö–æ–¥:**
```javascript
{
  "commands": [
    {"command": "start", "description": "üöÄ –ù–∞—á–∞—Ç—å"},
    {"command": "profile", "description": "üë§ –ü—Ä–æ—Ñ–∏–ª—å"},
    {"command": "help", "description": "‚ùì –ü–æ–º–æ—â—å"},
    {"command": "report", "description": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è"},
    {"command": "weekly", "description": "üìÖ –ù–µ–¥–µ–ª—å–Ω—ã–π"},
    {"command": "monthly", "description": "üìÜ –ú–µ—Å—è—á–Ω—ã–π"},
    {"command": "categories", "description": "üìÇ –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"},
    {"command": "budget", "description": "üíµ –ë—é–¥–∂–µ—Ç"},
    {"command": "balance", "description": "üíé –ë–∞–ª–∞–Ω—Å"},
    {"command": "settings", "description": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"},
    {"command": "currency", "description": "üí± –í–∞–ª—é—Ç—ã"}
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –º–µ–Ω—é –∫–æ–º–∞–Ω–¥ –≤ Telegram!

---

### –≠–¢–ê–ü 2: –ü—Ä–æ—Ñ–∏–ª—å + –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (2 —á–∞—Å–∞) üìä –ü–†–ò–û–†–ò–¢–ï–¢

#### 2.1. SQL —Ñ—É–Ω–∫—Ü–∏–∏ (30 –º–∏–Ω)

```sql
-- 1. migrations/add_profile_functions.sql

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
CREATE OR REPLACE FUNCTION get_full_profile(p_user_id BIGINT)
RETURNS TABLE(...) AS $$
-- —Å–º. –≤—ã—à–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
$$ LANGUAGE plpgsql;

-- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
CREATE OR REPLACE FUNCTION update_user_setting(...)
RETURNS BOOLEAN AS $$
-- —Å–º. –≤—ã—à–µ
$$ LANGUAGE plpgsql;

-- –§—É–Ω–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
CREATE OR REPLACE FUNCTION get_user_statistics(p_user_id BIGINT)
RETURNS TABLE(
  total_operations INT,
  total_expenses NUMERIC,
  total_income NUMERIC,
  net_balance NUMERIC,
  active_days INT,
  current_streak INT,
  max_expense NUMERIC,
  max_expense_desc TEXT,
  max_expense_date DATE,
  max_income NUMERIC,
  max_income_desc TEXT,
  max_income_date DATE,
  most_active_day DATE,
  most_active_count INT
) AS $$
BEGIN
  RETURN QUERY
  WITH stats AS (
    -- –ø–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  )
  SELECT * FROM stats;
END;
$$ LANGUAGE plpgsql;
```

#### 2.2. n8n —É–∑–ª—ã (45 –º–∏–Ω)

**–î–æ–±–∞–≤–∏—Ç—å –≤ Message Type Switch:**
```json
{
  "conditions": [{
    "leftValue": "={{ $json.message.text }}",
    "rightValue": "^(/profile|–ø—Ä–æ—Ñ–∏–ª—å|–Ω–∞—Å—Ç—Ä–æ–π–∫–∏|/settings)",
    "operator": {"type": "string", "operation": "regex"}
  }],
  "outputKey": "Profile"
}
```

**–ù–æ–≤—ã–µ —É–∑–ª—ã:**
1. **Get Full Profile** (PostgreSQL)
2. **Format Profile Message** (Code)
3. **Send Profile** (Telegram) —Å inline keyboard
4. **Handle Profile Callbacks** (Webhook/Callback Query)
5. **Process Setting Change** (Code + PostgreSQL)

#### 2.3. Inline –∫–Ω–æ–ø–∫–∏ (30 –º–∏–Ω)

```javascript
// Format Profile Message node
const data = $input.first().json;

const keyboard = {
  inline_keyboard: [
    [
      {text: "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", callback_data: "settings"},
      {text: "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data: "statistics"}
    ],
    [
      {text: "üí± –í–∞–ª—é—Ç—ã", callback_data: "currencies"},
      {text: "‚ùì –ü–æ–º–æ—â—å", callback_data: "help"}
    ]
  ]
};

const message = `
üë§ –ü–†–û–§–ò–õ–¨ - ${data.first_name}

üÜî ID: ${data.user_id}
üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${formatDate(data.created_at)}
üî• –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${data.current_streak} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üíº –û–°–ù–û–í–ù–û–ï:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí∞ –í–∞–ª—é—Ç–∞: ${data.preferred_currency}
üíµ –ë—é–¥–∂–µ—Ç: ${formatMoney(data.monthly_budget)}/–º–µ—Å—è—Ü
üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${data.budget_used} (${data.budget_percent}%)
üíé –û—Å—Ç–∞–ª–æ—Å—å: ${formatMoney(data.budget_remaining)}

üåç –°—Ç—Ä–∞–Ω–∞: ${data.country}
üíº –¢–∏–ø: ${data.usage_type === 'personal' ? '–õ–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã' : '–ë–∏–∑–Ω–µ—Å'}
üìã –î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${data.occupation}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìù –û–ø–µ—Ä–∞—Ü–∏–π: ${data.total_transactions}
üí∏ –†–∞—Å—Ö–æ–¥–æ–≤: ${formatMoney(data.total_expenses)}
üí∞ –î–æ—Ö–æ–¥–æ–≤: ${formatMoney(data.total_income)}
üìà –ë–∞–ª–∞–Ω—Å: ${formatMoney(data.net_balance, true)}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
`.trim();

return {
  message: message,
  keyboard: keyboard
};
```

#### 2.4. Callback handlers (15 –º–∏–Ω)

**Handle Profile Callbacks node:**
```javascript
const callback = $input.first().json.callback_query;
const data = callback.data;

switch(data) {
  case 'settings':
    return {action: 'show_settings'};
  case 'statistics':
    return {action: 'show_statistics'};
  case 'currencies':
    return {action: 'show_currencies'};
  case 'change_budget':
    return {action: 'ask_budget'};
  // ... –∏ —Ç.–¥.
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏!

---

### –≠–¢–ê–ü 3: –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (1.5 —á–∞—Å–∞) üìÇ

#### 3.1. SQL —Ñ—É–Ω–∫—Ü–∏–∏ (40 –º–∏–Ω)

```sql
-- migrations/add_category_reports.sql

-- –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
CREATE OR REPLACE FUNCTION compare_categories(...)
-- —Å–º. –≤—ã—à–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ

-- –î–µ—Ç–∞–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
CREATE OR REPLACE FUNCTION get_category_report(...)
-- —Å–º. –≤—ã—à–µ

-- –¢—Ä–µ–Ω–¥
CREATE OR REPLACE FUNCTION get_category_trend(...)
-- —Å–º. –≤—ã—à–µ
```

#### 3.2. n8n —É–∑–ª—ã (30 –º–∏–Ω)

1. –î–æ–±–∞–≤–∏—Ç—å –≤ Switch: `/categories`
2. **Show Categories Menu** (Telegram) —Å –∫–Ω–æ–ø–∫–∞–º–∏
3. **Get Category Report** (PostgreSQL)
4. **Format Category Report** (Code/AI)
5. **Send Category Report** (Telegram)

#### 3.3. AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (20 –º–∏–Ω)

–û–±–Ω–æ–≤–∏—Ç—å Financial Assistant prompt:
```
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç:
- "—Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥—É", "—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç" 
  ‚Üí –≤—ã–∑—ã–≤–∞–π Get_category_report —Å category="..."
  
- "—Å—Ä–∞–≤–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", "—Ç–æ–ø —Ä–∞—Å—Ö–æ–¥–æ–≤"
  ‚Üí –≤—ã–∑—ã–≤–∞–π Compare_categories
  
- "—Ç—Ä–µ–Ω–¥ –ø–æ –∫–∞—Ñ–µ", "–¥–∏–Ω–∞–º–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"
  ‚Üí –≤—ã–∑—ã–≤–∞–π Get_category_trend
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º!

---

### –≠–¢–ê–ü 4: –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å (2 —á–∞—Å–∞) üí± –°–õ–û–ñ–ù–û

#### 4.1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (30 –º–∏–Ω)

```sql
-- migrations/add_multicurrency.sql

-- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏
ALTER TABLE expenses
ADD COLUMN original_currency VARCHAR(3) DEFAULT 'KGS',
ADD COLUMN original_amount NUMERIC(15,2),
ADD COLUMN exchange_rate NUMERIC(10,4) DEFAULT 1.0;

ALTER TABLE income
ADD COLUMN original_currency VARCHAR(3) DEFAULT 'KGS',
ADD COLUMN original_amount NUMERIC(15,2),
ADD COLUMN exchange_rate NUMERIC(10,4) DEFAULT 1.0;

-- –§—É–Ω–∫—Ü–∏–∏ –∫—É—Ä—Å–æ–≤
CREATE OR REPLACE FUNCTION get_exchange_rate(...)
-- —Å–º. –≤—ã—à–µ

CREATE OR REPLACE FUNCTION add_expense_multicurrency(...)
-- —Å–º. –≤—ã—à–µ

CREATE OR REPLACE FUNCTION add_income_multicurrency(...)
-- –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ expense
```

#### 4.2. AI Agent –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (20 –º–∏–Ω)

–û–±–Ω–æ–≤–∏—Ç—å prompt:
```
üìä –í–ê–õ–Æ–¢–´:

–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–π –≤–∞–ª—é—Ç—É –∏–∑ —Ç–µ–∫—Å—Ç–∞:
- "50 –¥–æ–ª–ª–∞—Ä–æ–≤", "$50" ‚Üí currency: "USD", amount: 50
- "100 –µ–≤—Ä–æ", "‚Ç¨100" ‚Üí currency: "EUR", amount: 100
- "500 —Ä—É–±–ª–µ–π" ‚Üí currency: "RUB", amount: 500
- "1000 —Å–æ–º" ‚Üí currency: "KGS", amount: 1000
- "1000" ‚Üí currency: "" (–ø—É—Å—Ç–∞—è = –æ—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞)

–í–ê–ñ–ù–û: 
- currency - –≤—Å–µ–≥–¥–∞ 3 –±—É–∫–≤—ã: USD, EUR, RUB, KGS
- –ï—Å–ª–∏ –≤–∞–ª—é—Ç–∞ –ù–ï —É–∫–∞–∑–∞–Ω–∞ ‚Üí –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É ""
```

#### 4.3. –û–±–Ω–æ–≤–∏—Ç—å Add_expense/Add_income (30 –º–∏–Ω)

```sql
-- –í Add_expense node
-- –ë–´–õ–û:
INSERT INTO expenses (...)

-- –°–¢–ê–õ–û:
SELECT * FROM add_expense_multicurrency(
  {{ $fromAI("user_id") }},
  {{ $fromAI("workspace_id") }},
  {{ $fromAI("amount") }},
  CASE 
    WHEN '{{ $fromAI("currency") }}' = '' 
      THEN '{{ $json.preferred_currency }}'
    ELSE '{{ $fromAI("currency") }}'
  END,
  '{{ $fromAI("category") }}',
  '{{ $fromAI("description") }}',
  {{ date_expression }}
);
```

#### 4.4. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (20 –º–∏–Ω)

```javascript
// –ü–æ—Å–ª–µ Add_expense
const result = $input.first().json;
const hasConversion = result.original_currency !== result.user_currency;

let message = `‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!\n\n`;

if (hasConversion) {
  message += `üíµ –°—É–º–º–∞: ${result.original_amount} ${result.original_currency}\n`;
  message += `üí± –ö—É—Ä—Å: 1 ${result.original_currency} = ${result.exchange_rate} ${result.user_currency}\n`;
  message += `üí∞ –í –≤–∞—à–µ–π –≤–∞–ª—é—Ç–µ: ${result.converted_amount} ${result.user_currency}\n\n`;
} else {
  message += `üí∞ –°—É–º–º–∞: ${result.amount} ${result.user_currency}\n\n`;
}

message += `üìÇ ${result.category}\n`;
message += `üìÖ ${formatDate(result.date)}`;

return {message};
```

#### 4.5. –ö–æ–º–∞–Ω–¥–∞ /currency (20 –º–∏–Ω)

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –∫—É—Ä—Å—ã –∏–∑ `exchange_rates` —Ç–∞–±–ª–∏—Ü—ã.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç–∏!

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: Telegram Menu ‚ö°
- [ ] –°–æ–∑–¥–∞—Ç—å HTTP Request –∫ `setMyCommands`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram
- [ ] **–í—Ä–µ–º—è: 30 –º–∏–Ω**

### –≠—Ç–∞–ø 2: –ü—Ä–æ—Ñ–∏–ª—å üìä
- [ ] –°–æ–∑–¥–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ (get_full_profile, update_user_setting, get_user_statistics)
- [ ] –î–æ–±–∞–≤–∏—Ç—å Switch case –¥–ª—è /profile
- [ ] –°–æ–∑–¥–∞—Ç—å —É–∑–µ–ª Get Full Profile
- [ ] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å inline –∫–Ω–æ–ø–∫–∞–º–∏
- [ ] Callback Query Handler
- [ ] –ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞
- [ ] –ú–µ–Ω—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏
- [ ] **–í—Ä–µ–º—è: 2 —á–∞—Å–∞**

### –≠—Ç–∞–ø 3: –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º üìÇ
- [ ] –°–æ–∑–¥–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ (compare_categories, get_category_report, get_category_trend)
- [ ] –î–æ–±–∞–≤–∏—Ç—å Switch case –¥–ª—è /categories
- [ ] –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [ ] –û—Ç—á—ë—Ç "–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
- [ ] –û—Ç—á—ë—Ç –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- [ ] –¢—Ä–µ–Ω–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å AI Agent –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—Ç—á—ë—Ç—ã
- [ ] **–í—Ä–µ–º—è: 1.5 —á–∞—Å–∞**

### –≠—Ç–∞–ø 4: –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å üí±
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (–¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏)
- [ ] SQL —Ñ—É–Ω–∫—Ü–∏–∏ (get_exchange_rate, add_expense_multicurrency, add_income_multicurrency)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å AI Agent prompt (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Add_expense node
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Add_income node
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] –ö–æ–º–∞–Ω–¥–∞ /currency
- [ ] –ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç–∞–º–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –æ—Ç—á—ë—Ç—ã (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏
- [ ] **–í—Ä–µ–º—è: 2 —á–∞—Å–∞**

---

## üéØ –ò–¢–û–ì–û–í–û–ï –í–†–ï–ú–Ø

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –°—Ç–∞—Ç—É—Å |
|------|-------|--------|
| 1. Telegram Menu | 30 –º–∏–Ω | ‚è≥ TODO |
| 2. –ü—Ä–æ—Ñ–∏–ª—å | 2 —á–∞—Å–∞ | ‚è≥ TODO |
| 3. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ | 1.5 —á–∞—Å–∞ | ‚è≥ TODO |
| 4. –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å (fixes) | 45 –º–∏–Ω | ‚úÖ DONE v2.5 |
| **–í–°–ï–ì–û v2.5** | **4 —á–∞—Å–∞ 45 –º–∏–Ω** | **45 –º–∏–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–æ** |

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ v2.5 (–º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å) ‚úÖ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (45 –º–∏–Ω—É—Ç):**
- ‚úÖ Get Daily Stats - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `currency` –≤ expenses_detail
- ‚úÖ Get Weekly Data - –ø—Ä–æ–≤–µ—Ä–∫–∞ currency (—É–∂–µ –±—ã–ª–æ)
- ‚úÖ Get Monthly Data - –ø—Ä–æ–≤–µ—Ä–∫–∞ currency (—É–∂–µ –±—ã–ª–æ)
- ‚úÖ ExchangeRates_Daily.json - –æ–±–Ω–æ–≤–ª–µ–Ω—ã credential IDs
- ‚úÖ FEATURES_PLAN_v2.5.md - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–¢–µ–ø–µ—Ä—å –≤—Å–µ –æ—Ç—á—ë—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –≤–∞–ª—é—Ç—É –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏!

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å (TODO)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 - CORE (4 —á–∞—Å–∞):**
1. ‚ö° Telegram Menu (30 –º–∏–Ω) - –±—ã—Å—Ç—Ä–∞—è –ø–æ–±–µ–¥–∞
2. üî• –ü—Ä–æ—Ñ–∏–ª—å (2 —á–∞—Å–∞) - –±–∞–∑–æ–≤–∞—è —Ñ–∏—á–∞
3. üî• –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (1.5 —á–∞—Å–∞) - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 - ENHANCEMENTS (v2.6, 1.5 —á–∞—Å–∞):**
4. üí± Auto-conversion –≤ –æ—Ç—á—ë—Ç–∞—Ö (1 —á–∞—Å)
5. üîÑ –ê–∫—Ç–∏–≤–∞—Ü–∏—è ExchangeRates workflow (30 –º–∏–Ω)

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ v2.5:**
1. ‚ö° Telegram Menu (30 –º–∏–Ω) - –±—ã—Å—Ç—Ä–∞—è –ø–æ–±–µ–¥–∞
2. üî• –ü—Ä–æ—Ñ–∏–ª—å (2 —á–∞—Å–∞) - –±–∞–∑–æ–≤–∞—è —Ñ–∏—á–∞  
3. üî• –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (1.5 —á–∞—Å–∞) - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–ú–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —Å–µ—Å—Å–∏–∏:**
- **–°–µ—Å—Å–∏—è 1 (2.5—á):** Menu + –ü—Ä–æ—Ñ–∏–ª—å
- **–°–µ—Å—Å–∏—è 2 (1.5—á):** –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- **–ò—Ç–æ–≥–æ v2.5:** 4 —á–∞—Å–∞

**–î–∞–ª—å—à–µ (v2.6, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- **–°–µ—Å—Å–∏—è 3 (1.5—á):** –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å enhancements

---

üí∏ –ò—Ç–æ–≥–æ: 12,500 —Å–æ–º
üìù –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: 23
üìà –°—Ä–µ–¥–Ω–µ–µ: 543 —Å–æ–º –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
üìä –°—Ä–µ–¥–Ω–µ–µ –≤ –¥–µ–Ω—å: 416 —Å–æ–º

üìÜ –ü–æ –¥–Ω—è–º:
  05.11 - 3,200 —Å–æ–º (6 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
  04.11 - 1,800 —Å–æ–º (3 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
  03.11 - 2,100 —Å–æ–º (4 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
  ...

üí° –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º:
  –û–∫—Ç—è–±—Ä—å: 9,800 —Å–æ–º
  –ò–∑–º–µ–Ω–µ–Ω–∏–µ: +27% ‚ÜóÔ∏è

üìå –¢–æ–ø-5 –¥–Ω–µ–π:
  1. 05.11 - 3,200 —Å–æ–º
  2. 03.11 - 2,100 —Å–æ–º
  ...
```

#### 1.2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
**–ö–æ–º–∞–Ω–¥—ã:**
- `"—Å—Ä–∞–≤–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"` ‚Üí –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞ –º–µ—Å—è—Ü
- `"—Ç–æ–ø —Ä–∞—Å—Ö–æ–¥–æ–≤"` ‚Üí —Ç–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
```
üìä –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ - –ù–æ—è–±—Ä—å 2025

üí∏ –ò—Ç–æ–≥–æ: 45,600 —Å–æ–º

üèÜ –¢–û–ü-5:
  1. üçΩÔ∏è –ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω—ã - 12,500 —Å–æ–º (27%)
  2. üöï –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç - 8,900 —Å–æ–º (19%)
  3. üõí –ü—Ä–æ–¥—É–∫—Ç—ã - 7,200 —Å–æ–º (16%)  —Ä—Ä–∏
  4. üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è - 5,400 —Å–æ–º (12%)
  5. üíä –ó–¥–æ—Ä–æ–≤—å–µ - 3,800 —Å–æ–º (8%)

üìà –û—Å—Ç–∞–ª—å–Ω–æ–µ: 7,800 —Å–æ–º (18%)

üí° –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ç—Ä–∞—Ç–∏—Ç–µ –Ω–∞ –ø–∏—Ç–∞–Ω–∏–µ –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç!
```

#### 1.3. –¢—Ä–µ–Ω–¥—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
**–ö–æ–º–∞–Ω–¥—ã:**
- `"—Ç—Ä–µ–Ω–¥ –ø–æ –µ–¥–µ"` ‚Üí –¥–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3-6 –º–µ—Å—è—Ü–µ–≤
- `"–≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"`

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
```
üìà –¢—Ä–µ–Ω–¥ "–ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω—ã"

üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤:

  –ù–æ—è–±—Ä—å 2025: 12,500 —Å–æ–º ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ (+27%)
  –û–∫—Ç—è–±—Ä—å 2025:  9,800 —Å–æ–º ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ (+5%)
  –°–µ–Ω—Ç—è–±—Ä—å 2025: 9,300 —Å–æ–º ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  –ê–≤–≥—É—Å—Ç 2025:   10,100 —Å–æ–º ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  –ò—é–ª—å 2025:     11,200 —Å–æ–º ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  –ò—é–Ω—å 2025:     8,900 —Å–æ–º ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìä –°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥: 10,300 —Å–æ–º/–º–µ—Å
üìà –¢–µ–Ω–¥–µ–Ω—Ü–∏—è: –†–∞—Å—Ç—ë—Ç (+35% –∑–∞ 6 –º–µ—Å)
üí° –°–æ–≤–µ—Ç: –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–º–∞—à–Ω–µ–µ –ø–∏—Ç–∞–Ω–∏–µ!
```

### SQL Queries –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

```sql
-- 1. –û—Ç—á—ë—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
CREATE OR REPLACE FUNCTION get_category_report(
  p_user_id BIGINT,
  p_category TEXT,
  p_start_date DATE,
  p_end_date DATE
)
RETURNS TABLE(
  total_amount NUMERIC,
  transaction_count INT,
  avg_transaction NUMERIC,
  daily_avg NUMERIC,
  expenses_by_day JSONB,
  prev_period_total NUMERIC,
  prev_period_change NUMERIC
) AS $$
BEGIN
  RETURN QUERY
  WITH current_period AS (
    SELECT 
      COALESCE(SUM(amount), 0) as total,
      COUNT(*) as count,
      COALESCE(AVG(amount), 0) as avg_trans,
      json_agg(
        json_build_object(
          'date', TO_CHAR(date, 'DD.MM.YYYY'),
          'amount', amount,
          'description', description
        ) ORDER BY date DESC
      ) as details
    FROM expenses
    WHERE user_id = p_user_id
      AND category = p_category
      AND date BETWEEN p_start_date AND p_end_date
      AND deleted_at IS NULL
  ),
  prev_period AS (
    SELECT COALESCE(SUM(amount), 0) as total
    FROM expenses
    WHERE user_id = p_user_id
      AND category = p_category
      AND date BETWEEN (p_start_date - (p_end_date - p_start_date))
                   AND (p_start_date - INTERVAL '1 day')
      AND deleted_at IS NULL
  )
  SELECT 
    cp.total,
    cp.count::INT,
    cp.avg_trans,
    cp.total / NULLIF((p_end_date - p_start_date + 1), 0),
    cp.details::JSONB,
    pp.total,
    CASE 
      WHEN pp.total > 0 THEN ROUND(((cp.total - pp.total) / pp.total) * 100, 1)
      ELSE 0
    END
  FROM current_period cp
  CROSS JOIN prev_period pp;
END;
$$ LANGUAGE plpgsql;

-- 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
CREATE OR REPLACE FUNCTION compare_categories(
  p_user_id BIGINT,
  p_start_date DATE,
  p_end_date DATE
)
RETURNS TABLE(
  category TEXT,
  total_amount NUMERIC,
  transaction_count INT,
  percentage NUMERIC
) AS $$
BEGIN
  RETURN QUERY
  WITH total AS (
    SELECT COALESCE(SUM(amount), 0) as sum
    FROM expenses
    WHERE user_id = p_user_id
      AND date BETWEEN p_start_date AND p_end_date
      AND deleted_at IS NULL
  )
  SELECT 
    e.category,
    SUM(e.amount) as total,
    COUNT(*)::INT as count,
    ROUND((SUM(e.amount) / NULLIF(t.sum, 0)) * 100, 1) as pct
  FROM expenses e
  CROSS JOIN total t
  WHERE e.user_id = p_user_id
    AND e.date BETWEEN p_start_date AND p_end_date
    AND e.deleted_at IS NULL
  GROUP BY e.category, t.sum
  ORDER BY total DESC;
END;
$$ LANGUAGE plpgsql;

-- 3. –¢—Ä–µ–Ω–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
CREATE OR REPLACE FUNCTION get_category_trend(
  p_user_id BIGINT,
  p_category TEXT,
  p_months INT DEFAULT 6
)
RETURNS TABLE(
  month_date DATE,
  month_name TEXT,
  total_amount NUMERIC,
  transaction_count INT,
  change_percent NUMERIC
) AS $$
BEGIN
  RETURN QUERY
  WITH monthly_data AS (
    SELECT 
      DATE_TRUNC('month', date)::DATE as month,
      TO_CHAR(date, 'Month YYYY') as month_label,
      SUM(amount) as total,
      COUNT(*) as count
    FROM expenses
    WHERE user_id = p_user_id
      AND category = p_category
      AND date >= (NOW() - (p_months || ' months')::INTERVAL)
      AND deleted_at IS NULL
    GROUP BY DATE_TRUNC('month', date), TO_CHAR(date, 'Month YYYY')
    ORDER BY month DESC
  ),
  with_prev AS (
    SELECT 
      *,
      LAG(total) OVER (ORDER BY month) as prev_total
    FROM monthly_data
  )
  SELECT 
    month,
    month_label,
    total,
    count::INT,
    CASE 
      WHEN prev_total > 0 THEN ROUND(((total - prev_total) / prev_total) * 100, 1)
      ELSE 0
    END
  FROM with_prev
  ORDER BY month DESC;
END;
$$ LANGUAGE plpgsql;
```

### n8n Workflow –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–ù–æ–≤—ã–µ —É–∑–ª—ã:**

1. **Switch: Category Commands**
   - Pattern: `"—Ä–∞—Å—Ö–æ–¥—ã –Ω–∞|—Ç—Ä–∞—Ç—ã –Ω–∞|–æ—Ç—á–µ—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"`
   - –í—ã—Ö–æ–¥: Category Report Flow

2. **Extract Category Name** (Code node)
   ```javascript
   const text = $input.first().json.message.text.toLowerCase();
   
   // –ú–∞–ø–ø–∏–Ω–≥ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   const categoryMap = {
     '–µ–¥—É': '–∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã',
     '–µ–¥–∞': '–∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã',
     '–ø–∏—Ç–∞–Ω–∏–µ': '–∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã',
     '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç': '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
     '—Ç–∞–∫—Å–∏': '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
     '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è': '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',
     '–∑–¥–æ—Ä–æ–≤—å–µ': '–∑–¥–æ—Ä–æ–≤—å–µ',
     '–∞–ø—Ç–µ–∫–∞': '–∑–¥–æ—Ä–æ–≤—å–µ'
   };
   
   // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
   let category = null;
   for (const [key, value] of Object.entries(categoryMap)) {
     if (text.includes(key)) {
       category = value;
       break;
     }
   }
   
   // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–∏–æ–¥
   const hasMonth = text.includes('–∑–∞ –º–µ—Å—è—Ü') || text.includes('–º–µ—Å—è—Ü');
   const startDate = hasMonth 
     ? `DATE_TRUNC('month', CURRENT_DATE)` 
     : `CURRENT_DATE - INTERVAL '30 days'`;
   
   return {
     category: category || '–≤—Å–µ',
     start_date: startDate,
     end_date: 'CURRENT_DATE',
     period_type: hasMonth ? 'month' : '30_days'
   };
   ```

3. **Get Category Report** (PostgreSQL)
   ```sql
   SELECT * FROM get_category_report(
     {{ $json.user_id }},
     '{{ $json.category }}',
     {{ $json.start_date }},
     {{ $json.end_date }}
   );
   ```

4. **Format Category Report** (AI Agent)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ SQL
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á—ë—Ç —Å —ç–º–æ–¥–∑–∏

---

## üë§ –ß–ê–°–¢–¨ 2: –ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

#### 2.1. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è
**–ö–æ–º–∞–Ω–¥—ã:**
- `"–ø—Ä–æ—Ñ–∏–ª—å"` / `"/profile"`
- `"–º–æ–π –ø—Ä–æ—Ñ–∏–ª—å"`
- `"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏"`

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
```
üë§ –ü–†–û–§–ò–õ–¨

üÜî ID: 1109421300
üëã –ò–º—è: –ß—ã–Ω–≥—ã–∑
üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: 15.10.2025

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üíº –¢–∏–ø: –õ–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã
üí∞ –í–∞–ª—é—Ç–∞: KGS (—Å–æ–º)
üíµ –ú–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç: 50,000 —Å–æ–º
üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 45,600 —Å–æ–º (91%)

üåç –°—Ç—Ä–∞–Ω–∞: –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω
üíº –†–æ–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: IT-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìù –í—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π: 456
üí∏ –í—Å–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤: 1,234,500 —Å–æ–º
üí∞ –í—Å–µ–≥–æ –¥–æ—Ö–æ–¥–æ–≤: 1,500,000 —Å–æ–º
üìà –ß–∏—Å—Ç—ã–π –±–∞–ª–∞–Ω—Å: +265,500 —Å–æ–º

üóìÔ∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 45 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ üî•

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚öôÔ∏è –ò–ó–ú–ï–ù–ò–¢–¨:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚Ä¢ –í–∞–ª—é—Ç–∞ ‚Üí /change_currency
‚Ä¢ –ë—é–¥–∂–µ—Ç ‚Üí /set_budget
‚Ä¢ –¢–∏–ø ‚Üí /change_type
‚Ä¢ –°—Ç—Ä–∞–Ω–∞ ‚Üí /change_country

‚ùì –ü–æ–º–æ—â—å ‚Üí /help
```

#### 2.2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã
**–ö–æ–º–∞–Ω–¥—ã:**
- `"/change_currency"`
- `"–ø–æ–º–µ–Ω—è—Ç—å –≤–∞–ª—é—Ç—É"`

**–ü—Ä–æ—Ü–µ—Å—Å:**
```
1. –ë–æ—Ç: "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É:"
   [KGS] [USD] [EUR] [RUB]

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É

3. –ë–æ—Ç: "‚úÖ –í–∞–ª—é—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ USD
        üí± –ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º"
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ü—Ä–∏ —Å–º–µ–Ω–µ –≤–∞–ª—é—Ç—ã –Ω—É–∂–Ω–æ:
- –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫—É—Ä—Å—ã
- –û–±–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç
- –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

#### 2.3. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞
**–ö–æ–º–∞–Ω–¥—ã:**
- `"/set_budget"`
- `"–∏–∑–º–µ–Ω–∏—Ç—å –±—é–¥–∂–µ—Ç"`
- `"–±—é–¥–∂–µ—Ç 60000"` ‚Üí —Å—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç

**–ü—Ä–æ—Ü–µ—Å—Å:**
```
1. –ë–æ—Ç: "üí∞ –¢–µ–∫—É—â–∏–π –±—é–¥–∂–µ—Ç: 50,000 —Å–æ–º
        
        –£–∫–∞–∂–∏—Ç–µ –Ω–æ–≤—ã–π –±—é–¥–∂–µ—Ç (–≤ —Å–æ–º):
        –ü—Ä–∏–º–µ—Ä: 60000"

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "75000"

3. –ë–æ—Ç: "‚úÖ –ë—é–¥–∂–µ—Ç –∏–∑–º–µ–Ω—ë–Ω: 75,000 —Å–æ–º/–º–µ—Å—è—Ü
        
        üìä –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 45,600 —Å–æ–º (61%)
        üíµ –û—Å—Ç–∞–ª–æ—Å—å: 29,400 —Å–æ–º"
```

#### 2.4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
**–ö–æ–º–∞–Ω–¥—ã:**
- `"—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"`
- `"–º–æ—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"`

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ê–ö–¢–ò–í–ù–û–°–¢–ò

üóìÔ∏è –í—Å–µ–≥–æ –¥–Ω–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: 87
üî• –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–¥—Ä—è–¥: 45 –¥–Ω–µ–π

üìù –û–ü–ï–†–ê–¶–ò–ò:
  –í—Å–µ–≥–æ: 456
  –†–∞—Å—Ö–æ–¥–æ–≤: 398 (87%)
  –î–æ—Ö–æ–¥–æ–≤: 58 (13%)
  
üìÖ –ü–û –ü–ï–†–ò–û–î–ê–ú:
  –ó–∞ —Å–µ–≥–æ–¥–Ω—è: 5 –æ–ø–µ—Ä–∞—Ü–∏–π
  –ó–∞ –Ω–µ–¥–µ–ª—é: 34 –æ–ø–µ—Ä–∞—Ü–∏–∏
  –ó–∞ –º–µ—Å—è—Ü: 123 –æ–ø–µ—Ä–∞—Ü–∏–∏

üìà –°–†–ï–î–ù–ò–ï:
  –û–ø–µ—Ä–∞—Ü–∏–π –≤ –¥–µ–Ω—å: 5.2
  –†–∞—Å—Ö–æ–¥–æ–≤ –≤ –¥–µ–Ω—å: 14,200 —Å–æ–º
  –î–æ—Ö–æ–¥–æ–≤ –≤ –¥–µ–Ω—å: 17,200 —Å–æ–º

üèÜ –†–ï–ö–û–†–î–´:
  –ú–∞–∫—Å —Ä–∞—Å—Ö–æ–¥: 45,000 —Å–æ–º (–∞—Ä–µ–Ω–¥–∞, 01.11)
  –ú–∞–∫—Å –¥–æ—Ö–æ–¥: 150,000 —Å–æ–º (–∑–∞—Ä–ø–ª–∞—Ç–∞, 30.10)
  –°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å: 15.10 (23 –æ–ø–µ—Ä–∞—Ü–∏–∏)

‚è∞ –ê–ö–¢–ò–í–ù–û–°–¢–¨ –ü–û –ß–ê–°–ê–ú:
  üåô 00-06: 5%
  üåÖ 06-12: 35%
  ‚òÄÔ∏è 12-18: 45%
  üåÜ 18-24: 15%
```

### SQL –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è

```sql
-- 1. –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE FUNCTION get_full_profile(p_user_id BIGINT)
RETURNS TABLE(
  user_id BIGINT,
  first_name TEXT,
  username TEXT,
  telegram_chat_id BIGINT,
  preferred_currency TEXT,
  usage_type TEXT,
  monthly_budget NUMERIC,
  country TEXT,
  occupation TEXT,
  created_at TIMESTAMPTZ,
  last_activity TIMESTAMPTZ,
  onboarding_completed BOOLEAN,
  -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  total_transactions INT,
  total_expenses NUMERIC,
  total_income NUMERIC,
  net_balance NUMERIC,
  active_days INT,
  current_streak INT
) AS $$
BEGIN
  RETURN QUERY
  WITH stats AS (
    SELECT 
      COUNT(DISTINCT e.id) + COUNT(DISTINCT i.id) as tx_count,
      COALESCE(SUM(e.amount), 0) as expenses,
      COALESCE(SUM(i.amount), 0) as income,
      COUNT(DISTINCT DATE(e.created_at)) + COUNT(DISTINCT DATE(i.created_at)) as days
    FROM users u
    LEFT JOIN expenses e ON e.user_id = u.user_id AND e.deleted_at IS NULL
    LEFT JOIN income i ON i.user_id = u.user_id AND i.deleted_at IS NULL
    WHERE u.user_id = p_user_id
  ),
  streak AS (
    SELECT COUNT(*) as current_streak
    FROM (
      SELECT DATE(created_at) as activity_date
      FROM expenses
      WHERE user_id = p_user_id AND deleted_at IS NULL
      UNION
      SELECT DATE(created_at)
      FROM income
      WHERE user_id = p_user_id AND deleted_at IS NULL
    ) dates
    WHERE activity_date >= CURRENT_DATE - INTERVAL '365 days'
    GROUP BY activity_date
    ORDER BY activity_date DESC
  )
  SELECT 
    u.user_id,
    u.first_name,
    u.username,
    u.telegram_chat_id,
    u.preferred_currency,
    u.usage_type,
    b.budget_amount,
    u.country,
    u.occupation,
    u.created_at,
    u.last_activity,
    u.onboarding_completed,
    s.tx_count::INT,
    s.expenses,
    s.income,
    (s.income - s.expenses),
    s.days::INT,
    COALESCE(st.current_streak, 0)::INT
  FROM users u
  LEFT JOIN budgets b ON b.user_id = u.user_id 
    AND b.month = TO_CHAR(CURRENT_DATE, 'YYYY-MM')
  CROSS JOIN stats s
  LEFT JOIN streak st ON true
  WHERE u.user_id = p_user_id;
END;
$$ LANGUAGE plpgsql;

-- 2. –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
CREATE OR REPLACE FUNCTION update_user_setting(
  p_user_id BIGINT,
  p_setting TEXT,
  p_value TEXT
)
RETURNS BOOLEAN AS $$
BEGIN
  CASE p_setting
    WHEN 'currency' THEN
      UPDATE users 
      SET preferred_currency = p_value,
          updated_at = NOW()
      WHERE user_id = p_user_id;
      
    WHEN 'budget' THEN
      INSERT INTO budgets (user_id, month, budget_amount, currency)
      VALUES (p_user_id, TO_CHAR(CURRENT_DATE, 'YYYY-MM'), p_value::NUMERIC, 
              (SELECT preferred_currency FROM users WHERE user_id = p_user_id))
      ON CONFLICT (user_id, month) 
      DO UPDATE SET budget_amount = p_value::NUMERIC;
      
    WHEN 'usage_type' THEN
      UPDATE users 
      SET usage_type = p_value,
          updated_at = NOW()
      WHERE user_id = p_user_id;
      
    WHEN 'country' THEN
      UPDATE users 
      SET country = p_value,
          updated_at = NOW()
      WHERE user_id = p_user_id;
      
    ELSE
      RETURN FALSE;
  END CASE;
  
  RETURN TRUE;
END;
$$ LANGUAGE plpgsql;
```

### n8n Workflow –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è

**–ù–æ–≤—ã–µ —É–∑–ª—ã:**

1. **Switch: Profile Commands**
   - Pattern: `"^(–ø—Ä–æ—Ñ–∏–ª—å|profile|–Ω–∞—Å—Ç—Ä–æ–π–∫–∏|settings|/profile)"`
   - –í—ã—Ö–æ–¥: Get Profile Flow

2. **Get Full Profile** (PostgreSQL)
   ```sql
   SELECT * FROM get_full_profile({{ $json.user_id }});
   ```

3. **Format Profile** (Code + Telegram)
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –î–æ–±–∞–≤–ª—è–µ—Ç inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

4. **Handle Settings Change** (Callback Query Handler)
   - –õ–æ–≤–∏—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –í—ã–∑—ã–≤–∞–µ—Ç `update_user_setting()`

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–ø—Ä–æ—â–µ)

1. –°–æ–∑–¥–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ (30 –º–∏–Ω)
2. –î–æ–±–∞–≤–∏—Ç—å Switch case –¥–ª—è –∫–æ–º–∞–Ω–¥ (10 –º–∏–Ω)
3. –°–æ–∑–¥–∞—Ç—å Extract Category node (20 –º–∏–Ω)
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Get Category Report (10 –º–∏–Ω)
5. –°–æ–∑–¥–∞—Ç—å AI —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (20 –º–∏–Ω)
6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30 –º–∏–Ω)

**–ò—Ç–æ–≥–æ: ~2 —á–∞—Å–∞**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ü—Ä–æ—Ñ–∏–ª—å (—Å–ª–æ–∂–Ω–µ–µ)

1. –°–æ–∑–¥–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏–∏ (40 –º–∏–Ω)
2. –î–æ–±–∞–≤–∏—Ç—å Switch case –¥–ª—è /profile (10 –º–∏–Ω)
3. –°–æ–∑–¥–∞—Ç—å Get Full Profile node (10 –º–∏–Ω)
4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å inline –∫–Ω–æ–ø–∫–∞–º–∏ (30 –º–∏–Ω)
5. Callback Query Handler (40 –º–∏–Ω)
6. –§–æ—Ä–º—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (60 –º–∏–Ω)
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30 –º–∏–Ω)

**–ò—Ç–æ–≥–æ: ~3.5 —á–∞—Å–∞**

---

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ–º —Å–Ω–∞—á–∞–ª–∞?

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ù–∞—á–∞—Ç—å —Å –ü—Ä–æ—Ñ–∏–ª—è**

**–ü–æ—á–µ–º—É:**
1. –ü—Ä–æ—Ñ–∏–ª—å –±–∞–∑–æ–≤–∞—è —Ñ–∏—á–∞ - –Ω—É–∂–Ω–∞ –≤—Å–µ–º
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ
3. –ü—Ä–æ—â–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
4. –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Ç–æ–º

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º**
- –ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- –ë–æ–ª—å—à–µ –ø–æ–ª—å–∑—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è

1. **–ö–∞–∫—É—é —Ñ–∏—á—É –¥–µ–ª–∞–µ–º –ø–µ—Ä–≤–æ–π?**
   - [ ] –ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - [ ] –û—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

2. **–î–ª—è –æ—Ç—á—ë—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**
   - –ù—É–∂–Ω—ã –ª–∏ PDF-–æ—Ç—á—ë—Ç—ã –∏–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–µ–∫—Å—Ç–∞?
   - –ù—É–∂–Ω—ã –ª–∏ –≥—Ä–∞—Ñ–∏–∫–∏/—á–∞—Ä—Ç—ã?

3. **–î–ª—è –ø—Ä–æ—Ñ–∏–ª—è:**
   - –ù—É–∂–Ω–∞ –ª–∏ —Å–º–µ–Ω–∞ –≤–∞–ª—é—Ç—ã —Å –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º —Å—Ç–∞—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π?
   - –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö?

4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ—Ñ–∏–ª—è:**
   - [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è
   - [ ] –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞
   - [ ] –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã
   - [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

**–ß—Ç–æ –¥—É–º–∞–µ—à—å? –° —á–µ–≥–æ –Ω–∞—á–Ω—ë–º?** üöÄ
