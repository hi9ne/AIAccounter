# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞—Ç (v2.4.2)

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞—Å—Ö–æ–¥—ã –∑–∞–ø–∏—Å—ã–≤–∞–ª–∏—Å—å —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π (–Ω–∞ –¥–µ–Ω—å —Ä–∞–Ω—å—à–µ)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 
- –£–±—Ä–∞–Ω–∞ —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏–∑ –ø—Ä–æ–º–ø—Ç–∞ AI
- –ò–∑–º–µ–Ω–µ–Ω SQL: `CURRENT_DATE` ‚Üí `(NOW() AT TIME ZONE 'Asia/Bishkek')::DATE`

## –®–∞–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ workflow

```bash
# –í n8n:
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow "AnaliziFinance"
# 2. –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –µ–≥–æ
# 3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å–Ω–æ–≤–∞

# –ò–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ n8n:
docker restart n8n
# –∏–ª–∏
npm run start
```

### 2. –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:

```sql
-- –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π
DELETE FROM expenses 
WHERE user_id = 1109421300 
  AND date = '2025-11-04' 
  AND amount = 500;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö timezone
SELECT 
  CURRENT_DATE as current_date_utc,
  (NOW() AT TIME ZONE 'Asia/Bishkek')::DATE as current_date_bishkek,
  NOW() AT TIME ZONE 'UTC' as now_utc,
  NOW() AT TIME ZONE 'Asia/Bishkek' as now_bishkek;
```

### 3. –¢–µ—Å—Ç 1: –†–∞—Å—Ö–æ–¥ –±–µ–∑ –¥–∞—Ç—ã

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:**
```
–ü–æ—Ç—Ä–∞—Ç–∏–ª 150 –Ω–∞ –æ–±–µ–¥
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç: "‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω: 150 KGS –Ω–∞ '–∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã' (**05.11.2025**)"
- –î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è** (05.11.2025)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ:**
```sql
SELECT 
  id,
  date,
  TO_CHAR(date, 'DD.MM.YYYY') as formatted_date,
  amount,
  description,
  created_at AT TIME ZONE 'Asia/Bishkek' as created_at_bishkek
FROM expenses
WHERE user_id = 1109421300
ORDER BY id DESC
LIMIT 1;
```

**–û–∂–∏–¥–∞–µ–º–æ:**
```
date         | formatted_date | amount | description
-------------+----------------+--------+-------------
2025-11-05   | 05.11.2025     | 150    | –æ–±–µ–¥
```

### 4. –¢–µ—Å—Ç 2: –î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:**
```
–û—Ç—á–µ—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üìä –û—Ç—á–µ—Ç –∑–∞ 05.11.2025

üìâ –†–ê–°–•–û–î–´
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üçΩÔ∏è –∫–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã: 150 KGS

üí∞ –ò–¢–û–ì–ò
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã: 150 —Å–æ–º
–û–±—â–∏–µ –¥–æ—Ö–æ–¥—ã: 0 —Å–æ–º
–ë–∞–ª–∞–Ω—Å: -150 —Å–æ–º
```

- –†–∞—Å—Ö–æ–¥ –Ω–∞ **–æ–±–µ–¥ (150 KGS)** –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
- –î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞: **05.11.2025**

### 5. –¢–µ—Å—Ç 3: –î–æ—Ö–æ–¥ –±–µ–∑ –¥–∞—Ç—ã

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:**
```
–ü–æ–ª—É—á–∏–ª 5000 –∑–∞—Ä–ø–ª–∞—Ç–∞
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç: "‚úÖ –î–æ—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω: 5000 KGS –Ω–∞ '–∑–∞—Ä–ø–ª–∞—Ç–∞' (**05.11.2025**)"
- –î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è**

### 6. –¢–µ—Å—Ç 4: –†–∞—Å—Ö–æ–¥ —Å —è–≤–Ω–æ–π –¥–∞—Ç–æ–π

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:**
```
–ü–æ—Ç—Ä–∞—Ç–∏–ª 300 –Ω–∞ —Ç–∞–∫—Å–∏ 03.11.2025
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç: "‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω: 300 KGS –Ω–∞ '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç' (**03.11.2025**)"
- –î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **03.11.2025** (–∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ:**
```sql
SELECT date, amount, description
FROM expenses
WHERE user_id = 1109421300 AND date = '2025-11-03'
ORDER BY id DESC LIMIT 1;
```

**–û–∂–∏–¥–∞–µ–º–æ:**
```
date       | amount | description
-----------+--------+-------------
2025-11-03 | 300    | —Ç–∞–∫—Å–∏
```

### 7. –¢–µ—Å—Ç 5: –û—Ç—á–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:**
```
–û—Ç—á–µ—Ç —Å 03.11 –ø–æ 05.11
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–µ—Ä–∏–æ–¥: **3 –¥–Ω—è**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ 03.11, 04.11 (–µ—Å–ª–∏ –µ—Å—Ç—å), 05.11
- –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:
  - –†–∞—Å—Ö–æ–¥ –Ω–∞ —Ç–∞–∫—Å–∏: 300 KGS (03.11)
  - –†–∞—Å—Ö–æ–¥ –Ω–∞ –æ–±–µ–¥: 150 KGS (05.11)
  - –î–æ—Ö–æ–¥ –∑–∞—Ä–ø–ª–∞—Ç–∞: 5000 KGS (05.11)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ timezone

```sql
-- –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

-- 1. –î–æ—Å—Ç—É–ø–Ω—ã–µ timezone
SELECT name 
FROM pg_timezone_names 
WHERE name LIKE '%Bishkek%' OR name LIKE '%Almaty%'
ORDER BY name;

-- 2. –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
SELECT 
  NOW() as now_utc,
  NOW() AT TIME ZONE 'Asia/Bishkek' as now_bishkek,
  CURRENT_DATE as current_date_utc,
  (NOW() AT TIME ZONE 'Asia/Bishkek')::DATE as current_date_bishkek;

-- 3. –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥—ã —Å timezone
SELECT 
  id,
  date,
  TO_CHAR(date, 'DD.MM.YYYY') as formatted_date,
  amount,
  created_at,
  created_at AT TIME ZONE 'Asia/Bishkek' as created_at_bishkek
FROM expenses
WHERE user_id = 1109421300
ORDER BY created_at DESC
LIMIT 5;
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ timezone

–ï—Å–ª–∏ `Asia/Bishkek` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤ `AnaliziFinance.json` –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞:

```sql
-- –í–∞—Ä–∏–∞–Ω—Ç 1: UTC offset
(NOW() AT TIME ZONE 'UTC+6')::DATE

-- –í–∞—Ä–∏–∞–Ω—Ç 2: Etc timezone (–º–∏–Ω—É—Å!)
(NOW() AT TIME ZONE 'Etc/GMT-6')::DATE

-- –í–∞—Ä–∏–∞–Ω—Ç 3: Almaty (—Å–æ—Å–µ–¥–Ω–∏–π, UTC+6)
(NOW() AT TIME ZONE 'Asia/Almaty')::DATE
```

## Checklist ‚úÖ

- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω workflow –≤ n8n
- [ ] –£–¥–∞–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π
- [ ] –¢–µ—Å—Ç 1: –†–∞—Å—Ö–æ–¥ –±–µ–∑ –¥–∞—Ç—ã ‚Üí –¥–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è ‚úÖ
- [ ] –¢–µ—Å—Ç 2: –î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç ‚Üí —Ä–∞—Å—Ö–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ‚úÖ
- [ ] –¢–µ—Å—Ç 3: –î–æ—Ö–æ–¥ –±–µ–∑ –¥–∞—Ç—ã ‚Üí –¥–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è ‚úÖ
- [ ] –¢–µ—Å—Ç 4: –†–∞—Å—Ö–æ–¥ —Å —è–≤–Ω–æ–π –¥–∞—Ç–æ–π ‚Üí –¥–∞—Ç–∞ –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ ‚úÖ
- [ ] –¢–µ—Å—Ç 5: –û—Ç—á–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥ ‚Üí –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ –º–µ—Å—Ç–∞—Ö ‚úÖ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ timezone –≤ –±–∞–∑–µ ‚úÖ

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞—Ç–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ workflow –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `AnaliziFinance.json` —Å–æ—Ö—Ä–∞–Ω–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ timezone –≤ SQL:
   ```sql
   SHOW timezone;
   SELECT (NOW() AT TIME ZONE 'Asia/Bishkek')::DATE;
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "invalid time zone"

**–†–µ—à–µ–Ω–∏–µ:**
–ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π timezone:
```sql
(NOW() AT TIME ZONE 'UTC+6')::DATE
```

### –ü—Ä–æ–±–ª–µ–º–∞: AI –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–∑ –ø—Ä–æ–º–ø—Ç–∞ —É–±—Ä–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å `{{ new Date()... }}`
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à n8n:
   ```bash
   docker exec n8n sh -c "rm -rf /home/node/.n8n/cache/*"
   docker restart n8n
   ```

## –°—Ç–∞—Ç—É—Å

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

---

**–î–∞—Ç–∞:** 05.11.2025  
**–í–µ—Ä—Å–∏—è:** v2.4.2-hotfix  
**–§–∞–π–ª—ã:** AnaliziFinance.json, HOTFIX_date_timezone.sql, HOTFIX_DATE_TIMEZONE.md
