<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Accounter - –¢–µ—Å—Ç</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .status.success { color: #10B981; }
        .status.error { color: #EF4444; }
        .status.warning { color: #F59E0B; }
        button {
            background: #6366F1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5146E5;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üß™ AI Accounter - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º</p>
    </div>

    <div class="card">
        <h2>üìã –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div id="system-info"></div>
    </div>

    <div class="card">
        <h2>üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ API</h2>
        <button onclick="testAPI()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API</button>
        <button onclick="testWebhooks()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Webhooks</button>
        <div id="api-results"></div>
    </div>

    <div class="card">
        <h2>üéÆ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π</h2>
        <button onclick="openMiniApp()">–û—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <div class="card">
        <h2>üìä –õ–æ–≥–∏</h2>
        <pre id="logs"></pre>
    </div>

    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        let logs = [];
        
        function addLog(type, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            logs.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            updateLogsDisplay();
            
            // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            if (type === 'log') originalLog(...args);
            else if (type === 'error') originalError(...args);
            else if (type === 'warn') originalWarn(...args);
        }
        
        console.log = (...args) => addLog('log', ...args);
        console.error = (...args) => addLog('error', ...args);
        console.warn = (...args) => addLog('warn', ...args);
        
        function updateLogsDisplay() {
            document.getElementById('logs').textContent = logs.slice(-20).join('\n');
        }
        
        function clearLogs() {
            logs = [];
            updateLogsDisplay();
        }
        
        // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        function loadSystemInfo() {
            const info = document.getElementById('system-info');
            const isTelegram = !!window.Telegram?.WebApp;
            const userAgent = navigator.userAgent;
            
            info.innerHTML = `
                <div class="status ${isTelegram ? 'success' : 'error'}">
                    <span>${isTelegram ? '‚úÖ' : '‚ùå'}</span>
                    <span>Telegram WebApp API: ${isTelegram ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}</span>
                </div>
                <div class="status">
                    <span>üåê</span>
                    <span>User Agent: ${userAgent}</span>
                </div>
                <div class="status">
                    <span>üì±</span>
                    <span>Viewport: ${window.innerWidth}x${window.innerHeight}</span>
                </div>
            `;
        }
        
        // –¢–µ—Å—Ç API
        async function testAPI() {
            const results = document.getElementById('api-results');
            results.innerHTML = '<p>‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...</p>';
            
            const tests = [
                {
                    name: 'Main Webhook',
                    url: 'https://hi9neee.app.n8n.cloud/webhook/miniapp',
                    payload: { userId: 123456789, action: 'test' }
                },
                {
                    name: 'Workspace API',
                    url: 'https://hi9neee.app.n8n.cloud/webhook/workspace-api',
                    payload: { userId: 123456789, action: 'get_user_workspaces' }
                },
                {
                    name: 'Analytics API',
                    url: 'https://hi9neee.app.n8n.cloud/webhook/analytics-api',
                    payload: { userId: 123456789, action: 'get_income_expense_stats', period: 'month' }
                }
            ];
            
            let html = '<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤:</h3>';
            
            for (const test of tests) {
                try {
                    console.log(`üß™ Testing ${test.name}...`);
                    const response = await fetch(test.url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(test.payload)
                    });
                    
                    const status = response.status;
                    const statusClass = status === 200 ? 'success' : status === 404 ? 'error' : 'warning';
                    const statusIcon = status === 200 ? '‚úÖ' : status === 404 ? '‚ùå' : '‚ö†Ô∏è';
                    
                    html += `
                        <div class="status ${statusClass}">
                            <span>${statusIcon}</span>
                            <span>${test.name}: HTTP ${status}</span>
                        </div>
                    `;
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log(`‚úÖ ${test.name} response:`, data);
                    } else {
                        console.error(`‚ùå ${test.name} failed: HTTP ${status}`);
                    }
                } catch (error) {
                    html += `
                        <div class="status error">
                            <span>‚ùå</span>
                            <span>${test.name}: ${error.message}</span>
                        </div>
                    `;
                    console.error(`‚ùå ${test.name} error:`, error);
                }
            }
            
            results.innerHTML = html;
        }
        
        async function testWebhooks() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö webhooks...');
            const webhooks = [
                'https://hi9neee.app.n8n.cloud/webhook/miniapp',
                'https://hi9neee.app.n8n.cloud/webhook/workspace-api',
                'https://hi9neee.app.n8n.cloud/webhook/analytics-api',
                'https://hi9neee.app.n8n.cloud/webhook/reports-api'
            ];
            
            for (const webhook of webhooks) {
                try {
                    const response = await fetch(webhook, { method: 'GET' });
                    console.log(`${webhook}: HTTP ${response.status}`);
                } catch (error) {
                    console.error(`${webhook}: ${error.message}`);
                }
            }
        }
        
        function openMiniApp() {
            if (window.Telegram?.WebApp) {
                window.location.href = 'index.html';
            } else {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –µ—Å–ª–∏ –Ω–µ –≤ Telegram
                window.open('index.html', '_blank');
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadSystemInfo);
        
        console.log('üß™ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    </script>
</body>
</html>