<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIAccounter - –£–º–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
    
    <!-- Scripts -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="app-container">
        
        <!-- üè† HOME / DASHBOARD -->
        <div id="home-screen" class="screen active">
            <!-- Header —Å –±–∞–ª–∞–Ω—Å–æ–º -->
            <div class="dashboard-header">
                <div class="balance-card">
                    <div class="balance-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                    <div class="balance-amount" id="total-balance">0 </div>
                    <div class="balance-change">
                        <span class="change-positive" id="balance-change">+0%</span>
                        <span class="change-period">–∑–∞ –º–µ—Å—è—Ü</span>
                    </div>
                </div>
                
                <div class="quick-stats">
                    <div class="stat-item income">
                        <i class="fas fa-arrow-up"></i>
                        <div class="stat-content">
                            <span class="stat-label">–î–æ—Ö–æ–¥—ã</span>
                            <span class="stat-value" id="income-value">0 </span>
                        </div>
                    </div>
                    <div class="stat-item expense">
                        <i class="fas fa-arrow-down"></i>
                        <div class="stat-content">
                            <span class="stat-label">–†–∞—Å—Ö–æ–¥—ã</span>
                            <span class="stat-value" id="expense-value">0 </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions-grid">
                <button class="action-btn primary" onclick="openAddTransaction('income')">
                    <i class="fas fa-plus"></i>
                    <span>–î–æ—Ö–æ–¥</span>
                </button>
                <button class="action-btn secondary" onclick="openAddTransaction('expense')">
                    <i class="fas fa-minus"></i>
                    <span>–†–∞—Å—Ö–æ–¥</span>
                </button>
                <button class="action-btn tertiary" onclick="switchScreen('analytics')">
                    <i class="fas fa-chart-line"></i>
                    <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                </button>
                <button class="action-btn quaternary" onclick="switchScreen('reports')">
                    <i class="fas fa-file-invoice"></i>
                    <span>–û—Ç—á—ë—Ç—ã</span>
                </button>
            </div>

            <!-- Recent Transactions -->
            <div class="section">
                <div class="section-header">
                    <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
                    <button class="link-btn" onclick="switchScreen('history')">–í—Å–µ</button>
                </div>
                <div id="recent-transactions" class="transactions-list">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- üìä ANALYTICS SCREEN -->
        <div id="analytics-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="switchScreen('home')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
                <div class="header-actions">
                    <select id="analytics-period" class="period-select" onchange="loadAnalytics()">
                        <option value="week">–ù–µ–¥–µ–ª—è</option>
                        <option value="month" selected>–ú–µ—Å—è—Ü</option>
                        <option value="quarter">–ö–≤–∞—Ä—Ç–∞–ª</option>
                        <option value="year">–ì–æ–¥</option>
                    </select>
                </div>
            </div>

            <div class="screen-content">
                <!-- Metric Cards -->
                <div class="metrics-grid">
                    <div class="metric-card gradient-1">
                        <div class="metric-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">–î–æ—Ö–æ–¥—ã</span>
                            <span class="metric-value" id="total-income">0 </span>
                        </div>
                    </div>
                    <div class="metric-card gradient-2">
                        <div class="metric-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">–†–∞—Å—Ö–æ–¥—ã</span>
                            <span class="metric-value" id="total-expenses">0 </span>
                        </div>
                    </div>
                    <div class="metric-card gradient-3">
                        <div class="metric-icon">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">–ù–∞–∫–æ–ø–ª–µ–Ω–æ</span>
                            <span class="metric-value" id="net-balance">0 </span>
                        </div>
                    </div>
                    <div class="metric-card gradient-4">
                        <div class="metric-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</span>
                            <span class="metric-value" id="savings-rate">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="chart-card">
                    <h3><i class="fas fa-chart-line"></i> –î–æ—Ö–æ–¥—ã vs –†–∞—Å—Ö–æ–¥—ã</h3>
                    <canvas id="incomeExpenseChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                    <canvas id="categoryPieChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3><i class="fas fa-chart-area"></i> –î–∏–Ω–∞–º–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∞</h3>
                    <canvas id="balanceTrendChart"></canvas>
                </div>

                <!-- Top Categories -->
                <div class="section">
                    <h3><i class="fas fa-fire"></i> –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
                    <div id="top-categories-list" class="categories-list">
                        <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- üë• TEAM SCREEN -->
        <div id="team-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="switchScreen('home')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>–ö–æ–º–∞–Ω–¥–∞</h1>
                <button class="icon-btn" onclick="openInviteModal()">
                    <i class="fas fa-user-plus"></i>
                </button>
            </div>

            <div class="screen-content">
                <!-- Workspace Selector -->
                <div class="workspace-card">
                    <div class="workspace-header">
                        <i class="fas fa-briefcase"></i>
                        <span>–†–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</span>
                    </div>
                    <select id="workspace-select" class="workspace-select" onchange="switchWorkspace()">
                        <option>–õ–∏—á–Ω—ã–π –±—é–¥–∂–µ—Ç</option>
                    </select>
                </div>

                <!-- Members List -->
                <div class="section">
                    <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                    <div id="members-list" class="members-list">
                        <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- Invite Section -->
                <div class="section">
                    <button class="btn-full primary" onclick="generateInvite()">
                        <i class="fas fa-link"></i>
                        –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                    </button>
                </div>
            </div>
        </div>

        <!-- üìÑ REPORTS SCREEN -->
        <div id="reports-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="switchScreen('home')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>–û—Ç—á—ë—Ç—ã</h1>
            </div>

            <div class="screen-content">
                <!-- Generate Report Form -->
                <div class="card">
                    <h3>–°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç</h3>
                    <form id="report-form" onsubmit="generateReport(event)">
                        <div class="form-group">
                            <label>–¢–∏–ø –æ—Ç—á—ë—Ç–∞</label>
                            <select id="report-type" class="form-control">
                                <option value="financial">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç</option>
                                <option value="transactions">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>–§–æ—Ä–º–∞—Ç</label>
                            <div class="format-buttons">
                                <button type="button" class="format-btn active" data-format="pdf">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button type="button" class="format-btn" data-format="excel">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button type="button" class="format-btn" data-format="csv">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞</label>
                            <div class="period-quick-buttons">
                                <button type="button" class="btn-outline small" onclick="setReportPeriod('today')">–°–µ–≥–æ–¥–Ω—è</button>
                                <button type="button" class="btn-outline small" onclick="setReportPeriod('week')">–ù–µ–¥–µ–ª—è</button>
                                <button type="button" class="btn-outline small" onclick="setReportPeriod('month')">–ú–µ—Å—è—Ü</button>
                                <button type="button" class="btn-outline small" onclick="setReportPeriod('year')">–ì–æ–¥</button>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>–°</label>
                                <input type="date" id="report-start-date" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>–ü–æ</label>
                                <input type="date" id="report-end-date" class="form-control" required>
                            </div>
                        </div>

                        <button type="submit" class="btn-full primary">
                            <i class="fas fa-download"></i>
                            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç
                        </button>
                    </form>
                </div>

                <!-- Reports List -->
                <div class="section">
                    <h3>–ú–æ–∏ –æ—Ç—á—ë—Ç—ã</h3>
                    <div id="reports-list" class="reports-list">
                        <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        <div class="empty-state">
                            <i class="fas fa-file-alt"></i>
                            <p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚öôÔ∏è SETTINGS SCREEN -->
        <div id="settings-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="switchScreen('home')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            </div>

            <div class="screen-content">
                <div class="settings-group">
                    <h3>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h3>
                    <div class="setting-item">
                        <div class="setting-info">
                            <i class="fas fa-palette"></i>
                            <span>–¢–µ–º–∞</span>
                        </div>
                        <select id="theme-select" class="form-control-inline" onchange="changeTheme()">
                            <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark">–¢—ë–º–Ω–∞—è</option>
                            <option value="auto">–ê–≤—Ç–æ</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <i class="fas fa-language"></i>
                            <span>–Ø–∑—ã–∫</span>
                        </div>
                        <select id="language-select" class="form-control-inline">
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                            <option value="en">English</option>
                            <option value="ky">–ö—ã—Ä–≥—ã–∑—á–∞</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <i class="fas fa-dollar-sign"></i>
                            <span>–í–∞–ª—é—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</span>
                        </div>
                        <select id="currency-select" class="form-control-inline">
                            <option value="KGS">KGS (—Å–æ–º)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (‚Ç¨)</option>
                            <option value="RUB">RUB (‚ÇΩ)</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    <div class="setting-item">
                        <div class="setting-info">
                            <i class="fas fa-bell"></i>
                            <span>Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="notifications-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <i class="fas fa-calendar-alt"></i>
                            <span>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="subscriptions-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
                    <div class="setting-item">
                        <div class="setting-info">
                            <i class="fas fa-info-circle"></i>
                            <span>–í–µ—Ä—Å–∏—è</span>
                        </div>
                        <span class="setting-value">v2.4.0</span>
                    </div>
                </div>

                <button class="btn-full danger">
                    <i class="fas fa-sign-out-alt"></i>
                    –í—ã–π—Ç–∏
                </button>
            </div>
        </div>

        <!-- üìú HISTORY SCREEN -->
        <div id="history-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="switchScreen('home')">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>–ò—Å—Ç–æ—Ä–∏—è</h1>
                <div class="icon-btn"></div>
            </div>

            <div class="screen-content">
                <div class="card">
                    <div class="form-row">
                        <div class="form-group">
                            <label>–¢–∏–ø</label>
                            <select id="history-filter" class="form-control" onchange="loadHistory()">
                                <option value="all">–í—Å–µ</option>
                                <option value="income">–î–æ—Ö–æ–¥—ã</option>
                                <option value="expense">–†–∞—Å—Ö–æ–¥—ã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ü–µ—Ä–∏–æ–¥</label>
                            <select id="history-period" class="form-control" onchange="loadHistory()">
                                <option value="week">–ù–µ–¥–µ–ª—è</option>
                                <option value="month">–ú–µ—Å—è—Ü</option>
                                <option value="quarter">–ö–≤–∞—Ä—Ç–∞–ª</option>
                                <option value="year">–ì–æ–¥</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="transactions-history" class="transactions-list">
                    <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-screen="home">
                <i class="fas fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button class="nav-item" data-screen="analytics">
                <i class="fas fa-chart-line"></i>
                <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
            </button>
            <button class="nav-item fab-button" onclick="openAddTransactionModal()">
                <i class="fas fa-plus"></i>
            </button>
            <button class="nav-item" data-screen="team">
                <i class="fas fa-users"></i>
                <span>–ö–æ–º–∞–Ω–¥–∞</span>
            </button>
            <button class="nav-item" data-screen="settings">
                <i class="fas fa-cog"></i>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </button>
        </nav>

        <!-- ADD TRANSACTION MODAL (Bottom Sheet) -->
        <div id="add-transaction-modal" class="modal">
            <div class="modal-overlay" onclick="closeModal('add-transaction-modal')"></div>
            <div class="modal-content bottom-sheet">
                <div class="modal-header">
                    <h2>–ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</h2>
                    <button class="close-btn" onclick="closeModal('add-transaction-modal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="transaction-form" onsubmit="event.preventDefault(); submitTransaction();">
                    <div class="transaction-type-toggle">
                        <button type="button" class="toggle-btn active" data-type="expense" onclick="toggleTransactionType('expense')">
                            <i class="fas fa-arrow-up"></i>
                            –†–∞—Å—Ö–æ–¥
                        </button>
                        <button type="button" class="toggle-btn" data-type="income" onclick="toggleTransactionType('income')">
                            <i class="fas fa-arrow-down"></i>
                            –î–æ—Ö–æ–¥
                        </button>
                    </div>

                    <div class="form-group">
                        <label>–°—É–º–º–∞</label>
                        <div class="amount-input">
                            <input type="number" id="amount" class="form-control" placeholder="0" step="0.01" required>
                            <select id="transaction-currency-select" class="currency-select">
                                <option value="KGS">—Å</option>
                                <option value="USD">$</option>
                                <option value="EUR">‚Ç¨</option>
                                <option value="RUB">‚ÇΩ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <div class="category-pills" id="category-pills">
                            <div class="category-pill" onclick="selectCategory('–ü—Ä–æ–¥—É–∫—Ç—ã')">
                                <i class="fas fa-shopping-cart"></i>
                                <span>–ü—Ä–æ–¥—É–∫—Ç—ã</span>
                            </div>
                            <div class="category-pill" onclick="selectCategory('–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç')">
                                <i class="fas fa-car"></i>
                                <span>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</span>
                            </div>
                            <div class="category-pill" onclick="selectCategory('–ö–∞—Ñ–µ')">
                                <i class="fas fa-coffee"></i>
                                <span>–ö–∞—Ñ–µ</span>
                            </div>
                            <div class="category-pill" onclick="selectCategory('–û–¥–µ–∂–¥–∞')">
                                <i class="fas fa-tshirt"></i>
                                <span>–û–¥–µ–∂–¥–∞</span>
                            </div>
                            <div class="category-pill" onclick="selectCategory('–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è')">
                                <i class="fas fa-gamepad"></i>
                                <span>–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="text" id="description" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤">
                    </div>

                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
                        <div class="datetime-input">
                            <input type="date" id="transaction-date" class="form-control" required>
                            <input type="time" id="transaction-time" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 24px;">
                        <button type="submit" class="btn-full primary">
                            <i class="fas fa-check-circle"></i>
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <!-- Config & App Logic -->
    <script src="miniapp-config.js"></script>
    <script src="cache.js"></script>
    <script src="api-helper.js"></script>
    <script src="app.js"></script>
</body>
</html>
