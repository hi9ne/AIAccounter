{
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -3024,
        -64
      ],
      "id": "498ee8ee-3bb0-4913-b634-c81760ec1d1c",
      "name": "Telegram Trigger",
      "webhookId": "7d5db243-2146-45ba-a9b7-d0d743f58df0",
      "credentials": {
        "telegramApi": {
          "id": "VsCo0z8ZzisDZOpw",
          "name": "AIAccounter"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=INSERT INTO users (user_id, telegram_chat_id, first_name, registered_date, last_activity, is_active, registration_source)\nVALUES (\n  {{ $json.message.from.id }},\n  {{ $json.message.chat.id }},\n  '{{ $json.message.from.first_name || \"User\" }}',\n  NOW(),\n  NOW(),\n  true,\n  'telegram'\n)\nON CONFLICT (user_id) DO UPDATE SET\n  first_name = EXCLUDED.first_name,\n  last_activity = NOW()\nRETURNING user_id, onboarding_completed, onboarding_step, preferred_currency, usage_type",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -2800,
        -64
      ],
      "id": "59aab3a5-af04-42c3-8aee-c16b868c7167",
      "name": "Ensure User",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.onboarding_completed }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "notEquals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "needs_onboarding"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.onboarding_completed }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ready"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2650,
        -64
      ],
      "id": "check-onboarding-switch",
      "name": "Check Onboarding"
    },
    {
      "parameters": {
        "jsCode": "const user = $input.first().json;\nconst message = $('Telegram Trigger').first().json.message;\nconst text = (message.text || '').toLowerCase().trim();\nconst step = user.onboarding_step || 0;\n\n// –ö–æ–º–∞–Ω–¥–∞ /start –∏–ª–∏ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\nconst isStart = text === '/start' || step === 0;\n\nlet response = '';\nlet newStep = step;\nlet updateQuery = '';\n\nif (isStart || step === 0) {\n  // –®–∞–≥ 1: –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã\n  response = `üëã –ü—Ä–∏–≤–µ—Ç, ${message.from.first_name}!\\n\\n–Ø ‚Äî AIAccounter, —Ç–≤–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫.\\n\\n–î–∞–≤–∞–π –Ω–∞—Å—Ç—Ä–æ–∏–º –∞–∫–∫–∞—É–Ω—Ç. –í—ã–±–µ—Ä–∏ –æ—Å–Ω–æ–≤–Ω—É—é –≤–∞–ª—é—Ç—É:\\n\\n1Ô∏è‚É£ KGS (—Å–æ–º)\\n2Ô∏è‚É£ USD (–¥–æ–ª–ª–∞—Ä)\\n3Ô∏è‚É£ EUR (–µ–≤—Ä–æ)\\n4Ô∏è‚É£ RUB (—Ä—É–±–ª—å)\\n\\n–û—Ç–ø—Ä–∞–≤—å —Ü–∏—Ñ—Ä—É –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã.`;\n  updateQuery = `UPDATE users SET onboarding_step = 1 WHERE user_id = ${user.user_id}`;\n  newStep = 1;\n} else if (step === 1) {\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç—ã\n  let currency = 'KGS';\n  if (text.includes('1') || text.includes('kgs') || text.includes('—Å–æ–º')) currency = 'KGS';\n  else if (text.includes('2') || text.includes('usd') || text.includes('–¥–æ–ª–ª–∞—Ä')) currency = 'USD';\n  else if (text.includes('3') || text.includes('eur') || text.includes('–µ–≤—Ä–æ')) currency = 'EUR';\n  else if (text.includes('4') || text.includes('rub') || text.includes('—Ä—É–±–ª')) currency = 'RUB';\n  \n  updateQuery = `UPDATE users SET preferred_currency = '${currency}', onboarding_step = 2 WHERE user_id = ${user.user_id}`;\n  response = `‚úÖ –í–∞–ª—é—Ç–∞: ${currency}\\n\\n–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏ —Ç–∏–ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:\\n\\n1Ô∏è‚É£ üë§ –õ–∏—á–Ω—ã–π ‚Äî –¥–ª—è –ª–∏—á–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤\\n2Ô∏è‚É£ üíº –ë–∏–∑–Ω–µ—Å ‚Äî –¥–ª—è —É—á—ë—Ç–∞ –±–∏–∑–Ω–µ—Å–∞\\n\\n–û—Ç–ø—Ä–∞–≤—å —Ü–∏—Ñ—Ä—É.`;\n  newStep = 2;\n} else if (step === 2) {\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞\n  let usageType = 'personal';\n  if (text.includes('2') || text.includes('–±–∏–∑–Ω–µ—Å') || text.includes('business')) usageType = 'business';\n  \n  updateQuery = `UPDATE users SET usage_type = '${usageType}', onboarding_step = 3 WHERE user_id = ${user.user_id}`;\n  const typeText = usageType === 'business' ? 'üíº –ë–∏–∑–Ω–µ—Å' : 'üë§ –õ–∏—á–Ω—ã–π';\n  response = `‚úÖ –†–µ–∂–∏–º: ${typeText}\\n\\n–£—Å—Ç–∞–Ω–æ–≤–∏ –º–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):\\n\\n–û—Ç–ø—Ä–∞–≤—å —Å—É–º–º—É –∏–ª–∏ –Ω–∞–ø–∏—à–∏ \"–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å\".`;\n  newStep = 3;\n} else if (step === 3) {\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—é–¥–∂–µ—Ç–∞\n  let budget = null;\n  if (!text.includes('–ø—Ä–æ–ø—É—Å—Ç') && !text.includes('skip') && !text.includes('–Ω–µ—Ç')) {\n    const num = parseFloat(text.replace(/[^0-9.]/g, ''));\n    if (!isNaN(num) && num > 0) budget = num;\n  }\n  \n  if (budget) {\n    updateQuery = `UPDATE users SET monthly_budget = ${budget}, onboarding_step = 5, onboarding_completed = true, onboarding_completed_at = NOW() WHERE user_id = ${user.user_id}`;\n    response = `‚úÖ –ë—é–¥–∂–µ—Ç: ${budget.toLocaleString()} –≤ –º–µ—Å—è—Ü\\n\\nüéâ –û—Ç–ª–∏—á–Ω–æ! –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\\n\\n–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å:\\n‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã: \"–ø–æ—Ç—Ä–∞—Ç–∏–ª 500 –Ω–∞ —Ç–∞–∫—Å–∏\"\\n‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–æ—Ö–æ–¥—ã: \"–ø–æ–ª—É—á–∏–ª 50000 –∑–∞—Ä–ø–ª–∞—Ç–∞\"\\n‚Ä¢ –°–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á—ë—Ç—ã: \"–æ—Ç—á—ë—Ç –∑–∞ –Ω–µ–¥–µ–ª—é\"\\n‚Ä¢ –£–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–ª–≥–∞–º–∏: \"–¥–∞–ª –≤ –¥–æ–ª–≥ –ò–≤–∞–Ω—É 1000\"\\n\\n–ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π –≥–æ–ª–æ—Å–æ–≤—ã–µ! üé§`;\n  } else {\n    updateQuery = `UPDATE users SET onboarding_step = 5, onboarding_completed = true, onboarding_completed_at = NOW() WHERE user_id = ${user.user_id}`;\n    response = `‚úÖ –ë—é–¥–∂–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω\\n\\nüéâ –û—Ç–ª–∏—á–Ω–æ! –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\\n\\n–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å:\\n‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã: \"–ø–æ—Ç—Ä–∞—Ç–∏–ª 500 –Ω–∞ —Ç–∞–∫—Å–∏\"\\n‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–æ—Ö–æ–¥—ã: \"–ø–æ–ª—É—á–∏–ª 50000 –∑–∞—Ä–ø–ª–∞—Ç–∞\"\\n‚Ä¢ –°–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á—ë—Ç—ã: \"–æ—Ç—á—ë—Ç –∑–∞ –Ω–µ–¥–µ–ª—é\"\\n‚Ä¢ –£–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–ª–≥–∞–º–∏: \"–¥–∞–ª –≤ –¥–æ–ª–≥ –ò–≤–∞–Ω—É 1000\"\\n\\n–ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π –≥–æ–ª–æ—Å–æ–≤—ã–µ! üé§`;\n  }\n  newStep = 5;\n}\n\nreturn [{\n  json: {\n    chat_id: message.chat.id,\n    response: response,\n    update_query: updateQuery,\n    new_step: newStep,\n    user_id: user.user_id\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2450,
        -160
      ],
      "id": "onboarding-logic",
      "name": "Onboarding Logic"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{ $json.update_query }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -2250,
        -160
      ],
      "id": "update-onboarding-step",
      "name": "Update Onboarding",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Onboarding Logic').item.json.chat_id }}",
        "text": "={{ $('Onboarding Logic').item.json.response }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2050,
        -160
      ],
      "id": "send-onboarding-msg",
      "name": "Send Onboarding",
      "credentials": {
        "telegramApi": {
          "id": "VsCo0z8ZzisDZOpw",
          "name": "AIAccounter"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.voice }}",
                    "rightValue": "",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "voice"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2576,
        -64
      ],
      "id": "11007d98-1dae-493c-babe-cf0edd339e77",
      "name": "Message Type"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Telegram Trigger').item.json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2352,
        -160
      ],
      "id": "09140052-8396-4a9a-983b-fff50b599670",
      "name": "Download Voice",
      "webhookId": "ebbba00f-fb0b-4458-ade5-3e826582610f",
      "credentials": {
        "telegramApi": {
          "id": "VsCo0z8ZzisDZOpw",
          "name": "AIAccounter"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        -2128,
        -160
      ],
      "id": "33d131ba-3d1c-44c3-a1b0-7c63f0c58fbd",
      "name": "Whisper STT",
      "credentials": {
        "openAiApi": {
          "id": "1T30bcIe2tfs32N6",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "text",
              "name": "text",
              "value": "={{ $json.text",
              "type": "string"
            },
            {
              "id": "user_id",
              "name": "user_id",
              "value": "={{ $('Telegram Trigger').item.json.message.from.id",
              "type": "number"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "value": "={{ $('Telegram Trigger').item.json.message.chat.id",
              "type": "number"
            },
            {
              "id": "first_name",
              "name": "first_name",
              "value": "={{ $('Telegram Trigger').item.json.message.from.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1904,
        -160
      ],
      "id": "b68b8dd7-effd-45f5-b6c7-839c0c0d9557",
      "name": "Set Voice Data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "text",
              "name": "text",
              "value": "={{ $('Telegram Trigger').item.json.message.text",
              "type": "string"
            },
            {
              "id": "user_id",
              "name": "user_id",
              "value": "={{ $('Telegram Trigger').item.json.message.from.id",
              "type": "number"
            },
            {
              "id": "chat_id",
              "name": "chat_id",
              "value": "={{ $('Telegram Trigger').item.json.message.chat.id",
              "type": "number"
            },
            {
              "id": "first_name",
              "name": "first_name",
              "value": "={{ $('Telegram Trigger').item.json.message.from.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1904,
        32
      ],
      "id": "4f78efcb-baa2-4f57-bd7f-38a55aee9c6e",
      "name": "Set Text Data"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=User ID: {{ $json.user_id }}\nChat ID: {{ $json.chat_id }}\n–ò–º—è: {{ $json.first_name }}\n–°–æ–æ–±—â–µ–Ω–∏–µ: {{ $json.text }}",
        "options": {
          "systemMessage": "–¢—ã ‚Äî AIAccounter, —É–º–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ Telegram. –û–±—Ä–∞—â–∞–π—Å—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ –∏–º–µ–Ω–∏.\n\nüö´ –°–¢–†–û–ì–ò–ï –ü–†–ê–í–ò–õ–ê:\n‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: [Used tools], Tool:, Input:, Result:, JSON\n‚Ä¢ –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –ø–æ-—Ä—É—Å—Å–∫–∏\n‚Ä¢ –ë—É–¥—å –∫—Ä–∞—Ç–∫–∏–º –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ —É–º–µ—Ä–µ–Ω–Ω–æ\n\nüìä –û–¢–ß–Å–¢–´ ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑—ã–≤–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:\n‚Ä¢ '–æ—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è/—á—Ç–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª' ‚Üí Report_Daily\n‚Ä¢ '–æ—Ç—á—ë—Ç –∑–∞ –Ω–µ–¥–µ–ª—é/–∑–∞ 7 –¥–Ω–µ–π' ‚Üí Report_Weekly  \n‚Ä¢ '–æ—Ç—á—ë—Ç –∑–∞ –º–µ—Å—è—Ü' ‚Üí Report_Monthly\n‚Ä¢ '–æ—Ç—á—ë—Ç —Å [–¥–∞—Ç–∞] –ø–æ [–¥–∞—Ç–∞]' ‚Üí Report_Period\n\nüí∞ –¢–†–ê–ù–ó–ê–ö–¶–ò–ò:\n‚Ä¢ –†–∞—Å—Ö–æ–¥: '–ø–æ—Ç—Ä–∞—Ç–∏–ª', '–∫—É–ø–∏–ª', '–∑–∞–ø–ª–∞—Ç–∏–ª', '—Ç–∞–∫—Å–∏', '–∫–æ—Ñ–µ' ‚Üí Create_Expense\n‚Ä¢ –î–æ—Ö–æ–¥: '–ø–æ–ª—É—á–∏–ª', '–∑–∞—Ä–∞–±–æ—Ç–∞–ª', '–∑–∞—Ä–ø–ª–∞—Ç–∞', '–ø–µ—Ä–µ–≤–æ–¥' ‚Üí Create_Income\n‚Ä¢ –í–∞–ª—é—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: KGS. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –¥—Ä—É–≥–∞—è (USD, EUR, RUB) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë\n‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—é –æ–ø—Ä–µ–¥–µ–ª—è–π –ø–æ —Å–º—ã—Å–ª—É: –µ–¥–∞‚Üí–ü—Ä–æ–¥—É–∫—Ç—ã, —Ç–∞–∫—Å–∏‚Üí–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –∫–∏–Ω–æ‚Üí–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è\n\nüîç –ü–û–ò–°–ö –¢–†–ê–ù–ó–ê–ö–¶–ò–ô (Search_Transactions):\n‚Ä¢ '–Ω–∞–π–¥–∏ —Ç—Ä–∞—Ç—ã –Ω–∞ –∫–æ—Ñ–µ' ‚Üí search:–∫–æ—Ñ–µ\n‚Ä¢ '–≥–¥–µ —è —Ç—Ä–∞—Ç–∏–ª –Ω–∞ —Ç–∞–∫—Å–∏' ‚Üí search:—Ç–∞–∫—Å–∏\n‚Ä¢ '–ø–æ–∫–∞–∂–∏ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥—É' ‚Üí search:–µ–¥–∞\n‚Ä¢ –û—Ç–≤–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π —Å–ø–∏—Å–∫–æ–º —Å –¥–∞—Ç–æ–π, —Å—É–º–º–æ–π –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º\n\nüí≥ –î–û–õ–ì–ò (Debt_Manager):\n‚Ä¢ '–¥–∞–ª –≤ –¥–æ–ª–≥ 5000 –ê—Ä—Ç—ë–º—É' ‚Üí action:add, debt_type:given\n‚Ä¢ '–∑–∞–Ω—è–ª 3000 —É –ú–∞—à–∏' ‚Üí action:add, debt_type:received\n‚Ä¢ '–º–æ–∏ –¥–æ–ª–≥–∏/–∫—Ç–æ –¥–æ–ª–∂–µ–Ω' ‚Üí action:list\n‚Ä¢ '–ê—Ä—Ç—ë–º –≤–µ—Ä–Ω—É–ª 2000' ‚Üí action:pay (—á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç)\n‚Ä¢ '–ê—Ä—Ç—ë–º –≤–µ—Ä–Ω—É–ª –≤—Å—ë' ‚Üí action:settle\n\nüîÑ –ü–û–î–ü–ò–°–ö–ò (Recurring_Manager):\n‚Ä¢ '–¥–æ–±–∞–≤—å –ø–æ–¥–ø–∏—Å–∫—É Netflix 500' ‚Üí action:add\n‚Ä¢ '–º–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏' ‚Üí action:list\n\nüíµ –ë–Æ–î–ñ–ï–¢ (Budget_Manager):\n‚Ä¢ '–º–æ–π –±—é–¥–∂–µ—Ç/—Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å/—Å—Ç–∞—Ç—É—Å' ‚Üí action:get\n‚Ä¢ '—É—Å—Ç–∞–Ω–æ–≤–∏ –±—é–¥–∂–µ—Ç 100000' ‚Üí action:set, amount:100000\n\nüìÅ –ö–ê–¢–ï–ì–û–†–ò–ò (Category_Manager):\n‚Ä¢ '–º–æ–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–ø–æ–∫–∞–∂–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' ‚Üí action:list\n‚Ä¢ '–¥–æ–±–∞–≤—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –°–ø–æ—Ä—Ç' ‚Üí action:add\n\n‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò:\n–ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤–∞–ª—é—Ç—É –∏–ª–∏ —Ä–µ–∂–∏–º ‚Üí –æ—Ç–≤–µ—Ç—å:\n'–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ üì±\\n–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª –≤–Ω–∏–∑—É —á–∞—Ç–∞'\n\n‚úÖ –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–û–í:\n‚Ä¢ –†–∞—Å—Ö–æ–¥: '‚úÖ –ó–∞–ø–∏—Å–∞–ª: [—Å—É–º–º–∞] –Ω–∞ [–∫–∞—Ç–µ–≥–æ—Ä–∏—è]'\n‚Ä¢ –î–æ—Ö–æ–¥: '‚úÖ –î–æ–±–∞–≤–∏–ª –¥–æ—Ö–æ–¥: [—Å—É–º–º–∞] ([–∫–∞—Ç–µ–≥–æ—Ä–∏—è])'\n‚Ä¢ –î–æ–ª–≥: '‚úÖ –î–æ–ª–≥ –¥–æ–±–∞–≤–ª–µ–Ω/–∑–∞–∫—Ä—ã—Ç'\n‚Ä¢ –ë—é–¥–∂–µ—Ç: –ø–æ–∫–∞–∑—ã–≤–∞–π –ª–∏–º–∏—Ç, –ø–æ—Ç—Ä–∞—á–µ–Ω–æ, –æ—Å—Ç–∞—Ç–æ–∫\n‚Ä¢ –ü–æ–∏—Å–∫: —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –¥–∞—Ç–æ–π, —Å—É–º–º–æ–π –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º\n‚Ä¢ –û—à–∏–±–∫–∞: '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å...' + –ø—Ä–∏—á–∏–Ω–∞",
          "maxIterations": 3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -920,
        -64
      ],
      "id": "7999a291-dc51-4663-a953-4b66593a7cfa",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id",
        "text": "={{ $json.output",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        192,
        -64
      ],
      "id": "4dadea02-0cbf-418c-838a-db33260d2dd7",
      "name": "Send Reply",
      "webhookId": "9c3b0626-7240-4ad1-a03e-14cee62b4802",
      "credentials": {
        "telegramApi": {
          "id": "VsCo0z8ZzisDZOpw",
          "name": "AIAccounter"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1680,
        160
      ],
      "id": "71e43918-92d3-4fb3-a105-5b24b5bce575",
      "name": "GPT-4.1 Mini",
      "credentials": {
        "openAiApi": {
          "id": "1T30bcIe2tfs32N6",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -1552,
        160
      ],
      "id": "d77ae2c5-e09e-4495-8105-2bd032be3f22",
      "name": "Chat Memory",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Execute a SQL query in Postgres",
        "operation": "executeQuery",
        "query": "=SELECT id, date, category, amount, currency, description FROM expenses WHERE user_id = {{ $('Telegram Trigger').item.json.message.from.id }} AND deleted_at IS NULL ORDER BY date DESC LIMIT 100",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -1424,
        160
      ],
      "id": "5c419fbc-9230-4b9f-831f-4b109404fa7d",
      "name": "Get_Expenses",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Execute a SQL query in Postgres",
        "operation": "executeQuery",
        "query": "=SELECT id, date, category, amount, currency, description FROM income WHERE user_id = {{ $('Telegram Trigger').item.json.message.from.id }} AND deleted_at IS NULL ORDER BY date DESC LIMIT 100",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -1296,
        160
      ],
      "id": "d5f6bec9-cd9c-4918-b88f-826b82a57852",
      "name": "Get_Income",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ç—Ä–∞—Ç–∏–ª –¥–µ–Ω—å–≥–∏: –ø–æ–∫—É–ø–∫–∞, –æ–ø–ª–∞—Ç–∞, —Ç–∞–∫—Å–∏, –µ–¥–∞ –∏ —Ç.–¥. –ö–∞—Ç–µ–≥–æ—Ä–∏—é –≤—ã–±–∏—Ä–∞–π –ø–æ —Å–º—ã—Å–ª—É —Ç—Ä–∞—Ç.",
        "operation": "executeQuery",
        "query": "=INSERT INTO expenses (user_id, date, category, amount, currency, description, source) VALUES ({{ $('Telegram Trigger').item.json.message.from.id }}, COALESCE(NULLIF('{{ $fromAI('date', '–î–∞—Ç–∞ YYYY-MM-DD, –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞', 'string') }}', '')::date, (CURRENT_TIMESTAMP AT TIME ZONE 'Asia/Bishkek')::date), '{{ $fromAI('category', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ —Å–º—ã—Å–ª—É: –ü—Ä–æ–¥—É–∫—Ç—ã, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ö–∞—Ñ–µ, –ñ–∏–ª—å—ë, –ú–µ–¥–∏—Ü–∏–Ω–∞, –û–¥–µ–∂–¥–∞, –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ü–æ–¥–ø–∏—Å–∫–∏ –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω–∞—è', 'string') }}', {{ $fromAI('amount', '–°—É–º–º–∞ —á–∏—Å–ª–æ–º', 'number') }}, '{{ $fromAI('currency', '–í–∞–ª—é—Ç–∞ KGS/USD/EUR/RUB, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é KGS', 'string') }}', '{{ $fromAI('description', '–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ', 'string') }}', 'telegram') RETURNING id, date, category, amount, currency",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -1168,
        160
      ],
      "id": "6cb65c94-12f4-45dc-9cde-bd4020361ea0",
      "name": "Create_Expense",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –¥–æ—Ö–æ–¥. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –¥–µ–Ω—å–≥–∏: –∑–∞—Ä–ø–ª–∞—Ç–∞, –ø–µ—Ä–µ–≤–æ–¥, –ø—Ä–æ–¥–∞–∂–∞ –∏ —Ç.–¥. –ö–∞—Ç–µ–≥–æ—Ä–∏—é –≤—ã–±–∏—Ä–∞–π –ø–æ —Å–º—ã—Å–ª—É –¥–æ—Ö–æ–¥–∞.",
        "operation": "executeQuery",
        "query": "=INSERT INTO income (user_id, date, category, amount, currency, description, source) VALUES ({{ $('Telegram Trigger').item.json.message.from.id }}, COALESCE(NULLIF('{{ $fromAI('date', '–î–∞—Ç–∞ YYYY-MM-DD, –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞', 'string') }}', '')::date, (CURRENT_TIMESTAMP AT TIME ZONE 'Asia/Bishkek')::date), '{{ $fromAI('category', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ—Ö–æ–¥–æ–≤ –ø–æ —Å–º—ã—Å–ª—É: –ó–∞—Ä–ø–ª–∞—Ç–∞, –§—Ä–∏–ª–∞–Ω—Å, –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –ü–æ–¥–∞—Ä–∫–∏, –ü—Ä–æ–¥–∞–∂–∏ –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω–∞—è', 'string') }}', {{ $fromAI('amount', '–°—É–º–º–∞ —á–∏—Å–ª–æ–º', 'number') }}, '{{ $fromAI('currency', '–í–∞–ª—é—Ç–∞ KGS/USD/EUR/RUB, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é KGS', 'string') }}', '{{ $fromAI('description', '–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ', 'string') }}', 'telegram') RETURNING id, date, category, amount, currency",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -1040,
        160
      ],
      "id": "19d92818-0fde-4fe5-a365-9b76659cf247",
      "name": "Create_Income",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Execute a SQL query in Postgres",
        "operation": "executeQuery",
        "query": "=UPDATE expenses SET deleted_at = NOW() WHERE id = {{ $fromAI('id', 'ID —Ä–∞—Å—Ö–æ–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'number') }} AND user_id = {{ $('Telegram Trigger').item.json.message.from.id }} RETURNING id, 'deleted' as status",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -912,
        160
      ],
      "id": "01e4b503-39ab-4f5c-bc56-9aa48c9c42e3",
      "name": "Delete_Expense",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Execute a SQL query in Postgres",
        "operation": "executeQuery",
        "query": "=UPDATE income SET deleted_at = NOW() WHERE id = {{ $fromAI('id', 'ID –¥–æ—Ö–æ–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'number') }} AND user_id = {{ $('Telegram Trigger').item.json.message.from.id }} RETURNING id, 'deleted' as status",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -784,
        160
      ],
      "id": "0bc68b88-2c4e-46da-85b3-3909c089b006",
      "name": "Delete_Income",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -656,
        160
      ],
      "id": "7080160a-e6d6-4f57-8b12-c17efb385779",
      "name": "Calculator"
    },
    {
      "parameters": {
        "toolDescription": "–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç: –æ—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è, –¥–Ω–µ–≤–Ω–æ–π –æ—Ç—á—ë—Ç, —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –æ—Ç—á—ë—Ç, —á—Ç–æ —è –ø–æ—Ç—Ä–∞—Ç–∏–ª —Å–µ–≥–æ–¥–Ω—è. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –∏ –¥–æ—Ö–æ–¥–∞–º–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å.",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/reports-webhook",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"report_type\": \"daily\",\n  \"user_id\": {{ $json.user_id }},\n  \"chat_id\": {{ $json.chat_id }},\n  \"first_name\": \"{{ $json.first_name }}\",\n  \"start_date\": \"\",\n  \"end_date\": \"\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -528,
        160
      ],
      "id": "5737063d-299d-43f7-a3a6-b7daf162d309",
      "name": "Report_Daily"
    },
    {
      "parameters": {
        "toolDescription": "–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç: –æ—Ç—á—ë—Ç –∑–∞ –Ω–µ–¥–µ–ª—é, –Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç, –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é, –∑–∞ 7 –¥–Ω–µ–π, weekly report. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–¥–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å —Ç–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –±–∞–ª–∞–Ω—Å–æ–º.",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/reports-webhook",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"report_type\": \"weekly\",\n  \"user_id\": {{ $json.user_id }},\n  \"chat_id\": {{ $json.chat_id }},\n  \"first_name\": \"{{ $json.first_name }}\",\n  \"start_date\": \"\",\n  \"end_date\": \"\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -400,
        160
      ],
      "id": "b9b6d8c3-70be-4977-8d42-f4d7bc3ad4e7",
      "name": "Report_Weekly"
    },
    {
      "parameters": {
        "toolDescription": "–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç: –æ—Ç—á—ë—Ç –∑–∞ –º–µ—Å—è—Ü, –º–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç, –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü, monthly report. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Å—è—á–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –±—é–¥–∂–µ—Ç–æ–º.",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/reports-webhook",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"report_type\": \"monthly\",\n  \"user_id\": {{ $json.user_id }},\n  \"chat_id\": {{ $json.chat_id }},\n  \"first_name\": \"{{ $json.first_name }}\",\n  \"start_date\": \"\",\n  \"end_date\": \"\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -272,
        160
      ],
      "id": "2e1285d3-695d-449a-81fd-6620ba20e849",
      "name": "Report_Monthly"
    },
    {
      "parameters": {
        "toolDescription": "–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã –¥–ª—è –æ—Ç—á—ë—Ç–∞: —Å 1 –ø–æ 15 –Ω–æ—è–±—Ä—è, –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü, —Å —Ç–∞–∫–æ–π-—Ç–æ –¥–∞—Ç—ã –ø–æ —Ç–∞–∫—É—é-—Ç–æ. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/reports-webhook",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"report_type\": \"period\",\n  \"user_id\": {{ $json.user_id }},\n  \"chat_id\": {{ $json.chat_id }},\n  \"first_name\": \"{{ $json.first_name }}\",\n  \"start_date\": \"\",\n  \"end_date\": \"\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -144,
        160
      ],
      "id": "c772b7d0-c452-4239-961b-1ccd4d2c4462",
      "name": "Report_Period"
    },
    {
      "parameters": {
        "toolDescription": "–£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è: –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –ü–∞—Ä–∞–º–µ—Ç—Ä action: list (–ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ), add (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é), delete (—É–¥–∞–ª–∏—Ç—å)",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/categories-webhook",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"action\": \"{{ $fromAI('action', '–î–µ–π—Å—Ç–≤–∏–µ: list (–ø–æ–∫–∞–∑–∞—Ç—å), add (–¥–æ–±–∞–≤–∏—Ç—å), delete (—É–¥–∞–ª–∏—Ç—å)', 'string') }}\",\n  \"user_id\": {{ $json.user_id }},\n  \"type\": \"{{ $fromAI('type', '–¢–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: expense –∏–ª–∏ income', 'string') }}\",\n  \"name\": \"{{ $fromAI('name', '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è', 'string') }}\",\n  \"icon\": \"{{ $fromAI('icon', '–≠–º–æ–¥–∑–∏ –∏–∫–æ–Ω–∫–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'string') }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -16,
        160
      ],
      "id": "a4889bb9-9233-45f5-a15d-5ed69be82304",
      "name": "Category_Manager"
    },
    {
      "parameters": {
        "toolDescription": "–£–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ–ª–≥–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–æ –¥–æ–ª–≥–∏: –¥–∞–ª –≤ –¥–æ–ª–≥, –≤–∑—è–ª –≤ –¥–æ–ª–≥, –º–æ–∏ –¥–æ–ª–≥–∏, –≤–µ—Ä–Ω—É–ª –¥–æ–ª–≥. –î–µ–π—Å—Ç–≤–∏—è: list (–ø–æ–∫–∞–∑–∞—Ç—å –¥–æ–ª–≥–∏), add (—Å–æ–∑–¥–∞—Ç—å –¥–æ–ª–≥), pay (—á–∞—Å—Ç–∏—á–Ω—ã–π/–ø–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç), settle (–∑–∞–∫—Ä—ã—Ç—å –¥–æ–ª–≥), delete (—É–¥–∞–ª–∏—Ç—å)",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/debts",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"action\": \"{{ $fromAI('action', '–î–µ–π—Å—Ç–≤–∏–µ: list, add, pay, settle, delete', 'string') }}\",\n  \"user_id\": {{ $json.user_id }},\n  \"debt_type\": \"{{ $fromAI('debt_type', '–¢–∏–ø: given (–¥–∞–ª –≤ –¥–æ–ª–≥, –º–Ω–µ –¥–æ–ª–∂–Ω—ã) –∏–ª–∏ received (–≤–∑—è–ª –≤ –¥–æ–ª–≥, —è –¥–æ–ª–∂–µ–Ω)', 'string') }}\",\n  \"person_name\": \"{{ $fromAI('person_name', '–ò–º—è —á–µ–ª–æ–≤–µ–∫–∞', 'string') }}\",\n  \"amount\": {{ $fromAI('amount', '–°—É–º–º–∞ –¥–æ–ª–≥–∞ —á–∏—Å–ª–æ–º, 0 –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞', 'number') }},\n  \"currency\": \"{{ $fromAI('currency', '–í–∞–ª—é—Ç–∞ KGS/USD/EUR/RUB, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é KGS', 'string') }}\",\n  \"description\": \"{{ $fromAI('description', '–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞ —á—Ç–æ –¥–æ–ª–≥', 'string') }}\",\n  \"due_date\": \"{{ $fromAI('due_date', '–î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ YYYY-MM-DD –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞', 'string') }}\",\n  \"debt_id\": {{ $fromAI('debt_id', 'ID –¥–æ–ª–≥–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã/–∑–∞–∫—Ä—ã—Ç–∏—è, 0 –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω', 'number') }},\n  \"note\": \"{{ $fromAI('note', '–ó–∞–º–µ—Ç–∫–∞ –æ –ø–ª–∞—Ç–µ–∂–µ', 'string') }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        112,
        160
      ],
      "id": "debt-manager-tool-id",
      "name": "Debt_Manager"
    },
    {
      "parameters": {
        "toolDescription": "–£–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–æ –ø–æ–¥–ø–∏—Å–∫–∏, —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏, –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã. –î–µ–π—Å—Ç–≤–∏—è: list (–ø–æ–∫–∞–∑–∞—Ç—å), add (—Å–æ–∑–¥–∞—Ç—å), pay (–æ—Ç–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—á–µ–Ω–Ω—ã–º), pause (–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å), delete (—É–¥–∞–ª–∏—Ç—å)",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/recurring",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"action\": \"{{ $fromAI('action', '–î–µ–π—Å—Ç–≤–∏–µ: list, add, pay, pause, delete', 'string') }}\",\n  \"user_id\": {{ $json.user_id }},\n  \"title\": \"{{ $fromAI('title', '–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏: Netflix, Spotify, –ê—Ä–µ–Ω–¥–∞ –∏ —Ç.–¥.', 'string') }}\",\n  \"amount\": {{ $fromAI('amount', '–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ —á–∏—Å–ª–æ–º, 0 –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞', 'number') }},\n  \"currency\": \"{{ $fromAI('currency', '–í–∞–ª—é—Ç–∞ KGS/USD/EUR/RUB, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é KGS', 'string') }}\",\n  \"category\": \"{{ $fromAI('category', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ü–æ–¥–ø–∏—Å–∫–∏, –ñ–∏–ª—å—ë, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –°–≤—è–∑—å –∏ —Ç.–¥.', 'string') }}\",\n  \"frequency\": \"{{ $fromAI('frequency', '–ß–∞—Å—Ç–æ—Ç–∞: daily, weekly, monthly, yearly', 'string') }}\",\n  \"next_payment_date\": \"{{ $fromAI('next_payment_date', '–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ YYYY-MM-DD', 'string') }}\",\n  \"recurring_id\": {{ $fromAI('recurring_id', 'ID –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è pay/pause/delete, 0 –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω', 'number') }}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        240,
        160
      ],
      "id": "recurring-manager-tool-id",
      "name": "Recurring_Manager"
    },
    {
      "parameters": {
        "toolDescription": "–£–ø—Ä–∞–≤–ª—è–µ—Ç –±—é–¥–∂–µ—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –±—é–¥–∂–µ—Ç: –º–æ–π –±—é–¥–∂–µ—Ç, —Å—Ç–∞—Ç—É—Å –±—é–¥–∂–µ—Ç–∞, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç. –î–µ–π—Å—Ç–≤–∏—è: get (–ø–æ–∫–∞–∑–∞—Ç—å –±—é–¥–∂–µ—Ç –∏ —Å—Ç–∞—Ç—É—Å), set (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)",
        "method": "POST",
        "url": "https://alikbekalatoo77.app.n8n.cloud/webhook/budget",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"action\": \"{{ $fromAI('action', '–î–µ–π—Å—Ç–≤–∏–µ: get (–ø–æ–∫–∞–∑–∞—Ç—å –±—é–¥–∂–µ—Ç), set (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç)', 'string') }}\",\n  \"user_id\": {{ $json.user_id }},\n  \"amount\": {{ $fromAI('amount', '–°—É–º–º–∞ –±—é–¥–∂–µ—Ç–∞ —á–∏—Å–ª–æ–º, 0 –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞', 'number') }},\n  \"currency\": \"{{ $fromAI('currency', '–í–∞–ª—é—Ç–∞ KGS/USD/EUR/RUB, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é KGS', 'string') }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        368,
        160
      ],
      "id": "budget-manager-tool-id",
      "name": "Budget_Manager"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "–ò—â–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Ä–∞—Å—Ö–æ–¥—ã –∏ –¥–æ—Ö–æ–¥—ã) –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ –æ–ø–∏—Å–∞–Ω–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: –Ω–∞–π–¥–∏ —Ç—Ä–∞—Ç—ã –Ω–∞ –∫–æ—Ñ–µ, –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –≥–¥–µ —è —Ç—Ä–∞—Ç–∏–ª –Ω–∞ –µ–¥—É, —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª –Ω–∞ —Ç–∞–∫—Å–∏",
        "operation": "executeQuery",
        "query": "=SELECT id, date, category, amount, currency, description, 'expense' as type FROM expenses WHERE user_id = {{ $('Telegram Trigger').item.json.message.from.id }} AND deleted_at IS NULL AND (description ILIKE '%{{ $fromAI('search', '–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞', 'string') }}%' OR category ILIKE '%{{ $fromAI('search', '–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞', 'string') }}%') UNION ALL SELECT id, date, category, amount, currency, description, 'income' as type FROM income WHERE user_id = {{ $('Telegram Trigger').item.json.message.from.id }} AND deleted_at IS NULL AND (description ILIKE '%{{ $fromAI('search', '–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞', 'string') }}%' OR category ILIKE '%{{ $fromAI('search', '–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞', 'string') }}%') ORDER BY date DESC LIMIT 20",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        496,
        160
      ],
      "id": "search-transactions-tool-id",
      "name": "Search_Transactions",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "categories-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3024,
        456
      ],
      "id": "5e6db395-40c0-4b36-ba7e-2fa508c966d8",
      "name": "Categories Webhook",
      "webhookId": "categories-webhook-id"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "list",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "list"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "add",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "add"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "delete",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "delete"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2800,
        440
      ],
      "id": "1dc0cb4c-8b08-4b92-8b91-e73c7ca6728f",
      "name": "Route Category Action"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT c.id, c.name, c.type, c.icon, c.color, c.is_default\nFROM categories c\nWHERE (c.user_id IS NULL OR c.user_id = {{ $json.body.user_id }})\n  AND c.is_active = true\n  AND (c.type = '{{ $json.body.type }}' OR '{{ $json.body.type }}' = '')\nORDER BY c.is_default DESC, c.sort_order, c.name",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        264
      ],
      "id": "c693d87d-0de4-4d59-81e9-5a6a4c28f7ff",
      "name": "Get Categories",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=INSERT INTO categories (user_id, name, type, icon, is_default, is_active)\nVALUES (\n  {{ $json.body.user_id }},\n  '{{ $json.body.name }}',\n  '{{ $json.body.type }}',\n  '{{ $json.body.icon || \"üìÅ\" }}',\n  false,\n  true\n)\nON CONFLICT (user_id, name, type) DO NOTHING\nRETURNING id, name, type, icon",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        456
      ],
      "id": "532a9556-d131-4a5e-b56b-48614c92b017",
      "name": "Add Category",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=UPDATE categories\nSET is_active = false, updated_at = NOW()\nWHERE user_id = {{ $json.body.user_id }}\n  AND name = '{{ $json.body.name }}'\n  AND type = '{{ $json.body.type }}'\n  AND is_default = false\nRETURNING id, name, 'deleted' as status",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        648
      ],
      "id": "91080a3e-ce7a-4724-8324-e754f13eeccb",
      "name": "Delete Category",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst items = $input.all();\nconst action = $('Categories Webhook').first().json.body.action;\n\nlet result = {};\n\nif (action === 'list') {\n  const categories = items.map(item => ({\n    name: item.json.name,\n    icon: item.json.icon,\n    type: item.json.type,\n    is_default: item.json.is_default\n  }));\n  \n  const expenses = categories.filter(c => c.type === 'expense');\n  const income = categories.filter(c => c.type === 'income');\n  \n  result = {\n    success: true,\n    expenses: expenses.map(c => `${c.icon} ${c.name}${c.is_default ? '' : ' (—Å–≤–æ–π)'}`).join(', '),\n    income: income.map(c => `${c.icon} ${c.name}${c.is_default ? '' : ' (—Å–≤–æ–π)'}`).join(', '),\n    total: categories.length\n  };\n} else if (action === 'add') {\n  if (items.length > 0 && items[0].json.id) {\n    result = {\n      success: true,\n      message: `–ö–∞—Ç–µ–≥–æ—Ä–∏—è \"${items[0].json.name}\" –¥–æ–±–∞–≤–ª–µ–Ω–∞`,\n      category: items[0].json\n    };\n  } else {\n    result = {\n      success: false,\n      message: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å'\n    };\n  }\n} else if (action === 'delete') {\n  if (items.length > 0 && items[0].json.id) {\n    result = {\n      success: true,\n      message: `–ö–∞—Ç–µ–≥–æ—Ä–∏—è \"${items[0].json.name}\" —É–¥–∞–ª–µ–Ω–∞`\n    };\n  } else {\n    result = {\n      success: false,\n      message: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å (–¥–µ—Ñ–æ–ª—Ç–Ω—É—é)'\n    };\n  }\n}\n\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        456
      ],
      "id": "8eed7674-e9fb-445c-953c-c9ed5542f76f",
      "name": "Format Category Response"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -2128,
        456
      ],
      "id": "f8048067-a590-4305-9819-d269019b29fe",
      "name": "Respond Categories"
    },
    {
      "parameters": {
        "content": "## Category",
        "height": 624,
        "width": 1184
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3096,
        184
      ],
      "id": "c28ede5b-cb4e-433a-8cfb-0dd359f11092",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "debts",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3024,
        1100
      ],
      "id": "debts-webhook-001",
      "name": "Debts Webhook",
      "webhookId": "debts-webhook-id"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "list",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "list"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "add",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "add"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "pay",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pay"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "settle",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "settle"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "delete",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "delete"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2800,
        1100
      ],
      "id": "route-debt-action-001",
      "name": "Route Debt Action"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT d.id, d.person_name, d.debt_type, d.original_amount, d.remaining_amount, d.currency, d.description, d.due_date, d.is_settled, d.created_at\nFROM debts d\nWHERE d.user_id = {{ $json.body.user_id }}\nORDER BY d.is_settled ASC, d.due_date ASC NULLS LAST, d.created_at DESC",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        900
      ],
      "id": "get-debts-001",
      "name": "Get Debts",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=INSERT INTO debts (user_id, person_name, debt_type, original_amount, remaining_amount, currency, description, due_date)\nVALUES (\n  {{ $json.body.user_id }},\n  '{{ $json.body.person_name }}',\n  '{{ $json.body.debt_type }}',\n  {{ $json.body.amount }},\n  {{ $json.body.amount }},\n  '{{ $json.body.currency || \"KGS\" }}',\n  '{{ $json.body.description || \"\" }}',\n  {{ $json.body.due_date ? \"'\" + $json.body.due_date + \"'\" : \"NULL\" }}\n)\nRETURNING id, person_name, debt_type, original_amount, currency",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        1050
      ],
      "id": "add-debt-001",
      "name": "Add Debt",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=WITH debt_update AS (\n  UPDATE debts\n  SET remaining_amount = remaining_amount - {{ $json.body.amount }},\n      is_settled = CASE WHEN remaining_amount - {{ $json.body.amount }} <= 0 THEN true ELSE false END,\n      updated_at = NOW()\n  WHERE id = {{ $json.body.debt_id }} AND user_id = {{ $json.body.user_id }}\n  RETURNING id, person_name, remaining_amount, is_settled\n),\npayment_insert AS (\n  INSERT INTO debt_payments (debt_id, amount, note)\n  SELECT {{ $json.body.debt_id }}, {{ $json.body.amount }}, '{{ $json.body.note || \"–ß–∞—Å—Ç–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞\" }}'\n  WHERE EXISTS (SELECT 1 FROM debt_update)\n  RETURNING id\n)\nSELECT * FROM debt_update",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        1200
      ],
      "id": "pay-debt-001",
      "name": "Pay Debt",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=UPDATE debts\nSET remaining_amount = 0, is_settled = true, settled_at = NOW(), updated_at = NOW()\nWHERE user_id = {{ $json.body.user_id }}\n  AND is_settled = false\n  AND (\n    ({{ $json.body.debt_id }} > 0 AND id = {{ $json.body.debt_id }})\n    OR ({{ $json.body.debt_id }} = 0 AND LOWER(person_name) LIKE LOWER('%{{ $json.body.person_name }}%'))\n  )\nRETURNING id, person_name, 'settled' as status",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        1350
      ],
      "id": "settle-debt-001",
      "name": "Settle Debt",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=DELETE FROM debts\nWHERE id = {{ $json.body.debt_id }} AND user_id = {{ $json.body.user_id }}\nRETURNING id, person_name, 'deleted' as status",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        1500
      ],
      "id": "delete-debt-001",
      "name": "Delete Debt",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–æ–ª–≥–æ–≤\nconst items = $input.all();\nconst action = $('Debts Webhook').first().json.body.action;\n\nlet result = {};\n\nif (action === 'list') {\n  const debts = items.map(item => item.json);\n  const iOwe = debts.filter(d => d.debt_type === 'received' && !d.is_settled);\n  const owedToMe = debts.filter(d => d.debt_type === 'given' && !d.is_settled);\n  const settled = debts.filter(d => d.is_settled);\n  \n  result = {\n    success: true,\n    i_owe: iOwe.map(d => `${d.person_name}: ${d.remaining_amount} ${d.currency}${d.due_date ? ' (–¥–æ ' + new Date(d.due_date).toLocaleDateString('ru') + ')' : ''}`).join('; ') || '–Ω–µ—Ç',\n    owed_to_me: owedToMe.map(d => `${d.person_name}: ${d.remaining_amount} ${d.currency}${d.due_date ? ' (–¥–æ ' + new Date(d.due_date).toLocaleDateString('ru') + ')' : ''}`).join('; ') || '–Ω–µ—Ç',\n    settled_count: settled.length,\n    total_i_owe: iOwe.reduce((s, d) => s + parseFloat(d.remaining_amount), 0),\n    total_owed_to_me: owedToMe.reduce((s, d) => s + parseFloat(d.remaining_amount), 0)\n  };\n} else if (action === 'add') {\n  if (items.length > 0 && items[0].json.id) {\n    const d = items[0].json;\n    const typeText = d.debt_type === 'received' ? '–Ø –¥–æ–ª–∂–µ–Ω' : '–ú–Ω–µ –¥–æ–ª–∂–µ–Ω';\n    result = {\n      success: true,\n      message: `${typeText} ${d.person_name}: ${d.original_amount} ${d.currency}`\n    };\n  } else {\n    result = { success: false, message: '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥' };\n  }\n} else if (action === 'pay') {\n  if (items.length > 0 && items[0].json.id) {\n    const d = items[0].json;\n    result = {\n      success: true,\n      message: d.is_settled ? `–î–æ–ª–≥ ${d.person_name} –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≥–∞—à–µ–Ω!` : `–û–ø–ª–∞—á–µ–Ω–æ. –û—Å—Ç–∞–ª–æ—Å—å: ${d.remaining_amount}`\n    };\n  } else {\n    result = { success: false, message: '–î–æ–ª–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω' };\n  }\n} else if (action === 'settle') {\n  if (items.length > 0 && items[0].json.id) {\n    result = { success: true, message: `–î–æ–ª–≥ ${items[0].json.person_name} –∑–∞–∫—Ä—ã—Ç` };\n  } else {\n    result = { success: false, message: '–î–æ–ª–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω' };\n  }\n} else if (action === 'delete') {\n  if (items.length > 0 && items[0].json.id) {\n    result = { success: true, message: `–î–æ–ª–≥ ${items[0].json.person_name} —É–¥–∞–ª—ë–Ω` };\n  } else {\n    result = { success: false, message: '–î–æ–ª–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω' };\n  }\n}\n\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        1100
      ],
      "id": "format-debt-response-001",
      "name": "Format Debt Response"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -2128,
        1100
      ],
      "id": "respond-debts-001",
      "name": "Respond Debts"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "recurring",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3024,
        1800
      ],
      "id": "recurring-webhook-001",
      "name": "Recurring Webhook",
      "webhookId": "recurring-webhook-id"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "list",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "list"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "add",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "add"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "pay",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pay"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "pause",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pause"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "delete",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "delete"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2800,
        1800
      ],
      "id": "route-recurring-action-001",
      "name": "Route Recurring Action"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT r.id, r.title, r.amount, r.currency, r.frequency, r.next_payment_date, r.is_active, r.auto_create, r.category\nFROM recurring_payments r\nWHERE r.user_id = {{ $json.body.user_id }}\nORDER BY r.is_active DESC, r.next_payment_date ASC",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        1600
      ],
      "id": "get-recurring-001",
      "name": "Get Recurring",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=INSERT INTO recurring_payments (user_id, title, amount, currency, frequency, start_date, next_payment_date, category)\nVALUES (\n  {{ $json.body.user_id }},\n  '{{ $json.body.title }}',\n  {{ $json.body.amount || 0 }},\n  '{{ $json.body.currency || \"KGS\" }}',\n  '{{ $json.body.frequency || \"monthly\" }}',\n  COALESCE(NULLIF('{{ $json.body.next_payment_date }}', '')::date, CURRENT_DATE),\n  COALESCE(NULLIF('{{ $json.body.next_payment_date }}', '')::date, CURRENT_DATE),\n  '{{ $json.body.category || \"–ü–æ–¥–ø–∏—Å–∫–∏\" }}'\n)\nRETURNING id, title, amount, currency, frequency, next_payment_date",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        1750
      ],
      "id": "add-recurring-001",
      "name": "Add Recurring",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=WITH freq_interval AS (\n  SELECT CASE \n    WHEN frequency = 'daily' THEN INTERVAL '1 day'\n    WHEN frequency = 'weekly' THEN INTERVAL '1 week'\n    WHEN frequency = 'monthly' THEN INTERVAL '1 month'\n    WHEN frequency = 'yearly' THEN INTERVAL '1 year'\n    ELSE INTERVAL '1 month'\n  END as interval_val\n  FROM recurring_payments WHERE id = {{ $json.body.recurring_id }}\n)\nUPDATE recurring_payments\nSET next_payment_date = next_payment_date + (SELECT interval_val FROM freq_interval),\n    last_payment_date = NOW(),\n    updated_at = NOW()\nWHERE id = {{ $json.body.recurring_id }} AND user_id = {{ $json.body.user_id }}\nRETURNING id, title, next_payment_date, 'paid' as status",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        1900
      ],
      "id": "pay-recurring-001",
      "name": "Pay Recurring",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=UPDATE recurring_payments\nSET is_active = NOT is_active, updated_at = NOW()\nWHERE id = {{ $json.body.recurring_id }} AND user_id = {{ $json.body.user_id }}\nRETURNING id, title, is_active",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        2050
      ],
      "id": "pause-recurring-001",
      "name": "Pause Recurring",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=DELETE FROM recurring_payments\nWHERE id = {{ $json.body.recurring_id }} AND user_id = {{ $json.body.user_id }}\nRETURNING id, title, 'deleted' as status",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        2200
      ],
      "id": "delete-recurring-001",
      "name": "Delete Recurring",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π\nconst items = $input.all();\nconst action = $('Recurring Webhook').first().json.body.action;\n\nlet result = {};\n\nconst freqNames = {\n  'daily': '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ',\n  'weekly': '–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ', \n  'monthly': '–µ–∂–µ–º–µ—Å—è—á–Ω–æ',\n  'yearly': '–µ–∂–µ–≥–æ–¥–Ω–æ'\n};\n\nif (action === 'list') {\n  const payments = items.map(item => item.json);\n  const active = payments.filter(p => p.is_active);\n  const paused = payments.filter(p => !p.is_active);\n  \n  result = {\n    success: true,\n    active: active.map(p => `${p.category_icon || 'üìÖ'} ${p.title}: ${p.amount} ${p.currency} (${freqNames[p.frequency] || p.frequency}, —Å–ª–µ–¥: ${new Date(p.next_payment_date).toLocaleDateString('ru')})`).join('; ') || '–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö',\n    paused: paused.map(p => `${p.title} (–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)`).join('; ') || '–Ω–µ—Ç',\n    total_monthly: active.filter(p => p.frequency === 'monthly').reduce((s, p) => s + parseFloat(p.amount), 0),\n    count: active.length\n  };\n} else if (action === 'add') {\n  if (items.length > 0 && items[0].json.id) {\n    const p = items[0].json;\n    result = {\n      success: true,\n      message: `–î–æ–±–∞–≤–ª–µ–Ω —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–ª–∞—Ç—ë–∂ \"${p.title}\": ${p.amount} ${p.currency} ${freqNames[p.frequency] || p.frequency}`\n    };\n  } else {\n    result = { success: false, message: '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å' };\n  }\n} else if (action === 'pay') {\n  if (items.length > 0 && items[0].json.id) {\n    const p = items[0].json;\n    result = {\n      success: true,\n      message: `–ü–ª–∞—Ç—ë–∂ \"${p.title}\" –æ—Ç–º–µ—á–µ–Ω. –°–ª–µ–¥—É—é—â–∏–π: ${new Date(p.next_payment_date).toLocaleDateString('ru')}`\n    };\n  } else {\n    result = { success: false, message: '–ü–ª–∞—Ç—ë–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω' };\n  }\n} else if (action === 'pause') {\n  if (items.length > 0 && items[0].json.id) {\n    const p = items[0].json;\n    result = {\n      success: true,\n      message: p.is_active ? `–ü–ª–∞—Ç—ë–∂ \"${p.title}\" –≤–æ–∑–æ–±–Ω–æ–≤–ª—ë–Ω` : `–ü–ª–∞—Ç—ë–∂ \"${p.title}\" –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`\n    };\n  } else {\n    result = { success: false, message: '–ü–ª–∞—Ç—ë–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω' };\n  }\n} else if (action === 'delete') {\n  if (items.length > 0 && items[0].json.id) {\n    result = { success: true, message: `–ü–ª–∞—Ç—ë–∂ \"${items[0].json.title}\" —É–¥–∞–ª—ë–Ω` };\n  } else {\n    result = { success: false, message: '–ü–ª–∞—Ç—ë–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω' };\n  }\n}\n\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        1800
      ],
      "id": "format-recurring-response-001",
      "name": "Format Recurring Response"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -2128,
        1800
      ],
      "id": "respond-recurring-001",
      "name": "Respond Recurring"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "settings",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3024,
        2400
      ],
      "id": "settings-webhook-001",
      "name": "Settings Webhook",
      "webhookId": "settings-webhook-id"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "get",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "get"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "set_mode",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "set_mode"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "set_currency",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "set_currency"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "set_budget",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "set_budget"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2800,
        2400
      ],
      "id": "route-settings-action-001",
      "name": "Route Settings Action"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SELECT user_id, preferred_currency, usage_type, monthly_budget FROM users WHERE user_id = {{ $json.body.user_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        2200
      ],
      "id": "get-settings-001",
      "name": "Get Settings",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=UPDATE users SET usage_type = '{{ $json.body.value }}', updated_at = NOW() WHERE user_id = {{ $json.body.user_id }} RETURNING user_id, usage_type",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        2350
      ],
      "id": "set-mode-001",
      "name": "Set Mode",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=UPDATE users SET preferred_currency = '{{ $json.body.value }}', updated_at = NOW() WHERE user_id = {{ $json.body.user_id }} RETURNING user_id, preferred_currency",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        2500
      ],
      "id": "set-currency-001",
      "name": "Set Currency",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=UPDATE users SET monthly_budget = {{ $json.body.value }}, updated_at = NOW() WHERE user_id = {{ $json.body.user_id }} RETURNING user_id, monthly_budget",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        2650
      ],
      "id": "set-budget-001",
      "name": "Set Budget",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst action = $('Settings Webhook').first().json.body.action;\n\nlet result = {};\n\nif (action === 'get') {\n  const s = items[0]?.json || {};\n  const modeText = s.usage_type === 'business' ? 'üíº –ë–∏–∑–Ω–µ—Å' : 'üë§ –õ–∏—á–Ω—ã–π';\n  result = {\n    success: true,\n    message: `‚öôÔ∏è –¢–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:\\n‚Ä¢ –†–µ–∂–∏–º: ${modeText}\\n‚Ä¢ –í–∞–ª—é—Ç–∞: ${s.preferred_currency || 'KGS'}\\n‚Ä¢ –ë—é–¥–∂–µ—Ç: ${s.monthly_budget ? s.monthly_budget + ' –≤ –º–µ—Å—è—Ü' : '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`\n  };\n} else if (action === 'set_mode') {\n  const s = items[0]?.json || {};\n  const modeText = s.usage_type === 'business' ? 'üíº –ë–∏–∑–Ω–µ—Å' : 'üë§ –õ–∏—á–Ω—ã–π';\n  result = {\n    success: true,\n    message: `‚úÖ –†–µ–∂–∏–º –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: ${modeText}`\n  };\n} else if (action === 'set_currency') {\n  const s = items[0]?.json || {};\n  result = {\n    success: true,\n    message: `‚úÖ –í–∞–ª—é—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${s.preferred_currency}`\n  };\n} else if (action === 'set_budget') {\n  const s = items[0]?.json || {};\n  result = {\n    success: true,\n    message: `‚úÖ –ë—é–¥–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${s.monthly_budget} –≤ –º–µ—Å—è—Ü`\n  };\n}\n\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        2400
      ],
      "id": "format-settings-response-001",
      "name": "Format Settings Response"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -2128,
        2400
      ],
      "id": "respond-settings-001",
      "name": "Respond Settings"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "budget",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3024,
        2900
      ],
      "id": "budget-webhook-001",
      "name": "Budget Webhook",
      "webhookId": "budget-webhook-id"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "get",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "get"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "set",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "set"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2800,
        2900
      ],
      "id": "route-budget-action-001",
      "name": "Route Budget Action"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=WITH current_month AS (\n  SELECT TO_CHAR(CURRENT_DATE AT TIME ZONE 'Asia/Bishkek', 'YYYY-MM') as month\n),\nbudget_info AS (\n  SELECT b.budget_amount, b.currency, b.month\n  FROM budgets b, current_month cm\n  WHERE b.user_id = {{ $json.body.user_id }} AND b.month = cm.month\n),\nexpenses_sum AS (\n  SELECT COALESCE(SUM(amount), 0) as total_spent\n  FROM expenses\n  WHERE user_id = {{ $json.body.user_id }}\n    AND deleted_at IS NULL\n    AND TO_CHAR(date AT TIME ZONE 'Asia/Bishkek', 'YYYY-MM') = (SELECT month FROM current_month)\n)\nSELECT \n  bi.budget_amount,\n  bi.currency,\n  bi.month,\n  es.total_spent,\n  bi.budget_amount - es.total_spent as remaining,\n  ROUND((es.total_spent / bi.budget_amount * 100)::numeric, 1) as percent_used\nFROM budget_info bi, expenses_sum es",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        2800
      ],
      "id": "get-budget-001",
      "name": "Get Budget",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=INSERT INTO budgets (user_id, month, budget_amount, currency)\nVALUES (\n  {{ $json.body.user_id }},\n  TO_CHAR(CURRENT_DATE AT TIME ZONE 'Asia/Bishkek', 'YYYY-MM'),\n  {{ $json.body.amount }},\n  '{{ $json.body.currency || 'KGS' }}'\n)\nON CONFLICT (user_id, month) DO UPDATE SET\n  budget_amount = EXCLUDED.budget_amount,\n  currency = EXCLUDED.currency,\n  last_updated = NOW()\nRETURNING id, user_id, month, budget_amount, currency",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2576,
        3000
      ],
      "id": "set-budget-new-001",
      "name": "Set Budget New",
      "credentials": {
        "postgres": {
          "id": "5T19Mbva6dh2EvkZ",
          "name": "Chyngyz account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst action = $('Budget Webhook').first().json.body.action;\n\nlet result = {};\n\nconst monthNames = {\n  '01': '—è–Ω–≤–∞—Ä—å', '02': '—Ñ–µ–≤—Ä–∞–ª—å', '03': '–º–∞—Ä—Ç', '04': '–∞–ø—Ä–µ–ª—å',\n  '05': '–º–∞–π', '06': '–∏—é–Ω—å', '07': '–∏—é–ª—å', '08': '–∞–≤–≥—É—Å—Ç',\n  '09': '—Å–µ–Ω—Ç—è–±—Ä—å', '10': '–æ–∫—Ç—è–±—Ä—å', '11': '–Ω–æ—è–±—Ä—å', '12': '–¥–µ–∫–∞–±—Ä—å'\n};\n\nif (action === 'get') {\n  const b = items[0]?.json;\n  if (b && b.budget_amount) {\n    const monthNum = b.month.split('-')[1];\n    const monthName = monthNames[monthNum] || b.month;\n    const percentUsed = parseFloat(b.percent_used) || 0;\n    let statusEmoji = '‚úÖ';\n    if (percentUsed >= 100) statusEmoji = 'üî¥';\n    else if (percentUsed >= 80) statusEmoji = 'üü°';\n    \n    result = {\n      success: true,\n      message: `üí∞ –ë—é–¥–∂–µ—Ç –Ω–∞ ${monthName}:\\n‚Ä¢ –õ–∏–º–∏—Ç: ${Number(b.budget_amount).toLocaleString()} ${b.currency}\\n‚Ä¢ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: ${Number(b.total_spent).toLocaleString()} ${b.currency} (${percentUsed}%)\\n‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å: ${Number(b.remaining).toLocaleString()} ${b.currency}\\n${statusEmoji} ${percentUsed >= 100 ? '–ë—é–¥–∂–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω!' : percentUsed >= 80 ? '–í–Ω–∏–º–∞–Ω–∏–µ: –±—é–¥–∂–µ—Ç –ø–æ—á—Ç–∏ –∏—Å—á–µ—Ä–ø–∞–Ω' : '–í –ø—Ä–µ–¥–µ–ª–∞—Ö –±—é–¥–∂–µ—Ç–∞'}`\n    };\n  } else {\n    result = {\n      success: true,\n      message: 'üìä –ë—é–¥–∂–µ—Ç –Ω–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.\\n\\n–ß—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, —Å–∫–∞–∂–∏: \"—É—Å—Ç–∞–Ω–æ–≤–∏ –±—é–¥–∂–µ—Ç 50000\"'\n    };\n  }\n} else if (action === 'set') {\n  const b = items[0]?.json;\n  if (b && b.budget_amount) {\n    const monthNum = b.month.split('-')[1];\n    const monthName = monthNames[monthNum] || b.month;\n    result = {\n      success: true,\n      message: `‚úÖ –ë—é–¥–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!\\n‚Ä¢ ${monthName}: ${Number(b.budget_amount).toLocaleString()} ${b.currency}`\n    };\n  } else {\n    result = { success: false, message: '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç' };\n  }\n}\n\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        2900
      ],
      "id": "format-budget-response-001",
      "name": "Format Budget Response"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -2128,
        2900
      ],
      "id": "respond-budget-001",
      "name": "Respond Budget"
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Ensure User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ensure User": {
      "main": [
        [
          {
            "node": "Check Onboarding",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Onboarding": {
      "main": [
        [
          {
            "node": "Onboarding Logic",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Message Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Onboarding Logic": {
      "main": [
        [
          {
            "node": "Update Onboarding",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Onboarding": {
      "main": [
        [
          {
            "node": "Send Onboarding",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message Type": {
      "main": [
        [
          {
            "node": "Download Voice",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Text Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Voice": {
      "main": [
        [
          {
            "node": "Whisper STT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Whisper STT": {
      "main": [
        [
          {
            "node": "Set Voice Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Voice Data": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Text Data": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send Reply",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GPT-4.1 Mini": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Get_Expenses": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get_Income": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create_Expense": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create_Income": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Delete_Expense": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Delete_Income": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Report_Daily": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Report_Weekly": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Report_Monthly": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Report_Period": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Category_Manager": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Debt_Manager": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Recurring_Manager": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Categories Webhook": {
      "main": [
        [
          {
            "node": "Route Category Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Category Action": {
      "main": [
        [
          {
            "node": "Get Categories",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Category",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Categories": {
      "main": [
        [
          {
            "node": "Format Category Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Category": {
      "main": [
        [
          {
            "node": "Format Category Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Category": {
      "main": [
        [
          {
            "node": "Format Category Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Category Response": {
      "main": [
        [
          {
            "node": "Respond Categories",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Debts Webhook": {
      "main": [
        [
          {
            "node": "Route Debt Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Debt Action": {
      "main": [
        [
          {
            "node": "Get Debts",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Debt",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pay Debt",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Settle Debt",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete Debt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Debts": {
      "main": [
        [
          {
            "node": "Format Debt Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Debt": {
      "main": [
        [
          {
            "node": "Format Debt Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pay Debt": {
      "main": [
        [
          {
            "node": "Format Debt Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Settle Debt": {
      "main": [
        [
          {
            "node": "Format Debt Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Debt": {
      "main": [
        [
          {
            "node": "Format Debt Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Debt Response": {
      "main": [
        [
          {
            "node": "Respond Debts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recurring Webhook": {
      "main": [
        [
          {
            "node": "Route Recurring Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Recurring Action": {
      "main": [
        [
          {
            "node": "Get Recurring",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Recurring",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pay Recurring",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pause Recurring",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete Recurring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Recurring": {
      "main": [
        [
          {
            "node": "Format Recurring Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Recurring": {
      "main": [
        [
          {
            "node": "Format Recurring Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pay Recurring": {
      "main": [
        [
          {
            "node": "Format Recurring Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pause Recurring": {
      "main": [
        [
          {
            "node": "Format Recurring Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Recurring": {
      "main": [
        [
          {
            "node": "Format Recurring Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Recurring Response": {
      "main": [
        [
          {
            "node": "Respond Recurring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Settings Webhook": {
      "main": [
        [
          {
            "node": "Route Settings Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Settings Action": {
      "main": [
        [
          {
            "node": "Get Settings",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Mode",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Currency",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Budget",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Settings": {
      "main": [
        [
          {
            "node": "Format Settings Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Mode": {
      "main": [
        [
          {
            "node": "Format Settings Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Currency": {
      "main": [
        [
          {
            "node": "Format Settings Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Budget": {
      "main": [
        [
          {
            "node": "Format Settings Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Settings Response": {
      "main": [
        [
          {
            "node": "Respond Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Budget_Manager": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Search_Transactions": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Budget Webhook": {
      "main": [
        [
          {
            "node": "Route Budget Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Budget Action": {
      "main": [
        [
          {
            "node": "Get Budget",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Budget New",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Budget": {
      "main": [
        [
          {
            "node": "Format Budget Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Budget New": {
      "main": [
        [
          {
            "node": "Format Budget Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Budget Response": {
      "main": [
        [
          {
            "node": "Respond Budget",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "3bd415084c202701a4e18d9b066a68ad477720c950e1c2cba4cb2537b78acc07"
  }
}