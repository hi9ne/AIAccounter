# üîÑ Changelog - Telegram Mini App

## [2.2.0] - 30 –æ–∫—Ç—è–±—Ä—è 2025 - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### üéØ –ì–ª–∞–≤–Ω–∞—è —Ñ–∏—á–∞: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

#### ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª—é–±—ã—Ö –ø–æ–ª–µ–π: —Å—É–º–º–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –¥–∞—Ç–∞, –≤–∞–ª—é—Ç–∞
- ‚úÖ –ü–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ ID –∏–ª–∏ —Å–ª–æ–≤—É "last"
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã: "–ò–∑–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –Ω–∞ 1500", "–ü–æ–º–µ–Ω—è–π –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ 15 –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã"
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∞—É–¥–∏—Ç-–∂—É—Ä–Ω–∞–ª–µ

#### üóëÔ∏è –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∏–∑ –ë–î
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã: "–£–¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥", "–£–¥–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–æ–º–µ—Ä 25"
- ‚úÖ –£–¥–∞–ª—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

#### üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã: "–í–µ—Ä–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é —É–¥–∞–ª—ë–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é", "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏ —Ä–∞—Å—Ö–æ–¥ 12"
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –º–µ—Ç–∫–∏ deleted_at

#### üìú –ê—É–¥–∏—Ç –∏ –∏—Å—Ç–æ—Ä–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ: —Å–æ–∑–¥–∞–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã: "–ü–æ–∫–∞–∂–∏ –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ 15", "–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞"
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—Å—è: –∫–∞–∫–æ–µ –ø–æ–ª–µ –∏–∑–º–µ–Ω–µ–Ω–æ, —Å—Ç–∞—Ä–æ–µ/–Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞

### üóÑÔ∏è –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü–∞ transaction_history
```sql
CREATE TABLE transaction_history (
    id SERIAL PRIMARY KEY,
    transaction_type VARCHAR(10) NOT NULL,
    transaction_id INTEGER NOT NULL,
    action VARCHAR(20) NOT NULL,
    field_changed VARCHAR(50),
    old_value TEXT,
    new_value TEXT,
    changed_by BIGINT NOT NULL,
    changed_at TIMESTAMP DEFAULT NOW(),
    details JSONB
);
```

#### Soft Delete Pattern
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–æ–ª–±—Ü—ã –≤ expenses –∏ income
ALTER TABLE expenses ADD COLUMN deleted_at TIMESTAMP;
ALTER TABLE expenses ADD COLUMN deleted_by BIGINT;
ALTER TABLE income ADD COLUMN deleted_at TIMESTAMP;
ALTER TABLE income ADD COLUMN deleted_by BIGINT;
```

#### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```sql
CREATE VIEW v_active_expenses AS
SELECT * FROM expenses WHERE deleted_at IS NULL;

CREATE VIEW v_active_income AS
SELECT * FROM income WHERE deleted_at IS NULL;
```

#### SQL –§—É–Ω–∫—Ü–∏–∏
```sql
-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
CREATE FUNCTION log_transaction_change(
    p_transaction_type VARCHAR(10),
    p_transaction_id INTEGER,
    p_action VARCHAR(20),
    p_field_changed VARCHAR(50),
    p_old_value TEXT,
    p_new_value TEXT,
    p_changed_by BIGINT
) RETURNS INTEGER;

-- –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
CREATE FUNCTION get_last_transaction(
    p_user_id BIGINT,
    p_type VARCHAR(10)
) RETURNS INTEGER;

-- –ü–æ–∏—Å–∫ –ø–æ —Å—É–º–º–µ
CREATE FUNCTION find_transaction_by_amount(
    p_user_id BIGINT,
    p_amount NUMERIC,
    p_type VARCHAR(10)
) RETURNS INTEGER;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
CREATE FUNCTION transaction_exists(
    p_id INTEGER,
    p_type VARCHAR(10),
    p_user_id BIGINT
) RETURNS BOOLEAN;
```

### ü§ñ –ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã AI Agent

**Edit_transaction** (Postgres Tool)
```sql
-- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
UPDATE expenses SET 
  amount = CASE WHEN field='amount' THEN new_value::NUMERIC ELSE amount END,
  category = CASE WHEN field='category' THEN new_value ELSE category END,
  description = CASE WHEN field='description' THEN new_value ELSE description END,
  date = CASE WHEN field='date' THEN new_value::TIMESTAMP ELSE date END,
  currency = CASE WHEN field='currency' THEN new_value ELSE currency END
WHERE id = found_transaction_id AND deleted_at IS NULL
```

**Delete_transaction** (Postgres Tool)
```sql
-- –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
UPDATE expenses 
SET deleted_at = NOW(), deleted_by = user_id
WHERE id = transaction_id AND deleted_at IS NULL
```

**Restore_transaction** (Postgres Tool)
```sql
-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
UPDATE expenses 
SET deleted_at = NULL, deleted_by = NULL
WHERE id = transaction_id AND deleted_at IS NOT NULL
```

**Get_transaction_history** (Postgres Tool)
```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
SELECT 
  action, field_changed, old_value, new_value, 
  changed_at, details
FROM transaction_history
WHERE transaction_id = id AND transaction_type = type
ORDER BY changed_at DESC
LIMIT 50
```

### üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
‚úÖ "–ò–∑–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –Ω–∞ 1500 —Å–æ–º"
   ‚Üí ‚úèÔ∏è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∞: —Å—É–º–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ 1,500 KGS

‚úÖ "–ü–æ–º–µ–Ω—è–π –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ 15 –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"
   ‚Üí ‚úèÔ∏è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∞: –∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç'

‚úÖ "–£–¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥"
   ‚Üí üóëÔ∏è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ (–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)

‚úÖ "–ü–æ–∫–∞–∂–∏ –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –æ–∫—Ç—è–±—Ä—å"
   ‚Üí üìä (—É–¥–∞–ª—ë–Ω–Ω—ã–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è)

‚úÖ "–í–µ—Ä–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é —É–¥–∞–ª—ë–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é"
   ‚Üí üîÑ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

‚úÖ "–ü–æ–∫–∞–∂–∏ –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ 15"
   ‚Üí üìú –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
      30.10.2025 12:00 - –°–æ–∑–¥–∞–Ω–∞ (—Å—É–º–º–∞: 500 KGS)
      30.10.2025 12:15 - –ò–∑–º–µ–Ω–µ–Ω–∞ —Å—É–º–º–∞: 500 ‚Üí 750 KGS
      30.10.2025 12:30 - –£–¥–∞–ª–µ–Ω–∞
      30.10.2025 12:45 - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
```

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –§–∞–π–ª: migrations/add_transaction_management.sql
- –¢–∞–±–ª–∏—Ü–∞ transaction_history (10 –ø–æ–ª–µ–π)
- –°—Ç–æ–ª–±—Ü—ã deleted_at, deleted_by –≤ expenses/income
- 4 SQL —Ñ—É–Ω–∫—Ü–∏–∏
- 2 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (v_active_expenses, v_active_income)
- 5 –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AI Agent
```javascript
// AnaliziFinance.json
+ Edit_transaction (Postgres Tool)
+ Delete_transaction (Postgres Tool)
+ Restore_transaction (Postgres Tool)
+ Get_transaction_history (Postgres Tool)
+ –û–±–Ω–æ–≤–ª—ë–Ω System Message —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
+ –î–æ–±–∞–≤–ª–µ–Ω—ã 4 –Ω–æ–≤—ã—Ö ai_tool connections
```

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ deleted_at –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ transaction_history –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
- View –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∏–∑ –≤—ã–±–æ—Ä–æ–∫

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Soft delete: –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
- –ê—É–¥–∏—Ç: –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∫—Ç–æ, —á—Ç–æ –∏ –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª

### ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**Test Suite:**
- [ ] –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –¢–µ—Å—Ç 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É–º–º—ã –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –¢–µ—Å—Ç 3: –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —É–¥–∞–ª—ë–Ω–Ω–∞—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
- [ ] –¢–µ—Å—Ç 5: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –¢–µ—Å—Ç 6: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –¢–µ—Å—Ç 7: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ ID
- [ ] –¢–µ—Å—Ç 8: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ ID

### üìö –ù–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚ûï `v2.2_SUMMARY.md` - –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é
- ‚ûï `migrations/add_transaction_management.sql` - SQL –º–∏–≥—Ä–∞—Ü–∏—è

---

# Changelog

## [2.2.0] - 2025-10-30

### Added
- ‚úèÔ∏è **Transaction Management**: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- üìú **Audit Log**: –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ `transaction_history`
- üîç **Smart Search**: —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —Ç–∏–ø—É
- üóëÔ∏è **Soft Delete**: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### Fixed
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_last_transaction()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç INTEGER –≤–º–µ—Å—Ç–æ TABLE
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫: `user_id` –≤–º–µ—Å—Ç–æ `telegram_user_id`
- ‚úÖ User ID –±–µ—Ä—ë—Ç—Å—è –∏–∑ Telegram —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 'last' —á–µ—Ä–µ–∑ NULLIF –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ CAST
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã: TO_TIMESTAMP –≤–º–µ—Å—Ç–æ ::TIMESTAMP
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π SELECT –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç row_to_json() –≤–º–µ—Å—Ç–æ *

### Database
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `transaction_history` (8 –ø–æ–ª–µ–π)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ `deleted_at`, `deleted_by` –≤ `expenses` –∏ `income`
- 4 –Ω–æ–≤—ã—Ö SQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### AI Tools
- `Edit_transaction` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `Delete_transaction` - –º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
- `Restore_transaction` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö
- `Get_transaction_history` - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Tested
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏—è get_last_transaction() —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ transaction_history

---

## [2.1.0] - 2025-10-29

### üéØ –ì–ª–∞–≤–Ω–∞—è —Ñ–∏—á–∞: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç

#### üí± –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É KGS, USD, EUR, RUB
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 10:00
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã: "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π 1000 —Å–æ–º –≤ –¥–æ–ª–ª–∞—Ä—ã", "–ö–∞–∫–æ–π –∫—É—Ä—Å –µ–≤—Ä–æ?"
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –ª—é–±–æ–π –≤–∞–ª—é—Ç–µ: "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö"
- ‚úÖ –ö—Ä–æ—Å—Å-–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: EUR‚ÜíRUB, USD‚ÜíEUR –∏ —Ç.–¥.

#### üóÑÔ∏è –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
CREATE TABLE exchange_rates (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    from_currency VARCHAR(3) NOT NULL,
    to_currency VARCHAR(3) NOT NULL,
    rate NUMERIC(10, 6) NOT NULL,
    source VARCHAR(50) DEFAULT 'exchangerate-api.com',
    UNIQUE(date, from_currency, to_currency)
);

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞
CREATE FUNCTION get_exchange_rate(
    p_from VARCHAR(3),
    p_to VARCHAR(3),
    p_date DATE DEFAULT CURRENT_DATE
) RETURNS NUMERIC;

-- –§—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
CREATE FUNCTION convert_amount(
    p_amount NUMERIC,
    p_from VARCHAR(3),
    p_to VARCHAR(3),
    p_date DATE DEFAULT CURRENT_DATE
) RETURNS NUMERIC;

-- View –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
CREATE VIEW v_latest_rates AS
SELECT * FROM exchange_rates 
WHERE date = (SELECT MAX(date) FROM exchange_rates);
```

#### ü§ñ –ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã AI Agent

**Convert_currency** (Postgres Tool)
```sql
-- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—É–º–º—ã —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫—É—Ä—Å–æ–º
SELECT 
    {{ $fromAI("amount") }} as original_amount,
    UPPER('{{ $fromAI("from_currency") }}') as from_currency,
    UPPER('{{ $fromAI("to_currency") }}') as to_currency,
    get_exchange_rate(...) as rate,
    convert_amount(...) as converted_amount
```

**Get_exchange_rates** (Postgres Tool)
```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
SELECT 
    from_currency,
    to_currency,
    rate,
    date
FROM v_latest_rates
ORDER BY from_currency, to_currency;
```

#### üîÑ –ù–æ–≤—ã–π workflow: ExchangeRates_Daily

**Cron Schedule:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 10:00 (Asia/Bishkek)

**Workflow:**
1. HTTP Request ‚Üí ExchangeRate-API
2. JavaScript ‚Üí –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
3. Postgres ‚Üí INSERT —Å ON CONFLICT DO UPDATE
4. Telegram ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** https://api.exchangerate-api.com/v4/latest/KGS

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä—ã:** 16+ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π (KGS‚ÜîUSD, KGS‚ÜîEUR, KGS‚ÜîRUB, USD‚ÜîEUR –∏ —Ç.–¥.)

### üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
‚úÖ "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π 1000 —Å–æ–º –≤ –¥–æ–ª–ª–∞—Ä—ã"
   ‚Üí üí± 1,000 KGS = 11.50 USD (–ø–æ –∫—É—Ä—Å—É 87.00)

‚úÖ "–ö–∞–∫–æ–π –∫—É—Ä—Å –µ–≤—Ä–æ?"
   ‚Üí üí± 1 EUR = 94.50 KGS

‚úÖ "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 100 –¥–æ–ª–ª–∞—Ä–æ–≤ –≤ —Å–æ–º–∞—Ö?"
   ‚Üí üí± 100 USD = 8,700 KGS

‚úÖ "–ü–µ—Ä–µ–≤–µ–¥–∏ 50 –µ–≤—Ä–æ –≤ —Ä—É–±–ª–∏"
   ‚Üí üí± 50 EUR = 5,225 RUB (–ø–æ –∫—É—Ä—Å—É 104.50)

‚úÖ "–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö"
   ‚Üí üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –æ–∫—Ç—è–±—Ä—å 2025 (–≤ USD):
      üí∏ –†–∞—Å—Ö–æ–¥—ã: 316.23 USD
      üí∞ –î–æ—Ö–æ–¥—ã: 1,179.46 USD
      üìà –ü—Ä–∏–±—ã–ª—å: 863.23 USD

‚úÖ "–í—Å–µ –∫—É—Ä—Å—ã"
   ‚Üí üí± –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –Ω–∞ 30.10.2025:
      KGS ‚Üí USD: 0.0115
      USD ‚Üí KGS: 87.00
      ...
```

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –§–∞–π–ª: migrations/add_exchange_rates.sql
- –¢–∞–±–ª–∏—Ü–∞ exchange_rates (6 –ø–æ–ª–µ–π)
- –§—É–Ω–∫—Ü–∏–∏ get_exchange_rate() –∏ convert_amount()
- View v_latest_rates –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –¢—Ä–∏–≥–≥–µ—Ä auto_create_reverse_rate (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—Ä–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã)
- –ù–∞—á–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã (12+ –∑–∞–ø–∏—Å–µ–π)
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AI Agent
```javascript
// AnaliziFinance.json
+ Convert_currency (Postgres Tool)
+ Get_exchange_rates (Postgres Tool)
+ –û–±–Ω–æ–≤–ª—ë–Ω System Message —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
+ –î–æ–±–∞–≤–ª–µ–Ω—ã ai_tool connections
```

### üìö –ù–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚ûï `docs/CURRENCY_CONVERSION.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ûï `ROADMAP_v2.1.md` - –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚ûï `UPGRADE_TO_2.1.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å v2.0
- ‚ûï `migrations/add_exchange_rates.sql` - SQL –º–∏–≥—Ä–∞—Ü–∏—è

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ psql –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SQL)
- –£–ª—É—á—à–µ–Ω–æ: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –∫—É—Ä—Å–æ–≤
- –£–ª—É—á—à–µ–Ω–æ: –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–∞–ª—é—Ç –ø–µ—Ä–µ–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- View `v_latest_rates` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫—É—Ä—Å–∞–º
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ (date, from_currency, to_currency) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤ –ë–î (–Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º API –∫–∞–∂–¥—ã–π —Ä–∞–∑)

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ON CONFLICT DO UPDATE –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∞–ª—é—Ç —á–µ—Ä–µ–∑ CHECK constraints
- Rate limiting –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤ (1 —Ä–∞–∑ –≤ –¥–µ–Ω—å)

### üìä –ú–∏–≥—Ä–∞—Ü–∏—è —Å v2.0

**–í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** ~20 –º–∏–Ω—É—Ç

**–®–∞–≥–∏:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `migrations/add_exchange_rates.sql` –≤ Supabase
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `ExchangeRates_Daily.json` –≤ n8n
3. –û–±–Ω–æ–≤–∏—Ç–µ `AnaliziFinance.json` –≤ n8n
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ 6 –∫–æ–º–∞–Ω–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** –°–º. `UPGRADE_TO_2.1.md`

### ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**Test Suite:**
- [ ] –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É—Ä—Å–æ–≤ ("–ö–∞–∫–æ–π –∫—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞?")
- [ ] –¢–µ—Å—Ç 2: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ("–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π 1000 —Å–æ–º –≤ –¥–æ–ª–ª–∞—Ä—ã")
- [ ] –¢–µ—Å—Ç 3: –û–±—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ("100 –¥–æ–ª–ª–∞—Ä–æ–≤ –≤ —Å–æ–º—ã")
- [ ] –¢–µ—Å—Ç 4: –ö—Ä–æ—Å—Å-–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ("50 –µ–≤—Ä–æ –≤ —Ä—É–±–ª–∏")
- [ ] –¢–µ—Å—Ç 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –≤–∞–ª—é—Ç–µ ("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö")
- [ ] –¢–µ—Å—Ç 6: –í—Å–µ –∫—É—Ä—Å—ã ("–í—Å–µ –∫—É—Ä—Å—ã")

---

## [2.0.0] - 28 —è–Ω–≤–∞—Ä—è 2025 - –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å –∏ —É–ª—É—á—à–µ–Ω–∏—è

#### –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å
- üí± –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 4 –≤–∞–ª—é—Ç: KGS (—Å–æ–º), USD, EUR, RUB
- üè¶ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ –≤–∞–ª—é—Ç—ã
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —É—á—ë—Ç–æ–º –≤–∞–ª—é—Ç—ã
- üìã –ò—Å—Ç–æ—Ä–∏—è —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤–∞–ª—é—Ç—ã –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

#### –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ 6 –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤:
  - –ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
  - –ú–µ–¥–∏—Ü–∏–Ω–∞
  - –û–¥–µ–∂–¥–∞
  - –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
  - –•–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
  - –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
  - –ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ 2 –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤:
  - –§—Ä–∏–ª–∞–Ω—Å
  - –ê—Ä–µ–Ω–¥–∞ –∏–º—É—â–µ—Å—Ç–≤–∞

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- üîó –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ü§ñ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ Telegram Bot (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### UI/UX —É–ª—É—á—à–µ–Ω–∏—è
- üì± –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- üåô –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã Telegram
- üìÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- üí´ –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```javascript
// –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
{
    type: 'income' | 'expense',
    amount: number,
    currency: 'KGS' | 'USD' | 'EUR' | 'RUB',
    category: string,
    description: string,
    date: string,
    time: string,
    telegram_user_id: number
}
```

#### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `updateCurrencyDisplay()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã
- `sendToSupabase()` - –ø—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Supabase
- `resetForm()` - —Å–±—Ä–æ—Å —Ñ–æ—Ä–º—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –≤–∞–ª—é—Ç—ã

#### API –∏–∑–º–µ–Ω–µ–Ω–∏—è
```javascript
// –î–ª—è —Ä–µ–∂–∏–º–∞ Supabase
POST /rest/v1/expenses
POST /rest/v1/income

Headers:
- apikey: SUPABASE_ANON_KEY
- Authorization: Bearer SUPABASE_ANON_KEY
- Content-Type: application/json

Body:
{
    "amount": 1000,
    "currency": "KGS",
    "category": "–ü—Ä–æ–¥—É–∫—Ç—ã",
    "description": "–ü–æ–∫—É–ø–∫–∞ –≤ —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–µ",
    "date": "2025-01-28T14:30:00",
    "telegram_user_id": 123456789
}
```

### üóÉÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢—Ä–µ–±—É–µ–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è currency
ALTER TABLE expenses ADD COLUMN IF NOT EXISTS currency VARCHAR(3) DEFAULT 'KGS' NOT NULL;
ALTER TABLE income ADD COLUMN IF NOT EXISTS currency VARCHAR(3) DEFAULT 'KGS' NOT NULL;

-- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
ALTER TABLE expenses ADD CONSTRAINT expenses_currency_check 
CHECK (currency IN ('KGS', 'USD', 'EUR', 'RUB'));

ALTER TABLE income ADD CONSTRAINT income_currency_check 
CHECK (currency IN ('KGS', 'USD', 'EUR', 'RUB'));

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX IF NOT EXISTS idx_expenses_currency ON expenses(currency);
CREATE INDEX IF NOT EXISTS idx_income_currency ON income(currency);
```

### üìù –ú–∏–≥—Ä–∞—Ü–∏—è —Å –≤–µ—Ä—Å–∏–∏ 1.x

1. **–û–±–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ migrations/add_currency_field.sql
psql -h your-supabase-host -U postgres -d postgres -f migrations/add_currency_field.sql
```

2. **–û–±–Ω–æ–≤–∏—Ç–µ n8n workflow:**
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `AnaliziFinance.json`
- –ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é Add_expense –∏ Add_income –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

3. **–û–±–Ω–æ–≤–∏—Ç–µ Mini App:**
- –ó–∞–º–µ–Ω–∏—Ç–µ `TelegramMiniApp.html` –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
- –°–æ–∑–¥–∞–π—Ç–µ `miniapp-config.js` –∏–∑ `miniapp-config.example.js`
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
```javascript
// –°—Ç–∞—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ currency –±—É–¥—É—Ç –∏–º–µ—Ç—å 'KGS' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
SELECT * FROM expenses WHERE currency IS NULL;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Ñ–æ—Ä–º–∞ –Ω–µ –æ—á–∏—â–∞–ª–∞—Å—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–∞—Å—å
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –≤—Ä–µ–º—è –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ ‚ÇΩ –≤–º–µ—Å—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã
- –£–ª—É—á—à–µ–Ω–æ: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö
- –£–ª—É—á—à–µ–Ω–æ: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—É—Å—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ HTML (—Å–∂–∞—Ç–∏–µ CSS)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: lazy loading –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ telegram_user_id
- –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π (—á–µ—Ä–µ–∑ Supabase RLS)

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω `MINIAPP_SETUP.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω `miniapp-config.example.js` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω `CHANGELOG.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª
- üîÑ –û–±–Ω–æ–≤–ª—ë–Ω `README.md` - —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç–∏

---

## [1.0.0] - –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤
- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot

---

## üîÆ –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ (v2.2+)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã v2.2
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (soft delete)
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- [ ] –ë—é–¥–∂–µ—Ç—ã –ø–æ –≤–∞–ª—é—Ç–∞–º —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- [ ] –ü—Ä–æ–≥–Ω–æ–∑ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç (ML)

### –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- [ ] PDF –æ—Ç—á—ë—Ç—ã —Å –±—Ä–µ–Ω–¥–∏–Ω–≥–æ–º
- [ ] Recurring transactions (–ø–æ–¥–ø–∏—Å–∫–∏)
- [ ] –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞ (–∫–æ—à–µ–ª—å–∫–∏)
- [ ] –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (–∫–∞—Å—Ç–æ–º–Ω–∞—è)
- [ ] –í–∏–¥–∂–µ—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –ò–¥–µ–∏
- [ ] –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] QR-—Å–∫–∞–Ω–µ—Ä —á–µ–∫–æ–≤
- [ ] OCR –¥–ª—è —á–µ–∫–æ–≤
- [ ] –ò–º–ø–æ—Ä—Ç –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤—ã–ø–∏—Å–æ–∫
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ 1C
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM
- [ ] –ú—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º (—Å–µ–º—å—è/–∫–æ–º–∞–Ω–¥–∞)
- [ ] –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π
- [ ] –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç

---

**üìÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 30 –æ–∫—Ç—è–±—Ä—è 2025  
**üè∑Ô∏è –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** 2.2.0  
**üë®‚Äçüíª –ê–≤—Ç–æ—Ä:** AI Accounter Team
