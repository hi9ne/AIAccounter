<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.0.3/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<style>
  body {
    -webkit-font-smoothing: antialiased;
    background: #F9FAFB;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }
</style>

<div class="container mx-auto px-8 py-6">
  
  <!-- Header -->
  <div class="text-center mb-8">
    <div class="text-6xl mb-3">üìÖ</div>
    <h1 class="text-4xl font-bold text-pink-600 mb-2">–û—Ç—á—ë—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥</h1>
    <p class="text-xl text-gray-600">{{period_start}} - {{period_end}}</p>
    <p class="text-sm text-gray-500 mt-2">üë§ {{user_name}} ‚Ä¢ ‚è±Ô∏è {{period_days}} –¥–Ω–µ–π</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-4 gap-3 mb-8">
    <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-3 text-center">
      <div class="text-2xl mb-1">üí∏</div>
      <div class="text-xs text-gray-600 uppercase font-semibold mb-1">–†–∞—Å—Ö–æ–¥—ã</div>
      <div class="text-2xl font-bold text-red-600">{{total_expenses_formatted}}</div>
    </div>
    <div class="bg-green-50 border-l-4 border-green-500 rounded-lg p-3 text-center">
      <div class="text-2xl mb-1">üí∞</div>
      <div class="text-xs text-gray-600 uppercase font-semibold mb-1">–î–æ—Ö–æ–¥—ã</div>
      <div class="text-2xl font-bold text-green-600">{{total_income_formatted}}</div>
    </div>
    <div class="bg-pink-50 border-l-4 border-pink-500 rounded-lg p-3 text-center">
      <div class="text-2xl mb-1">üìà</div>
      <div class="text-xs text-gray-600 uppercase font-semibold mb-1">–ë–∞–ª–∞–Ω—Å</div>
      <div class="text-2xl font-bold text-pink-600">{{balance_formatted}}</div>
    </div>
    <div class="bg-purple-50 border-l-4 border-purple-500 rounded-lg p-3 text-center">
      <div class="text-2xl mb-1">üîÑ</div>
      <div class="text-xs text-gray-600 uppercase font-semibold mb-1">–û–ø–µ—Ä–∞—Ü–∏–π</div>
      <div class="text-2xl font-bold text-purple-600">{{transaction_count}}</div>
    </div>
  </div>

  <!-- Main Chart -->
  <div class="bg-white border rounded-lg p-4 shadow-sm mb-6">
    <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –¥–Ω—è–º</h3>
    <div id="dailyLineChart"></div>
  </div>

  <!-- Charts Grid -->
  <div class="grid grid-cols-2 gap-6 mb-8">
    <div class="bg-white border rounded-lg p-4 shadow-sm">
      <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</h3>
      <div id="categoryPieChart"></div>
    </div>
    <div class="bg-white border rounded-lg p-4 shadow-sm">
      <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
      <div id="categoryBarChart"></div>
    </div>
  </div>

  <!-- Transactions Table -->
  <div class="bg-white border rounded-lg shadow-sm overflow-hidden mb-8">
    <h3 class="text-lg font-semibold text-gray-700 p-4 bg-gray-50 border-b">–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
    <table class="w-full">
      <thead class="bg-pink-600 text-white">
        <tr>
          <th class="px-3 py-2 text-left text-xs font-semibold">–î–∞—Ç–∞</th>
          <th class="px-3 py-2 text-left text-xs font-semibold">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th class="px-3 py-2 text-left text-xs font-semibold">–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th class="px-3 py-2 text-center text-xs font-semibold">–¢–∏–ø</th>
          <th class="px-3 py-2 text-right text-xs font-semibold">–°—É–º–º–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for tx in all_transactions %}
        <tr class="border-b hover:bg-gray-50 text-sm">
          <td class="px-3 py-2 text-xs font-medium text-pink-600">{{tx.date}}</td>
          <td class="px-3 py-2 text-xs text-gray-700">{{tx.category}}</td>
          <td class="px-3 py-2 text-xs text-gray-600">{{tx.description}}</td>
          <td class="px-3 py-2 text-center">
            {% if tx.type == 'expense' %}
            <span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">–†–∞—Å—Ö–æ–¥</span>
            {% else %}
            <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold">–î–æ—Ö–æ–¥</span>
            {% endif %}
          </td>
          <td class="px-3 py-2 text-right text-xs font-bold {% if tx.type == 'expense' %}text-red-600{% else %}text-green-600{% endif %}">{{tx.amount_formatted}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Analytics -->
  <div class="grid grid-cols-3 gap-4 mb-6">
    <div class="bg-gray-50 border rounded-lg p-3 text-center">
      <div class="text-2xl mb-1">üìä</div>
      <div class="text-xs text-gray-500 uppercase mb-1">–°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥/–¥–µ–Ω—å</div>
      <div class="text-lg font-bold text-red-600">{{avg_expense_per_day_formatted}}</div>
    </div>
    <div class="bg-gray-50 border rounded-lg p-3 text-center">
      <div class="text-2xl mb-1">üí∞</div>
      <div class="text-xs text-gray-500 uppercase mb-1">–°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥/–¥–µ–Ω—å</div>
      <div class="text-lg font-bold text-green-600">{{avg_income_per_day_formatted}}</div>
    </div>
    <div class="bg-gray-50 border rounded-lg p-3 text-center">
      <div class="text-2xl mb-1">üî•</div>
      <div class="text-xs text-gray-500 uppercase mb-1">–ú–∞–∫—Å. —Ä–∞—Å—Ö–æ–¥</div>
      <div class="text-lg font-bold text-gray-700">{{max_expense_formatted}}</div>
    </div>
  </div>

  <!-- Footer -->
  <div class="text-center text-sm text-gray-400 mt-6 pt-4 border-t">
    ü§ñ AIAccounter ‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç
  </div>

</div>

<script>
  // Wait for page load
  window.addEventListener('DOMContentLoaded', function() {
    // Line Chart - Daily Trend
    var dailyLabels = [{% for day in daily_data %}'{{day.date}}'{% if not loop.last %}, {% endif %}{% endfor %}];
    var dailyExpenses = [{% for day in daily_data %}{{day.expenses}}{% if not loop.last %}, {% endif %}{% endfor %}];
    var dailyIncome = [{% for day in daily_data %}{{day.income}}{% if not loop.last %}, {% endif %}{% endfor %}];

  new ApexCharts(document.querySelector("#dailyLineChart"), {
    chart: {
      type: 'area',
      width: '100%',
      height: 300,
      animations: { enabled: false },
      toolbar: { show: false }
    },
    series: [
      {
        name: '–†–∞—Å—Ö–æ–¥—ã',
        data: dailyExpenses
      },
      {
        name: '–î–æ—Ö–æ–¥—ã',
        data: dailyIncome
      }
    ],
    xaxis: {
      categories: dailyLabels,
      labels: {
        style: { fontSize: '10px' }
      }
    },
    yaxis: {
      labels: {
        formatter: function (val) {
          return val.toLocaleString() + ' ‚Ç∏'
        }
      }
    },
    colors: ['#EC4899', '#10B981'],
    fill: {
      type: 'gradient',
      gradient: {
        shadeIntensity: 1,
        opacityFrom: 0.6,
        opacityTo: 0.1,
      }
    },
    stroke: {
      curve: 'smooth',
      width: 3
    },
    dataLabels: { enabled: false },
    legend: {
      position: 'top',
      horizontalAlign: 'center'
    }
  }).render();

  // Pie Chart
  var categoryLabels = [{% for cat in category_totals %}'{{cat.category}}'{% if not loop.last %}, {% endif %}{% endfor %}];
  var categoryData = [{% for cat in category_totals %}{{cat.category_total}}{% if not loop.last %}, {% endif %}{% endfor %}];

  new ApexCharts(document.querySelector("#categoryPieChart"), {
    series: categoryData,
    chart: {
      type: 'donut',
      width: '100%',
      height: 280,
      animations: { enabled: false },
      toolbar: { show: false }
    },
    labels: categoryLabels,
    colors: ['#EC4899', '#8B5CF6', '#F59E0B', '#10B981', '#3B82F6', '#F97316'],
    legend: {
      position: 'bottom',
      fontSize: '11px'
    },
    dataLabels: {
      enabled: true,
      formatter: function (val) {
        return val.toFixed(1) + "%"
      }
    },
    plotOptions: {
      pie: {
        donut: { size: '60%' }
      }
    }
  }).render();

  // Bar Chart
  new ApexCharts(document.querySelector("#categoryBarChart"), {
    chart: {
      type: 'bar',
      width: '100%',
      height: 280,
      animations: { enabled: false },
      toolbar: { show: false }
    },
    series: [{
      name: '–°—É–º–º–∞',
      data: categoryData
    }],
    xaxis: {
      categories: categoryLabels,
      labels: {
        style: { fontSize: '9px' },
        rotate: -45
      }
    },
    yaxis: {
      labels: {
        formatter: function (val) {
          return val.toLocaleString()
        }
      }
    },
    colors: ['#EC4899'],
    plotOptions: {
      bar: {
        borderRadius: 6,
        columnWidth: '70%',
        distributed: true
      }
    },
    dataLabels: { enabled: false },
    legend: { show: false }
  }).render();
  
  }); // End DOMContentLoaded
</script>
